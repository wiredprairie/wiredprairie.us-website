{"id":1926,"date":"2013-08-12T20:18:27","date_gmt":"2013-08-13T01:18:27","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=1926"},"modified":"2022-06-29T10:26:41","modified_gmt":"2022-06-29T15:26:41","slug":"using-sqlite-and-c-to-determine-if-a-specified-table-exists","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1926","title":{"rendered":"Using Sqlite and C# to determine if a specified table exists"},"content":{"rendered":"\n<p>I had need of a bit of code in C# to determine whether several tables in a Sqlite database had been created, so \u2026<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\"><span class=\"kwrd\">public<\/span> <span class=\"kwrd\">static<\/span> <span class=\"kwrd\">class<\/span> DbExtensions\n{\n    <span class=\"rem\">\/\/\/ &lt;summary&gt;<\/span>\n    <span class=\"rem\">\/\/\/ Determines whether the table exists<\/span>\n    <span class=\"rem\">\/\/\/ &lt;\/summary&gt;<\/span>\n    <span class=\"rem\">\/\/\/ &lt;param name=\"connection\"&gt;Existing, opened, database connection&lt;\/param&gt;<\/span>\n    <span class=\"rem\">\/\/\/ &lt;param name=\"tableName\"&gt;The name of the table to test for.&lt;\/param&gt;<\/span>\n    <span class=\"rem\">\/\/\/ &lt;returns&gt;True if table exists.&lt;\/returns&gt;<\/span>\n    <span class=\"kwrd\">public<\/span> <span class=\"kwrd\">static<\/span> <span class=\"kwrd\">bool<\/span> TableExists(<span class=\"kwrd\">this<\/span> IDbConnection connection, <span class=\"kwrd\">string<\/span> tableName)\n    {\n        Debug.Assert(connection != <span class=\"kwrd\">null<\/span>);\n        Debug.Assert(!<span class=\"kwrd\">string<\/span>.IsNullOrWhiteSpace(tableName));\n\n        var cmd = connection.CreateCommand();\n        cmd.CommandText = <span class=\"str\">@\"SELECT COUNT(*) FROM sqlite_master WHERE <a href=\"mailto:name=@TableName&quot;;\">name=@TableName\"<\/a><\/span>;\n        var p1 = cmd.CreateParameter();\n        p1.DbType = DbType.String;\n        p1.ParameterName = <span class=\"str\">\"TableName\"<\/span>;\n        p1.Value = tableName;\n        cmd.Parameters.Add(p1);\n\n        var result = cmd.ExecuteScalar();\n        <span class=\"kwrd\">return<\/span> ((<span class=\"kwrd\">long<\/span>)result) == 1;\n    }\n}<\/pre>\n\n\n\n<p><\/p>\n\n\n\n<p>Nothing too complex \u2026 only determining that the list of tables is stored in <strong>a <\/strong>system table named <strong>sqlite_master<\/strong>. If you want to find all indexes that have dependencies on a specific table, you can instead use the column <strong>tbl_name<\/strong>.<\/p>\n\n\n\n<p>If you\u2019re using Dapper and the DapperExtensions, you might find this useful:<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\">_connection = <span class=\"kwrd\">new<\/span> System.Data.SQLite.SQLiteConnection();\nDapperExtensions.DapperExtensions.SqlDialect = <span class=\"kwrd\">new<\/span> DapperExtensions.Sql.SqliteDialect();\n_connection.ConnectionString = <span class=\"kwrd\">new<\/span> DbConnectionStringBuilder()\n{\n    {<span class=\"str\">\"Data Source\"<\/span>, <span class=\"str\">\"thumbnailer.db\"<\/span>},\n    {<span class=\"str\">\"Version\"<\/span>, <span class=\"str\">\"3\"<\/span>},\n    {<span class=\"str\">\"FailIfMissing\"<\/span>, <span class=\"str\">\"False\"<\/span>},\n}.ConnectionString;<\/pre>\n\n\n\n<p><\/p>\n\n\n\n<p>First, it creates the SQLite connection (<a href=\"http:\/\/www.nuget.org\/packages\/System.Data.SQLite\" target=\"_blank\" rel=\"noopener\">nuget<\/a>) and then configures the DapperExtensions to use the SqliteDialect. What that means is that the extensions will generate SQL that actually works! :) Finally, in my case, I wanted the DB to be created if it didn\u2019t exist, so I set <strong>FailIfMissing<\/strong> to <strong>False<\/strong>.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I had need of a bit of code in C# to determine whether several tables in a Sqlite database had been created, so \u2026 public static class DbExtensions { \/\/\/ &lt;summary&gt; \/\/\/ Determines whether the table exists \/\/\/ &lt;\/summary&gt; \/\/\/ &lt;param name=&#8221;connection&#8221;&gt;Existing, opened, database connection&lt;\/param&gt; \/\/\/ &lt;param name=&#8221;tableName&#8221;&gt;The name of the table to test for.&lt;\/param&gt; [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[82,145],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-v4","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1597,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1597","url_meta":{"origin":1926,"position":0},"title":"Paging Data with SQL Server Compact","date":"April 1, 2012","format":false,"excerpt":"If you\u2019re using SQL Server Compact Editition version 4 or higher, there\u2019s finally a decent and efficient way to do data paging: var streets = db.Query<StreetName>(@\"SELECT * FROM StreetNames ORDER BY Id OFFSET @offset ROWS FETCH NEXT @rows ROWS ONLY\", new { offset = group * GroupSize, rows = GroupSize\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/04\/image9.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1730,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1730","url_meta":{"origin":1926,"position":1},"title":"How to find an element in a DataTemplate in WinRT\/XAML.","date":"September 7, 2012","format":false,"excerpt":"Here\u2019s one way to find a named element in a DataTemplate in XAML in Windows 8 XAML. You might try FindName to discover it doesn\u2019t work. That\u2019s because it\u2019s not recursive. So, I created a simple extension method to do the same thing: public static class FrameworkElementExtensions { public static\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/09\/image.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1835,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1835","url_meta":{"origin":1926,"position":2},"title":"How to rewrite a MongoDB C# LINQ with a Projection Requirement using a MongoCursor","date":"January 26, 2013","format":false,"excerpt":"The LINQ Provider for MongoDB does not currently take into account data projections efficiently when returning data. This could mean that you\u2019re unnecessarily returning more data from the database than is needed. So, I\u2019m going to show you the pattern I applied as a replacement for the LINQ queries when\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1345,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1345","url_meta":{"origin":1926,"position":3},"title":"Creating a simple Entity Reference system for Ember.js","date":"December 28, 2011","format":false,"excerpt":"I had some data stored in a structure similar to this: Nothing too fancy. A table of Gift(s) and a table of Person(s). Each gift had a foreign key relationship to a Person (the person who \u201cgave\u201d the gift). Since some people may give several gifts, I didn\u2019t want to\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1524,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1524","url_meta":{"origin":1926,"position":4},"title":"Alternative to ApplicationSettings in .NET","date":"February 1, 2012","format":false,"excerpt":"After dealing with lost settings, an unclear upgrade path, and my own confusion surrounding the magic of Settings in a .NET client application, I decided to build my own. You\u2019re probably familiar with this UI in Visual Studio. It hasn\u2019t changed much since it was first created: A list of\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/02\/image.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1701,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1701","url_meta":{"origin":1926,"position":5},"title":"Windows 8 WinRT\/Metro Missing UpdateSourceTrigger","date":"August 5, 2012","format":false,"excerpt":"If you\u2019ve done WPF or Silverlight programming, you may have found an occasion where using the Binding property UpdateSourceTrigger set to PropertyChanged was extremely useful. (I know I have!) It may have looked something like this: <TextBox Text=\"{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}\" \/> The key feature was the live updating of the\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1926"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=1926"}],"version-history":[{"count":3,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1926\/revisions"}],"predecessor-version":[{"id":2387,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1926\/revisions\/2387"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=1926"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=1926"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=1926"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}