{"id":885,"date":"2010-01-03T22:15:08","date_gmt":"2010-01-04T03:15:08","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/885"},"modified":"2010-01-03T22:50:04","modified_gmt":"2010-01-04T03:50:04","slug":"microsoft-ajax-library-declarative-command-alternatives","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/885","title":{"rendered":"Microsoft Ajax Library Declarative Command Alternatives"},"content":{"rendered":"<p>There may be another way to accomplish this, but I wanted to have a simple commanding system in the <a href=\"http:\/\/www.asp.net\/ajaxlibrary\/\">Microsoft Ajax Library<\/a> which worked outside of the templates. <\/p>\n<p>After a number of false starts and frustration brought about by very limited documentation, I discovered a reasonable implementation.<\/p>\n<p>I created a script file, \u201cCommanding.js\u201d (in a Scripts folder):<\/p>\n<pre class=\"code\"><span style=\"color: green\">\/\/\/ &lt;reference name=&quot;MicrosoftAjax.js&quot;\/&gt;\n\n<\/span>Type.registerNamespace(<span style=\"color: #a31515\">&quot;WiredPrairie&quot;<\/span>);\n\nWiredPrairie.Commanding = <span style=\"color: blue\">function<\/span>(element) {\n    WiredPrairie.Commanding.initializeBase(<span style=\"color: blue\">this<\/span>, [element]);\n}\n\nWiredPrairie.Commanding.prototype = {\n    initialize: <span style=\"color: blue\">function<\/span>() {\n        WiredPrairie.Commanding.callBaseMethod(<span style=\"color: blue\">this<\/span>, <span style=\"color: #a31515\">'initialize'<\/span>);\n\n        <span style=\"color: green\">\/\/ Add custom initialization here\n    <\/span>},\n    dispose: <span style=\"color: blue\">function<\/span>() {\n        <span style=\"color: green\">\/\/Add custom dispose actions here\n        <\/span>WiredPrairie.Commanding.callBaseMethod(<span style=\"color: blue\">this<\/span>, <span style=\"color: #a31515\">'dispose'<\/span>);\n    }\n}\n\nWiredPrairie.Commanding.registerClass(<span style=\"color: #a31515\">'WiredPrairie.Commanding'<\/span>, Sys.UI.Control);\n\n<span style=\"color: blue\">if <\/span>(<span style=\"color: blue\">typeof <\/span>(Sys) !== <span style=\"color: #a31515\">'undefined'<\/span>) Sys.Application.notifyScriptLoaded();<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>This is just a basic JavaScript class, with the default implementation provided by the Ajax Client Control template in Visual Studio 2008. The reason this is needed is that Controls all support a special event onBubbleEvent that is needed by commands when they\u2019re raised.<\/p>\n<p>In the body of the HTML, I attached an instance of the \u201cWiredPrairie.Commanding\u201d class to the body. Next, I attached a JavaScript function to the onbubbleevent (wpc:onbubbleevent, remember that all attributes need to be all lowercase). Here, I\u2019ve used the special {{ }} syntax to indicate I want JavaScript code to execute when the event is raised. <\/p>\n<pre class=\"code\"><span style=\"color: blue\">&lt;<\/span><span style=\"color: #a31515\">body xmlns<\/span><span style=\"color: blue\">:<\/span><span style=\"color: red\">sys<\/span><span style=\"color: blue\">=&quot;javascript:Sys&quot; \n    <\/span><span style=\"color: #a31515\">xmlns<\/span><span style=\"color: blue\">:<\/span><span style=\"color: red\">wpc<\/span><span style=\"color: blue\">=&quot;javascript:WiredPrairie.Commanding&quot; \n    <\/span><span style=\"color: #a31515\">sys<\/span><span style=\"color: blue\">:<\/span><span style=\"color: red\">attach<\/span><span style=\"color: blue\">=&quot;wpc&quot; \n    <\/span><span style=\"color: #a31515\">wpc<\/span><span style=\"color: blue\">:<\/span><span style=\"color: red\">onbubbleevent<\/span><span style=\"color: blue\">=&quot;{{onCommand}}&quot; &gt;\n    &lt;<\/span><span style=\"color: #a31515\">div <\/span><span style=\"color: blue\">&gt;\n        &lt;<\/span><span style=\"color: #a31515\">button sys<\/span><span style=\"color: blue\">:<\/span><span style=\"color: red\">command<\/span><span style=\"color: blue\">=&quot;startRunningCommand&quot; <\/span><span style=\"color: #a31515\">sys<\/span><span style=\"color: blue\">:<\/span><span style=\"color: red\">commandargument<\/span><span style=\"color: blue\">=&quot;iargueaboutit&quot;&gt;<\/span>Run<span style=\"color: blue\">&lt;\/<\/span><span style=\"color: #a31515\">button<\/span><span style=\"color: blue\">&gt;\n    &lt;\/<\/span><span style=\"color: #a31515\">div<\/span><span style=\"color: blue\">&gt;\n&lt;\/<\/span><span style=\"color: #a31515\">body<\/span><span style=\"color: blue\">&gt;\n<\/span><\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>I needed my JavaScript WiredPrairie.Commanding class to load and run at the right time on the page, so I\u2019ve used the new loader classes in the Ajax library.<\/p>\n<pre class=\"code\">Sys.loader.defineScripts(<span style=\"color: blue\">null<\/span>, [\n{\n    name: <span style=\"color: #a31515\">&quot;Commanding&quot;\n    <\/span>,releaseUrl: <span style=\"color: #a31515\">&quot;Scripts\/Commanding.js&quot;\n    <\/span>,debugUrl: <span style=\"color: #a31515\">&quot;Scripts\/Commanding.js&quot;\n    <\/span>,dependencies: [<span style=\"color: #a31515\">&quot;ComponentModel&quot;<\/span>]\n }\n ]);<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>First, I needed to declare this new script file and any dependencies. Since I don\u2019t yet have a minified version, I\u2019ve just specified the same file for the releaseUrl and the debugUrl. For the dependencies property, I looked through a few source files to discover that the \u201cComponentModel\u201d key included Sys.UI.Control, which my class depends on to be created, so I added that here (hopefully this will be documented at some point).<\/p>\n<p>Next, I added code to indicate to the loader which scripts were necessary and let it determine the best way to load them:<\/p>\n<pre class=\"code\">Sys.<span style=\"color: blue\">require<\/span>([Sys.components.dataView, Sys.scripts.jQuery,<br \/> Sys.scripts.Commanding]);<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>Here, you see the \u201cCommanding\u201d key is added to a special namespace, \u201cSys.scripts.\u201d<\/p>\n<p>In the new onReady event which is raised when the DOM and scripts have been loaded, I\u2019ve added code to activate the control class I wrote:<\/p>\n<pre class=\"code\">Sys.onReady(<span style=\"color: blue\">function<\/span>() {\n    Sys.activateElements(document.documentElement);    \n});<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>Finally, I wired up that event declared above in the onbubbleevent attribute on the body element.<\/p>\n<pre class=\"code\"><span style=\"color: blue\">function <\/span>onCommand(sender, args) {\n    <span style=\"color: blue\">if <\/span>(<span style=\"color: blue\">typeof <\/span>(args) !== <span style=\"color: #a31515\">&quot;undefined&quot;<\/span>) {\n        <span style=\"color: blue\">var <\/span>commandName = args.get_commandName();\n        <span style=\"color: blue\">var <\/span>commandArgument = args.get_commandArgument();\n        alert(commandName + <span style=\"color: #a31515\">&quot; &quot; <\/span>+ commandArgument);\n    }\n}<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>OK, that\u2019s cool, but you might want to raise a command without it being triggered by a control event (such as a click). So, I added a simple function to my Commanding class:<\/p>\n<pre class=\"code\">WiredPrairie.Commanding.raiseCommand = <span style=\"color: blue\">function<\/span>(sender, commandName, commandArgument, commandSource) {\n    <span style=\"color: blue\">var <\/span>source = sender || document.body;\n    Sys.UI.DomElement.raiseBubbleEvent(source, <span style=\"color: blue\">new <\/span>Sys.CommandEventArgs(commandName, commandArgument, commandSource));\n}\n\n<span style=\"color: blue\">var <\/span>$sendCommand = WiredPrairie.Commanding.raiseCommand;<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>Because of the way the raiseBubbleEvent works, it does depend on the source being set to a valid control\/element (as raiseBubbleEvent walks through the parent chain until there aren\u2019t any more parents) \u2013 in this case, I\u2019ve defaulted to the body element.<\/p>\n<p>Finally, an enhancement to the test case above to demonstrate both receiving and sending a command:<\/p>\n<pre class=\"code\"><span style=\"color: blue\">function <\/span>onCommand(sender, args) {\n    <span style=\"color: blue\">if <\/span>(<span style=\"color: blue\">typeof <\/span>(args) !== <span style=\"color: #a31515\">&quot;undefined&quot;<\/span>) {\n        <span style=\"color: blue\">var <\/span>commandName = args.get_commandName();\n        <span style=\"color: blue\">var <\/span>commandArgument = args.get_commandArgument();\n        <span style=\"color: blue\">switch <\/span>(commandName) {\n            <span style=\"color: blue\">case <\/span><span style=\"color: #a31515\">&quot;startRunningCommand&quot;<\/span>:\n                $sendCommand(<span style=\"color: blue\">null<\/span>, <span style=\"color: #a31515\">&quot;alertCommand&quot;<\/span>, <span style=\"color: blue\">new <\/span>Date().toLocaleTimeString(), <span style=\"color: blue\">null<\/span>);\n                <span style=\"color: blue\">break<\/span>;\n            <span style=\"color: blue\">case <\/span><span style=\"color: #a31515\">&quot;alertCommand&quot;<\/span>:\n                alert(commandArgument);\n                <span style=\"color: blue\">break<\/span>;\n            <span style=\"color: blue\">default<\/span>:\n                <span style=\"color: blue\">break<\/span>;\n        }\n    }\n}<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>One command just sends another command which displays an alert. It\u2019s simple, but functional.<\/p>\n<p>Enjoy.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>There may be another way to accomplish this, but I wanted to have a simple commanding system in the Microsoft Ajax Library which worked outside of the templates. After a number of false starts and frustration brought about by very limited documentation, I discovered a reasonable implementation. I created a script file, \u201cCommanding.js\u201d (in a [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[21],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-eh","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":890,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/890","url_meta":{"origin":885,"position":0},"title":"Disabling automatic Sys.UI.Control attachment","date":"January 17, 2010","format":false,"excerpt":"If you\u2019re using the Microsoft Ajax Library (learn), you may not always want to start the automatic \u201cattach\u201d process that takes place when the page loads. It\u2019s easy to disable, but not yet documented any place I could find easily. <script src=\"Scripts\/MicrosoftAjax\/Start.debug.js\" type=\"text\/javascript\"><\/script> <script type=\"text\/javascript\"> var ajaxPath = \"\"; Sys.activateDom\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1178,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1178","url_meta":{"origin":885,"position":1},"title":"MSBuild Task Reference and Ajax Minification","date":"February 5, 2011","format":false,"excerpt":"I\u2019m not one for dumping all scripts into a single folder and calling it a day. The template project for ASP.NET MVC 3 does that unfortunately. So, after a bit of cleanup and adding a few more JavaScript libraries that I needed, I\u2019m left with a reasonably organized folder structure.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/02\/image2.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1181,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1181","url_meta":{"origin":885,"position":2},"title":"jQuery 1.5, jquery.validate and Ajax\/getJSON","date":"February 5, 2011","format":false,"excerpt":"Apparently, the new version of jQuery conflicts with the version of the jquery.validate plugin that is included with Microsoft\u2019s MVC 3 template. After a frustrating hour of debugging and using Fiddler (as I didn\u2019t realize the problem was related to a plugin I wasn\u2019t actively using on the web page),\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/02\/image3.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1820,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1820","url_meta":{"origin":885,"position":3},"title":"Knockout binding for JavaScript route fixup","date":"January 25, 2013","format":false,"excerpt":"Part one. After the first round, I felt compelled to KnockOut the code a bit more. I\u2019d mentioned I wasn\u2019t pleased with the code exactly. It needed some refactoring. So, I\u2019ve created a new Knockout binding handler. This binding handler replaces\u00a0 named parameters with a model\u2019s properties in a path.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1204,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1204","url_meta":{"origin":885,"position":4},"title":"Return of syntax highlighting and code completion for KnockoutJS in VS2010 (when using Razor)","date":"March 31, 2011","format":false,"excerpt":"OK, admittedly, this is a workaround for an issue where the syntax of jQuery Templates (used by KnockoutJS) doesn\u2019t lend itself to the most pleasant editing experience in Visual Studio, but eh. This was inspired after talking with Ryan a bit and seeing a recent post on his new web\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":426,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/426","url_meta":{"origin":885,"position":5},"title":"Visual WebGUI &#8212; Uh? Neat technology for someone else.","date":"July 16, 2008","format":false,"excerpt":"At the top of the page linked above, you can try the Ajax version or the Silverlight version of their web-mail demo. Try it. I won't say that I'm not impressed by what they've accomplished technically. It's impressive. They use a WinForms designer to build parts of the user interface\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/07\/image-thumb2.png?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/885"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=885"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/885\/revisions"}],"predecessor-version":[{"id":886,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/885\/revisions\/886"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=885"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=885"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=885"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}