{"id":1693,"date":"2012-07-31T07:29:50","date_gmt":"2012-07-31T12:29:50","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=1693"},"modified":"2012-07-31T07:33:49","modified_gmt":"2012-07-31T12:33:49","slug":"simple-node-based-http-put-simulator","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1693","title":{"rendered":"Simple Node based Http Put simulator"},"content":{"rendered":"<p>It\u2019s great what you can accomplish in a few lines of code. The <a href=\"http:\/\/nodejs.org\/\" target=\"_blank\">Node<\/a> based source code below uses <a href=\"http:\/\/expressjs.com\/\" target=\"_blank\">express<\/a> to create a mini view-based web server along with a mock Http Put file upload destination. <\/p>\n<div style=\"border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; direction: ltr; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px\" id=\"codeSnippetWrapper\">\n<pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\"><br \/><span style=\"color: #008000\">\/**<\/span><br \/><span style=\"color: #008000\"> * Module dependencies.<\/span><br \/><span style=\"color: #008000\"> *\/<\/span><br \/><br \/>var express = require(<span style=\"color: #006080\">'express'<\/span>)<br \/>  , routes = require(<span style=\"color: #006080\">'.\/routes'<\/span>)<br \/>  , http = require(<span style=\"color: #006080\">'http'<\/span>)<br \/>  , path = require(<span style=\"color: #006080\">'path'<\/span>);<br \/><br \/>var app = express();<br \/><br \/>app.configure(function(){<br \/>  app.set(<span style=\"color: #006080\">'port'<\/span>, process.env.PORT || 8080);<br \/>  app.set(<span style=\"color: #006080\">'views'<\/span>, __dirname + <span style=\"color: #006080\">'\/views'<\/span>);<br \/>  app.set(<span style=\"color: #006080\">'view engine'<\/span>, <span style=\"color: #006080\">'jade'<\/span>);<br \/>  app.use(express.favicon());<br \/>  app.use(express.logger(<span style=\"color: #006080\">'dev'<\/span>));<br \/>  app.use(express.bodyParser());<br \/>  app.use(express.methodOverride());<br \/>  app.use(app.router);<br \/>  app.use(express.<span style=\"color: #0000ff\">static<\/span>(path.join(__dirname, <span style=\"color: #006080\">'public'<\/span>)));<br \/>});<br \/><br \/>app.put(<span style=\"color: #006080\">'\/upload\/:fileUpload'<\/span>, function(req, res, next){<br \/>    console.log(<span style=\"color: #006080\">'uploading!'<\/span>);<br \/>    res.send(<span style=\"color: #006080\">'OK'<\/span>, { <span style=\"color: #006080\">'Content-Type'<\/span>: <span style=\"color: #006080\">'text\/plain'<\/span> }, 200);<br \/>});<br \/><br \/>app.configure(<span style=\"color: #006080\">'development'<\/span>, function(){<br \/>  app.use(express.errorHandler());<br \/>});<br \/><br \/>app.get(<span style=\"color: #006080\">'\/'<\/span>, routes.index);<br \/><br \/>http.createServer(app).listen(app.get(<span style=\"color: #006080\">'port'<\/span>), function(){<br \/>  console.log(<span style=\"color: #006080\">&quot;Express server listening on port &quot;<\/span> + app.get(<span style=\"color: #006080\">'port'<\/span>));<br \/>});<br \/><\/pre>\n<p><\/div>\n<p>Using <a href=\"http:\/\/www.jetbrains.com\/webstorm\/\" target=\"_blank\">WebStorm<\/a>\u2019s Node\/Express template, I only added 4 lines:<\/p>\n<div style=\"border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: consolas,&#39;Courier New&#39;, courier, monospace; direction: ltr; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px\" id=\"codeSnippetWrapper\">\n<pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\">app.put(<span style=\"color: #006080\">'\/upload\/:fileUpload'<\/span>, function(req, res, next){<br \/>    console.log(<span style=\"color: #006080\">'uploading!'<\/span>);    <br \/>    res.send(<span style=\"color: #006080\">'OK'<\/span>, { <span style=\"color: #006080\">'Content-Type'<\/span>: <span style=\"color: #006080\">'text\/plain'<\/span> }, 200);<br \/>});<br \/><\/pre>\n<p><\/div>\n<p>These 4 lines added a new route\/path for uploading a file in the pattern of \/upload\/ {fileName}.<\/p>\n<p>The response was \u201cOK.\u201d <\/p>\n<p>I\u2019d tried this same thing using ASP.NET MVC 4 (with Razor), but was stumped by the error when trying to use HttpPut on an Action in the controller.<\/p>\n<p>I was using this end-point as a mock-upload destination for my SmugMug application, <a href=\"http:\/\/www.wiredprairie.us\/SnugUp\/\" target=\"_blank\">SnugUp<\/a>. I wanted to eliminate the uploading process as it\u2019s time consuming and messes up my SmugMug galleries! <img style=\"border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none\" class=\"wlEmoticon wlEmoticon-smile\" alt=\"Smile\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/07\/wlEmoticon-smile.png\" \/><\/p>\n<p>The C# code is simple as it uses HttpWebRequest:<\/p>\n<div style=\"border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; direction: ltr; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px\" id=\"codeSnippetWrapper\">\n<pre style=\"border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px\" id=\"codeSnippet\">HttpWebRequest uploadRequest = (HttpWebRequest)WebRequest.Create(ApplicationConstants.UploadUrl + <span style=\"color: #006080\">&quot;photo.jpg&quot;<\/span>);<br \/><br \/>uploadRequest.Timeout = (<span style=\"color: #0000ff\">int<\/span>)10080 * 60 * 1000; <span style=\"color: #008000\">\/\/ 7 days <\/span><br \/>uploadRequest.Method = <span style=\"color: #006080\">&quot;PUT&quot;<\/span>;<br \/>uploadRequest.UserAgent = ApplicationConstants.UserAgent;<br \/>uploadRequest.ContentLength = fi.Length;<br \/>uploadRequest.KeepAlive = <span style=\"color: #0000ff\">true<\/span>;<\/pre>\n<p><\/div>\n<p>(SmugMug grabs the file name from a custom Http Header, so, the put URL is always \u201cphoto.jpg\u201d.)<\/p>\n","protected":false},"excerpt":{"rendered":"<p>It\u2019s great what you can accomplish in a few lines of code. The Node based source code below uses express to create a mini view-based web server along with a mock Http Put file upload destination. \/** * Module dependencies. *\/var express = require(&#8216;express&#8217;) , routes = require(&#8216;.\/routes&#8217;) , http = require(&#8216;http&#8217;) , path = [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[82,103,104,102],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-rj","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1930,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1930","url_meta":{"origin":1693,"position":0},"title":"Sending a socket to a forked process in Node.JS","date":"August 27, 2013","format":false,"excerpt":"If you want to fork a process in Node and pass a socket, the current Node documentation has a rather odd example, so I\u2019ve simplified it here for my own sanity (further complicated by the fact that the WebStorm debugger can\u2019t debug a forked Node.JS process, which confused me for\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1820,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1820","url_meta":{"origin":1693,"position":1},"title":"Knockout binding for JavaScript route fixup","date":"January 25, 2013","format":false,"excerpt":"Part one. After the first round, I felt compelled to KnockOut the code a bit more. I\u2019d mentioned I wasn\u2019t pleased with the code exactly. It needed some refactoring. So, I\u2019ve created a new Knockout binding handler. This binding handler replaces\u00a0 named parameters with a model\u2019s properties in a path.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1974,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1974","url_meta":{"origin":1693,"position":2},"title":"Loading Models in NodeJS","date":"December 2, 2013","format":false,"excerpt":"I\u2019d answered a question on StackOverflow about where to put \u201cmodels\u201d in a NodeJS project. I wanted to elaborate on the simple auto loader I use to load a folder full of models (and I use this pattern other places as well). Normally, I create a folder called models: Inside\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1754,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1754","url_meta":{"origin":1693,"position":3},"title":"Nest Thermostat API using Node JS and Nest API Update","date":"October 9, 2012","format":false,"excerpt":"I\u2019ve been asked by a few people for more details on the API Nest Labs uses for their thermostats, especially regarding setting data (and not just polling). The API uses mostly JSON formatted data POSTed to their web servers. Authentication To authenticate, POST the username and password, encoded as form\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1800,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1800","url_meta":{"origin":1693,"position":4},"title":"Named routing with Knockout, ASP.NET MVC, and AttributeRouting, from JavaScript","date":"January 24, 2013","format":false,"excerpt":"It's hard to describe exactly what I've built here, but I'm just throwing these pieces out on the Internet in case someone: a) finds them useful, or b) has a better solution. Goals: Named routes, with a wee bit of a Rails feel A Knockout friendly syntax for binding to\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1570,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1570","url_meta":{"origin":1693,"position":5},"title":"JavaScript: isScrolledIntoView","date":"March 15, 2012","format":false,"excerpt":"I needed a simple way to detect when a placeholder DIV (that would contain an image) had scrolled into the current viewport of the browser. I\u2019ve seen a few solutions that worked, and a few that didn\u2019t (hello? test your code!). Here\u2019s my simple solution: function isScrolledIntoView(elem) { elem =\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"SmugMupBrowser-live","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/03\/SmugMupBrowser-live.gif?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1693"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=1693"}],"version-history":[{"count":2,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1693\/revisions"}],"predecessor-version":[{"id":1695,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1693\/revisions\/1695"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=1693"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=1693"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=1693"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}