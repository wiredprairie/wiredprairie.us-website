{"id":2170,"date":"2017-04-04T19:57:32","date_gmt":"2017-04-05T00:57:32","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=2170"},"modified":"2018-04-23T07:49:02","modified_gmt":"2018-04-23T12:49:02","slug":"code-signing-and-self-signed-certificates-in-windows-10-with-powershell","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2170","title":{"rendered":"How to sign Powershell scripts with self-signed certificates in Windows 10"},"content":{"rendered":"<p>I wanted to allow all signed Powershell scripts to run on a PC in our house on Windows 10. To do that, I needed a code-signing certificate.<\/p>\n<p>Unfortunately, the days of easily obtaining a free code signing certificate seem to have ended. Have no fear! You can create a self-signed certificate if you don&#8217;t expect to use the certificate anywhere but on the PC where the certificate was created.<\/p>\n<p>First, I enabled Powershell scripts to run. From an administrative Powershell command prompt:<\/p>\n<pre>&gt; Set-ExecutionPolicy AllSigned<\/pre>\n<p>Acknowledge the warning and you&#8217;re ready to execute only signed scripts.<\/p>\n<p>But, if you create your own script, you&#8217;ll need to sign it. To create the necessary code-signing certificate, you&#8217;ll again use Powershell. From an administrative Powershell command prompt:<\/p>\n<pre>PS C:\\Dev&gt;New-SelfSignedCertificate -CertStoreLocation Cert:\\LocalMachine\\ -Type CodeSigningCert -Subject \"CN=PowershellScripts\" -NotAfter (Get-Date).AddYears(10)<\/pre>\n<p>You can change the Common Name (<strong>CN<\/strong>) to anything you&#8217;d like, or adjust the expiration date (using <strong>-NotAfter<\/strong>). I&#8217;ve got the expiration as 10 years from today.<\/p>\n<p>Once you&#8217;ve got the code signing certificate created as shown above, you&#8217;ll need to move the certificate to the Trusted Root Certification Authorities. If you don&#8217;t, when you sign the powershell script, it still won&#8217;t be allowed to run (and the act of signing will produce an UnknownError).<\/p>\n<p>Start the certificate manager (press Windows key, type cert, and select &#8220;<strong>Manage computer certificates<\/strong>&#8220;, or hit Windows+R, then type: &#8220;<strong>certmgr.msc<\/strong>&#8220;).<\/p>\n<p><img data-attachment-id=\"2172\" data-permalink=\"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2170\/dragcertificateintotrusted-2\" data-orig-file=\"https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/DragCertificateIntoTrusted-1.gif\" data-orig-size=\"640,397\" data-comments-opened=\"1\" data-image-meta=\"{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}\" data-image-title=\"Drag Certificate Into Trusted Root\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/DragCertificateIntoTrusted-1-300x186.gif\" data-large-file=\"https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/DragCertificateIntoTrusted-1.gif\" loading=\"lazy\" class=\"aligncenter wp-image-2172 size-full\" src=\"https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/DragCertificateIntoTrusted-1.gif\" alt=\"Drag Certificate Into Trusted Root Certification Authorities\" width=\"640\" height=\"397\" \/><\/p>\n<p>Expand Trusted Root Certification Authorities first, then expand Personal &gt; Certificates and select the PowershellScripts Code Signing certificate and then drag it into the Trusted Certificates list as shown above (or you can right click, cut, and then paste it as well).<\/p>\n<p>Now that you&#8217;ve got a trusted code signing cetificate, you can sign your Powershell scripts.<\/p>\n<p>If you&#8217;ve only got one code signing certificate (which I presume you do otherwise you wouldn&#8217;t have needed a new one), from an administrative Powershell command prompt first switch directories to where the script you want to sign is located, then do these commands:<\/p>\n<pre>&gt; $cert = (Get-ChildItem Cert:\\LocalMachine\\my -CodeSigningCert)[0]<\/pre>\n<pre>&gt;\u00a0Set-AuthenticodeSignature .\\reconnect-iscsi-targets.ps1 $cert<\/pre>\n<p>You should then see a table with the <strong>SignerCertificate<\/strong>, <strong>Status<\/strong>, and the <strong>Path<\/strong>. If everything went well, the Status should be\u00a0<strong>Valid.<\/strong><\/p>\n<p><a href=\"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2165\">Here&#8217;s<\/a> something interesting you can do with iSCSI targets and PowerShell using a signed PowerShell script.<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I wanted to allow all signed Powershell scripts to run on a PC in our house on Windows 10. To do that, I needed a code-signing certificate. Unfortunately, the days of easily obtaining a free code signing certificate seem to have ended. Have no fear! You can create a self-signed certificate if you don&#8217;t expect [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[5,173],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-z0","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":2165,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2165","url_meta":{"origin":2170,"position":0},"title":"Automatic Reconnection of iSCSI Targets in Windows 10 using PowerShell","date":"April 4, 2017","format":false,"excerpt":"When my highly recommended Synology Disk Station reboots for a required update (I've got it set to automatically reboot), a shared Windows 10 PC in our house cannot always successfully reconnect to the iSCSI targets without manual intervention. Unfortunately, I haven't always noticed which has led to several features of\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/2017-04-04_19-07-23.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":288,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/288","url_meta":{"origin":2170,"position":1},"title":"WPF and Powershell Series &#8212; I don&#8217;t get it.","date":"May 24, 2008","format":false,"excerpt":"I don't get it. Maybe it will become clear as the series progresses, but the idea of a powershell cmdlets, etc. powering a WPF front end doesn't make sense to me. I thought the whole idea idea of Powershell was that it was a shell plaform -- an advanced command\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1541,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1541","url_meta":{"origin":2170,"position":2},"title":"Adobe Lightroom and exporting to subfolders","date":"February 8, 2012","format":false,"excerpt":"For some reason, versions 1 \u2013 3 of Adobe Lightroom cannot export images in a way that mirrors the original structure of your photo library. I can\u2019t offer a reason why other than it was missed by the development and design teams. There\u2019s been enough interest in it apparently that\u2026","rel":"","context":"In &quot;Photography&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/02\/image2.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":2070,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2070","url_meta":{"origin":2170,"position":3},"title":"Customize the External VS Code Console","date":"November 11, 2016","format":false,"excerpt":"I have Visual Studio 2015 installed and when I launch a command prompt on Windows, it\u2019s generally the Visual Studio 2015 Developer Command prompt (in fact, I have it pinned to my Windows 10 task bar). On Windows, using Visual Studio Code 1.7+, pressing SHIFT+CTRL+C opens a Windows Command prompt\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2016\/11\/image_thumb.png?resize=350%2C200&ssl=1","width":350,"height":200},"classes":[]},{"id":331,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/331","url_meta":{"origin":2170,"position":4},"title":"Velocity &#8212; a rockin&#8217; distributed in memory cache for ASP.NET","date":"June 3, 2008","format":false,"excerpt":"Velocity, the code-name for a new in-memory distributed caching system for ASP.NET was released as a Community Tech Preview today. What is it? It's described in the documentation: Microsoft project code named \"Velocity\" provides a highly scalable in-memory application cache for all kinds of data. By using cache, your application\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image-thumb.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":906,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/906","url_meta":{"origin":2170,"position":5},"title":"Valid Trust Anchor?","date":"March 5, 2010","format":false,"excerpt":"On the off chance someone understands this error and can help, I\u2019m posting the wifi errors my Windows 7 Ultimate laptops started to encounter at work on wifi. My laptop is not part of the corporate domain (as it\u2019s a personal laptop). Until very recently, everything worked without any trouble,\u2026","rel":"","context":"In &quot;General&quot;","img":{"alt_text":"Network Authentication","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2010\/03\/image1.png?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/2170"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=2170"}],"version-history":[{"count":6,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/2170\/revisions"}],"predecessor-version":[{"id":2254,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/2170\/revisions\/2254"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=2170"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=2170"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=2170"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}