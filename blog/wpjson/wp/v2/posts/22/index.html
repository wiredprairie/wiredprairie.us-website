{"id":22,"date":"2008-03-02T09:13:20","date_gmt":"2008-03-02T15:13:20","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/post.aspx?id=c7dc047f-e6c7-45e2-9303-532c8d6ad48c"},"modified":"2008-09-17T20:43:28","modified_gmt":"2008-09-18T01:43:28","slug":"converting-a-mapped-drive-letter-to-a-network-path-using-c","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/22","title":{"rendered":"Converting a mapped drive letter to a network path using C#"},"content":{"rendered":"<p>Occasionally you might have the need to convert a mapped drive letter to a UNC or network path. For example, a drive letter such as&nbsp; &#8220;Z&#8221; might be mapped to a network share:<\/p>\n<p><a href=\"http:\/\/www.wiredprairie.us\/blog\/image.axd?picture=WindowsLiveWriter\/Convertingamappeddrivelettertoanetworkpa_D608\/image_2.png\"><img loading=\"lazy\" style=\"border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px\" border=\"0\" alt=\"image\" src=\"http:\/\/www.wiredprairie.us\/blog\/image.axd?picture=WindowsLiveWriter\/Convertingamappeddrivelettertoanetworkpa_D608\/image_thumb.png\" width=\"113\" height=\"130\"\/><\/a><\/p>\n<p>In this example, the &#8220;Z&#8221; drive is mapped to a &#8220;Personal&#8221; folder on a server named &#8220;Home&#8221;.<\/p>\n<p>If you want to store for example a UNC path to a file rather than a drive letter, you&#8217;ll need to convert the &#8220;Z&#8221; drive to the corresponding UNC root path. Here&#8217;s the C# code I wrote to do this:<\/p>\n<pre class=\"code\"><span style=\"color: blue\">using <\/span>System;\n<span style=\"color: blue\">using <\/span>System.Collections.Generic;\n<span style=\"color: blue\">using <\/span>System.Linq;\n<span style=\"color: blue\">using <\/span>System.Text;\n<span style=\"color: blue\">using <\/span>System.Runtime.InteropServices;\n<span style=\"color: blue\">using <\/span>System.IO;\n\n<span style=\"color: blue\">namespace <font color=\"#000000\">WiredPrairie.Samples<\/font><\/span>\n{\n    <span style=\"color: blue\">public static class <\/span><span style=\"color: #2b91af\">Pathing\n    <\/span>{\n        [<span style=\"color: #2b91af\">DllImport<\/span>(<span style=\"color: #a31515\">\"mpr.dll\"<\/span>, CharSet = <span style=\"color: #2b91af\">CharSet<\/span>.Unicode, SetLastError = <span style=\"color: blue\">true<\/span>)]\n        <span style=\"color: blue\">public static extern int <\/span>WNetGetConnection(\n            [<span style=\"color: #2b91af\">MarshalAs<\/span>(<span style=\"color: #2b91af\">UnmanagedType<\/span>.LPTStr)] <span style=\"color: blue\">string <\/span>localName, \n            [<span style=\"color: #2b91af\">MarshalAs<\/span>(<span style=\"color: #2b91af\">UnmanagedType<\/span>.LPTStr)] <span style=\"color: #2b91af\">StringBuilder <\/span>remoteName, \n            <span style=\"color: blue\">ref int <\/span>length);\n        <span style=\"color: gray\">\/\/\/ &lt;summary&gt;\n        \/\/\/ <\/span><span style=\"color: green\">Given a path, returns the UNC path or the original. (No exceptions\n        <\/span><span style=\"color: gray\">\/\/\/ <\/span><span style=\"color: green\">are raised by this function directly). For example, \"P:\\2008-02-29\"\n        <\/span><span style=\"color: gray\">\/\/\/ <\/span><span style=\"color: green\">might return: \"\\\\networkserver\\Shares\\Photos\\2008-02-09\"\n        <\/span><span style=\"color: gray\">\/\/\/ &lt;\/summary&gt;\n        \/\/\/ &lt;param name=\"originalPath\"&gt;<\/span><span style=\"color: green\">The path to convert to a UNC Path<\/span><span style=\"color: gray\">&lt;\/param&gt;\n        \/\/\/ &lt;returns&gt;<\/span><span style=\"color: green\">A UNC path. If a network drive letter is specified, the\n        <\/span><span style=\"color: gray\">\/\/\/ <\/span><span style=\"color: green\">drive letter is converted to a UNC or network path. If the \n        <\/span><span style=\"color: gray\">\/\/\/ <\/span><span style=\"color: green\">originalPath cannot be converted, it is returned unchanged.<\/span><span style=\"color: gray\">&lt;\/returns&gt;\n        <\/span><span style=\"color: blue\">public static string <\/span>GetUNCPath(<span style=\"color: blue\">string <\/span>originalPath)\n        {\n            <span style=\"color: #2b91af\">StringBuilder <\/span>sb = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">StringBuilder<\/span>(512);\n            <span style=\"color: blue\">int <\/span>size = sb.Capacity;\n\n            <span style=\"color: green\">\/\/ look for the {LETTER}: combination ...\n            <\/span><span style=\"color: blue\">if <\/span>(originalPath.Length &gt; 2 &amp;&amp; originalPath[1] == <span style=\"color: #a31515\">':'<\/span>)\n            {\n                <span style=\"color: green\">\/\/ don't use char.IsLetter here - as that can be misleading\n                \/\/ the only valid drive letters are a-z &amp;&amp; A-Z.\n                <\/span><span style=\"color: blue\">char <\/span>c = originalPath[0];\n                <span style=\"color: blue\">if <\/span>((c &gt;= <span style=\"color: #a31515\">'a' <\/span>&amp;&amp; c &lt;= <span style=\"color: #a31515\">'z'<\/span>) || (c &gt;= <span style=\"color: #a31515\">'A' <\/span>&amp;&amp; c &lt;= <span style=\"color: #a31515\">'Z'<\/span>))\n                {\n                    <span style=\"color: blue\">int <\/span>error = WNetGetConnection(originalPath.Substring(0, 2), \n                        sb, <span style=\"color: blue\">ref <\/span>size);\n                    <span style=\"color: blue\">if <\/span>(error == 0)\n                    {                        \n                        <span style=\"color: #2b91af\">DirectoryInfo <\/span>dir = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">DirectoryInfo<\/span>(originalPath);\n\n                        <span style=\"color: blue\">string <\/span>path = <span style=\"color: #2b91af\">Path<\/span>.GetFullPath(originalPath)\n                            .Substring(<span style=\"color: #2b91af\">Path<\/span>.GetPathRoot(originalPath).Length);\n                        <span style=\"color: blue\">return <\/span><span style=\"color: #2b91af\">Path<\/span>.Combine(sb.ToString().TrimEnd(), path);\n                    }\n                }\n            }\n            \n            <span style=\"color: blue\">return <\/span>originalPath;\n        }\n    }\n}\n<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>All of the magic takes place in a Windows API function call, WNetGetConnection.<\/p>\n<p>I&#8217;m using this function so that I can verify that given two file names, I can be assured that they are pointing to the same physical location. (Is &#8220;Z:\\Backups\\Backup1.zip&#8221; the same as &#8220;\\\\home\\Personal\\Backups\\Backup1.zip&#8221;). <\/p>\n","protected":false},"excerpt":{"rendered":"<p>Occasionally you might have the need to convert a mapped drive letter to a UNC or network path. For example, a drive letter such as&nbsp; &#8220;Z&#8221; might be mapped to a network share: In this example, the &#8220;Z&#8221; drive is mapped to a &#8220;Personal&#8221; folder on a server named &#8220;Home&#8221;. If you want to store [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-m","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1592,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1592","url_meta":{"origin":22,"position":0},"title":"Get path or location of currently executing batch\/command file in Windows","date":"April 1, 2012","format":false,"excerpt":"I didn\u2019t know it was this simple, and am posting this information on my blog so I find it in the future, but hopefully this will help someone else! I\u2019ve created a number of batch files over the years which routinely copy files from one location to another, usually as\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":2165,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2165","url_meta":{"origin":22,"position":1},"title":"Automatic Reconnection of iSCSI Targets in Windows 10 using PowerShell","date":"April 4, 2017","format":false,"excerpt":"When my highly recommended Synology Disk Station reboots for a required update (I've got it set to automatically reboot), a shared Windows 10 PC in our house cannot always successfully reconnect to the iSCSI targets without manual intervention. Unfortunately, I haven't always noticed which has led to several features of\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/2017-04-04_19-07-23.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1084,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1084","url_meta":{"origin":22,"position":2},"title":"Silverlight Analog\/Retro Flip Numbers","date":"June 9, 2010","format":false,"excerpt":"I\u2019m not sure what to call these exactly. I\u2019ve created a relatively simple Silverlight 4 control that emulates the old mechanical flip style numbers (or letters) displays found at airports and in old clock-radios. I call it the RetroFlipper. It\u2019s easy to use (at least for my needs). Declare an\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2010\/06\/image.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1524,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1524","url_meta":{"origin":22,"position":3},"title":"Alternative to ApplicationSettings in .NET","date":"February 1, 2012","format":false,"excerpt":"After dealing with lost settings, an unclear upgrade path, and my own confusion surrounding the magic of Settings in a .NET client application, I decided to build my own. You\u2019re probably familiar with this UI in Visual Studio. It hasn\u2019t changed much since it was first created: A list of\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/02\/image.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1820,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1820","url_meta":{"origin":22,"position":4},"title":"Knockout binding for JavaScript route fixup","date":"January 25, 2013","format":false,"excerpt":"Part one. After the first round, I felt compelled to KnockOut the code a bit more. I\u2019d mentioned I wasn\u2019t pleased with the code exactly. It needed some refactoring. So, I\u2019ve created a new Knockout binding handler. This binding handler replaces\u00a0 named parameters with a model\u2019s properties in a path.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1442,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1442","url_meta":{"origin":22,"position":5},"title":"Nest Thermostat API\/Protocol","date":"January 8, 2012","format":false,"excerpt":"While Nest Labs hasn\u2019t released a formal (documented & supported) API, I thought I\u2019d do a bit of digging to see how they\u2019re using the network and what might be achievable. A few things are going on, the majority as you\u2019d probably expect. The web interface is using a long\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/image_thumb7.png?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/22"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=22"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/22\/revisions"}],"predecessor-version":[{"id":1678,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/22\/revisions\/1678"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=22"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=22"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=22"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}