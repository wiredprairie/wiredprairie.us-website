{"id":448,"date":"2008-08-01T07:49:46","date_gmt":"2008-08-01T12:49:46","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/448"},"modified":"2008-08-01T07:49:46","modified_gmt":"2008-08-01T12:49:46","slug":"silverlight-20-adjusting-ui-when-animation-completes","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/448","title":{"rendered":"Silverlight 2.0 &#8212; Adjusting UI when Animation completes"},"content":{"rendered":"<p>I&#8217;ve discussed how to locate the UIElement associated with an <a href=\"http:\/\/www.wiredprairie.us\/journal\/2006\/10\/how_to_know_when_your_animatio.html\">animation&#8217;s Completed<\/a> event a while back for WPF. <\/p>\n<p>Here&#8217;s an update for how I do the same thing in Silverlight 2.0. The technique could be used in WPF with a few minor tweaks. I like this method rather than relying on a Storyboard (as I have better control over the completion of individual animations this way). <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/cc189069(VS.95).aspx\">Here&#8217;s<\/a> a page on MSDN that describes various ways to work with animations programmatically in Silverlight.<\/p>\n<p>The <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/system.windows.media.animation.timeline.completed(VS.95).aspx\">Completed<\/a> event is raised when the animation timeline has ended. The event unfortunately passes only a reference to the sender (which is the Timeline). The EventArgs is empty.<\/p>\n<p>Here&#8217;s a chunk of code that sets up an animation programmatically:<\/p>\n<pre class=\"code\"><span style=\"color: #2b91af\">BitmapImage <\/span>bmimg = sender <span style=\"color: blue\">as <\/span><span style=\"color: #2b91af\">BitmapImage<\/span>;\n\n<span style=\"color: #2b91af\">Game<\/span>.Dispatcher.BeginInvoke(<span style=\"color: blue\">delegate<\/span>()\n{\n    <span style=\"color: #2b91af\">DoubleAnimation <\/span>animation = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">DoubleAnimation<\/span>();\n    animation.To = 0.0;\n    animation.From = 1.0;\n    animation.Duration = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">Duration<\/span>(<span style=\"color: #2b91af\">TimeSpan<\/span>.FromSeconds(2 + <span style=\"color: #2b91af\">Game<\/span>.Randomizer.Next(5)));\n    animation.SetValue(<span style=\"color: #2b91af\">Page<\/span>.ImageProperty, bmimg);\n    animation.Completed += <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">EventHandler<\/span>(animation_Completed);\n\n    <span style=\"color: #2b91af\">Image <\/span>img = bmimg.GetValue(<span style=\"color: #2b91af\">Page<\/span>.ImageProperty) <span style=\"color: blue\">as <\/span><span style=\"color: #2b91af\">Image<\/span>;\n    <span style=\"color: #2b91af\">Storyboard <\/span>sb = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">Storyboard<\/span>();\n    sb.Children.Add(animation);\n    <span style=\"color: #2b91af\">Storyboard<\/span>.SetTarget(animation, img);\n    <span style=\"color: #2b91af\">Storyboard<\/span>.SetTargetProperty(animation, <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">PropertyPath<\/span>(<span style=\"color: #a31515\">\"Opacity\"<\/span>));\n    sb.Begin();\n});\n}\n<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>The significant line above is the animation SetValue. Here, I&#8217;m using the power of the Dependency Object. I can attach new properties to the animation directly! <\/p>\n<pre class=\"code\"><span style=\"color: blue\">public static readonly <\/span><span style=\"color: #2b91af\">DependencyProperty <\/span>ImageProperty =\n    <span style=\"color: #2b91af\">DependencyProperty<\/span>.RegisterAttached(<span style=\"color: #a31515\">\"Image\"<\/span>, <span style=\"color: blue\">typeof<\/span>(<span style=\"color: #2b91af\">DependencyObject<\/span>), <span style=\"color: blue\">typeof<\/span>(<span style=\"color: #2b91af\">Page<\/span>), <span style=\"color: blue\">null<\/span>);\n<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>I&#8217;ve created a new DependencyProperty (as an attached property) called ImageProperty. There&#8217;s not much meaning to the name &#8212; other than it makes sense in the context in which I&#8217;m using it in the larger application.<\/p>\n<pre class=\"code\"><span style=\"color: blue\">void <\/span>animation_Completed(<span style=\"color: blue\">object <\/span>sender, <span style=\"color: #2b91af\">EventArgs <\/span>e)\n{\n    <span style=\"color: #2b91af\">Timeline <\/span>t = sender <span style=\"color: blue\">as <\/span><span style=\"color: #2b91af\">Timeline<\/span>;   \n    <span style=\"color: blue\">if <\/span>(t != <span style=\"color: blue\">null<\/span>)\n    {\n        <span style=\"color: #2b91af\">BitmapImage <\/span>img = t.GetValue(<span style=\"color: #2b91af\">Page<\/span>.ImageProperty) <span style=\"color: blue\">as <\/span><span style=\"color: #2b91af\">BitmapImage<\/span>;\n        <span style=\"color: blue\">if <\/span>(img != <span style=\"color: blue\">null<\/span>)\n        {\n            <span style=\"color: green\">\/\/ do something here...\n        <\/span>}\n    }\n}  <\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>In the completed event, I retrieve the attached property&#8217;s value from the animation (which I&#8217;ve cast to one of the base types, a <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/system.windows.media.animation.timeline(VS.95).aspx\">Timeline<\/a>). Then, you could do whatever you want&#8230;.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I&#8217;ve discussed how to locate the UIElement associated with an animation&#8217;s Completed event a while back for WPF. Here&#8217;s an update for how I do the same thing in Silverlight 2.0. The technique could be used in WPF with a few minor tweaks. I like this method rather than relying on a Storyboard (as I [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-7e","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1701,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1701","url_meta":{"origin":448,"position":0},"title":"Windows 8 WinRT\/Metro Missing UpdateSourceTrigger","date":"August 5, 2012","format":false,"excerpt":"If you\u2019ve done WPF or Silverlight programming, you may have found an occasion where using the Binding property UpdateSourceTrigger set to PropertyChanged was extremely useful. (I know I have!) It may have looked something like this: <TextBox Text=\"{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}\" \/> The key feature was the live updating of the\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":568,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/568","url_meta":{"origin":448,"position":1},"title":"Data Binding and Tooltips in Silverlight","date":"September 19, 2008","format":false,"excerpt":"Have you ever wanted to databind a tooltip in Silverlight (or WPF for that matter), and found that the DataContext isn't available for tooltips (the datacontext is null)? It's very annoying. Tooltips, unfortunately, aren't connected to their parents in anyway when they're created, so they loose the ability to connect\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":633,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/633","url_meta":{"origin":448,"position":2},"title":"A Silverlight 2 TilePanel","date":"December 14, 2008","format":false,"excerpt":"You may notice that the Silverlight TileBrush is missing some key properties which would enable it to actually tile a brush. The WPF TileBrush has properties such as TileMode, Viewbox, and ViewportUnits that can be used to tile an image as a fill or as a background for a UIElement.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/12\/image1.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1016,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1016","url_meta":{"origin":448,"position":3},"title":"Silverlight vs. Flash vs. Photoshop Text Rendering","date":"March 24, 2010","format":false,"excerpt":"Curious about text rendering characteristics between Flash 10, Silverlight 4.0 and Photoshop, I created two small applications, one in Flash CS 4, and one in Visual Studio 2010. The Silverlight 4.0 tests are using the release candidate which was current as of March 23, 2010. I used Times New Roman\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2010\/03\/image_thumb.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":668,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/668","url_meta":{"origin":448,"position":4},"title":"Silverlight Stars\/Sparkles","date":"January 18, 2009","format":false,"excerpt":"I was in a \u201cstar\u201d mood this afternoon and created this Silverlight 2.0 demonstration. For rendering it uses the CompositionTarget.Rendering method (the easiest way to control dynamic animations such as this). It also uses the VisualStateManager in a variety of places to control the user interface. I\u2019ve become a big\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2009\/01\/image7.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":388,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/388","url_meta":{"origin":448,"position":5},"title":"Silverlight Weather Demonstration","date":"June 26, 2008","format":false,"excerpt":"Demonstration available here. (You'll need to wait for a moment while it loads the first time). I've created a reasonably simple, yet multi-technology (and discipline) demonstration using Silverlight for the user interface and ASP.NET as the back-end. The demonstration uses: Silverlight 2.0 Data binding Delayed downloading of images \"Web services\"\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image21.png?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/448"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=448"}],"version-history":[{"count":0,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/448\/revisions"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=448"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=448"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=448"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}