{"id":1565,"date":"2012-03-10T09:50:56","date_gmt":"2012-03-10T15:50:56","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=1565"},"modified":"2012-03-10T09:50:58","modified_gmt":"2012-03-10T15:50:58","slug":"knockout-js-dictionaryindex-and-observablearray-part-2","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1565","title":{"rendered":"Knockout.JS: Dictionary\/Index and ObservableArray, Part 2"},"content":{"rendered":"<p><a href=\"http:\/\/www.knockmeout.net\/\">Ryan<\/a> suggested an alternative in a comment (and corresponding jsFiddle) to the technique that I\u2019d used in my previous Knockout.JS <a href=\"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1563\">post<\/a>.<\/p>\n<p>Following his suggestion, I made a few tweaks to my original function (and renamed it yet again):<\/p>\n<pre class=\"code\">ko.observableArray.fn.withIndex = <span style=\"color: blue\">function <\/span>(keyName) {        \n    <span style=\"color: blue\">var <\/span>index = ko.computed(<span style=\"color: blue\">function <\/span>() {\n        <span style=\"color: blue\">var <\/span>list = <span style=\"color: blue\">this<\/span>() || [];    <span style=\"color: #006400\">\/\/ the internal array\n        <\/span><span style=\"color: blue\">var <\/span>keys = {};              <span style=\"color: #006400\">\/\/ a place for key\/value\n        <\/span>ko.utils.arrayForEach(list, <span style=\"color: blue\">function <\/span>(v) {\n            <span style=\"color: blue\">if <\/span>(keyName) {          <span style=\"color: #006400\">\/\/ if there is a key\n                <\/span>keys[v[keyName]] = v;    <span style=\"color: #006400\">\/\/ use it\n            <\/span>} <span style=\"color: blue\">else <\/span>{\n                keys[v] = v;\n            }\n        });\n        <span style=\"color: blue\">return <\/span>keys;\n    }, <span style=\"color: blue\">this<\/span>);\n\n    <span style=\"color: #006400\">\/\/ also add a handy add on function to find\n    \/\/ by key ... uses a closure to access the \n    \/\/ index function created above\n    <\/span><span style=\"color: blue\">this<\/span>.findByKey = <span style=\"color: blue\">function <\/span>(key) {\n        <span style=\"color: blue\">return <\/span>index()[key];\n    };\n\n    <span style=\"color: blue\">return this<\/span>;\n};<\/pre>\n<p>To use, just tag on the withIndex function call:<\/p>\n<pre class=\"code\"><span style=\"color: blue\">var <\/span>ViewModel = <span style=\"color: blue\">function <\/span>() {\n    <span style=\"color: blue\">this<\/span>.uniqueNumber = 0;\n    <span style=\"color: blue\">this<\/span>.list = ko.observableArray([]).withIndex(<span style=\"color: maroon\">'id'<\/span>);\n};<\/pre>\n<p>In the example above, the objects stored in the \u201clist\u201d observableArray will be indexed by the \u201cid\u201d property.<\/p>\n<p>By adding the <strong>withIndex<\/strong> function call to the <strong>observableArray<\/strong> creation, an additional function is added to the array object, <strong>findByKey<\/strong>. <\/p>\n<pre class=\"code\">$(<span style=\"color: maroon\">&quot;#btnAdd&quot;<\/span>).on(<span style=\"color: maroon\">&quot;click&quot;<\/span>, <span style=\"color: blue\">function <\/span>() {\n    <span style=\"color: blue\">var <\/span>id = vm.uniqueNumber++;\n    vm.list.push({\n            id: id,\n            time: <span style=\"color: blue\">new <\/span>Date().toLocaleTimeString()});\n    <span style=\"color: blue\">var <\/span>data = vm.list.findByKey(id);\n});<\/pre>\n<p>In the above example, a new \u201clog\u201d object is added to the list, and then retrieved by the key a moment later (dumb, yes, but hopefully instructive). <\/p>\n<p>I intentionally added the findByKey only to array instances that include the indexing functionality added by <strong>withIndex<\/strong>. One reason was to not have the function be available for all arrays (as it doesn\u2019t work for non-indexed arrays) and the second was that it makes possible a bit of slick JavaScript closure value hiding. This way, the index is never stored anywhere on the original view model. Instead, it\u2019s kept entirely within the closure. <\/p>\n<p>But there\u2019s more! <\/p>\n<p>What if you want to have multiple keys or don\u2019t like the name of the find function?<\/p>\n<p>Here\u2019s the kicked up a notch version:<\/p>\n<pre class=\"code\">ko.observableArray.fn.withIndex = <span style=\"color: blue\">function <\/span>(keyName, useName) {\n    <span style=\"color: #006400\">\/\/\/ keyName == the name of the property used as the index\n    \/\/\/            value.\n    \/\/\/ useName == when false, a function named findByKey \n    \/\/\/            is added to the observableArray.\n    \/\/\/            when true, the function is named based\n    \/\/\/            on the name of the index property &amp;\n    \/\/\/            capitalized (like id becomes findById)\n    <\/span><span style=\"color: blue\">var <\/span>index = ko.computed(<span style=\"color: blue\">function <\/span>() {\n        <span style=\"color: blue\">var <\/span>list = <span style=\"color: blue\">this<\/span>() || [];    <span style=\"color: #006400\">\/\/ the internal array\n        <\/span><span style=\"color: blue\">var <\/span>keys = {};              <span style=\"color: #006400\">\/\/ a place for key\/value\n        <\/span>ko.utils.arrayForEach(list, <span style=\"color: blue\">function <\/span>(v) {\n            <span style=\"color: blue\">if <\/span>(keyName) {          <span style=\"color: #006400\">\/\/ if there is a key\n                <\/span>keys[v[keyName]] = v;    <span style=\"color: #006400\">\/\/ use it\n            <\/span>} <span style=\"color: blue\">else <\/span>{\n                keys[v] = v;\n            }\n        });\n        <span style=\"color: blue\">return <\/span>keys;\n    }, <span style=\"color: blue\">this<\/span>);\n\n    <span style=\"color: blue\">var <\/span>fnName = <span style=\"color: maroon\">&quot;&quot;<\/span>;\n    <span style=\"color: blue\">if <\/span>(useName &amp;&amp; keyName) {\n        <span style=\"color: blue\">var <\/span>cap = keyName.substr(0, 1).toUpperCase();\n        <span style=\"color: blue\">if <\/span>(keyName.length &gt; 1) {\n            fnName = cap + keyName.substring(1);\n        } <span style=\"color: blue\">else <\/span>{\n            fnName = cap;\n        }\n    } <span style=\"color: blue\">else <\/span>{\n        fnName = <span style=\"color: maroon\">&quot;Key&quot;<\/span>;\n    }\n\n    <span style=\"color: blue\">var <\/span>fnName = <span style=\"color: maroon\">&quot;findBy&quot; <\/span>+ fnName;\n    <span style=\"color: blue\">this<\/span>[fnName] = <span style=\"color: blue\">function <\/span>(key) {\n        <span style=\"color: blue\">return <\/span>index()[key];\n    };\n\n    <span style=\"color: blue\">return this<\/span>;\n};<\/pre>\n<p>This optionally uses the name of the key parameter to build a findByXYZ function using the pattern of findBy{KeyName}. It also capitalizes the function name to follow typical JavaScript coding conventions. Here it is in when initialized:<\/p>\n<pre class=\"code\"><span style=\"color: blue\">this<\/span>.list = ko.observableArray([])\n                .withIndex(<span style=\"color: maroon\">'id'<\/span>, <span style=\"color: blue\">true<\/span>)\n                .withIndex(<span style=\"color: maroon\">'time'<\/span>, <span style=\"color: blue\">true<\/span>);<\/pre>\n<p>(note that they\u2019re chained above) \u2026 and in use:<\/p>\n<pre class=\"code\"><span style=\"color: blue\">var <\/span>data = vm.list.findById(id);\ndata = vm.list.findByTime(time);<\/pre>\n<p>You\u2019ll see how the \u201cfindBy\u201d functions are named \u201cfindById\u201d and \u201cfindByTime\u201d as the original call to \u201cwithIndex\u201d used the optional second parameter set to <strong>true<\/strong>. I suppose this follows a tiny bit of the automatic mix-in style of Ruby on Rails (but is optional).<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Ryan suggested an alternative in a comment (and corresponding jsFiddle) to the technique that I\u2019d used in my previous Knockout.JS post. Following his suggestion, I made a few tweaks to my original function (and renamed it yet again): ko.observableArray.fn.withIndex = function (keyName) { var index = ko.computed(function () { var list = this() || []; [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[76,75,77,38,74],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-pf","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1563,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1563","url_meta":{"origin":1565,"position":0},"title":"Knockout.JS: AsDictionary","date":"March 9, 2012","format":false,"excerpt":"I frequently find that I have an array of objects in JavaScript that I want to display in a particular order and also have the ability to quickly locate an object by an ID or a key (and not use the indexOf function). As my recent project is using Knockout.JS,\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/03\/image3.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1836,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1836","url_meta":{"origin":1565,"position":1},"title":"Smarter queuing of files using jQuery deferred and when","date":"February 13, 2013","format":false,"excerpt":"I had a somewhat simple need \u2026a single web page style application using Backbone.JS had multiple template files it needed to download, if and only if the files hadn\u2019t already been downloaded before. While I suppose I could have relied on browser caching, I wanted to manage the requests in\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1820,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1820","url_meta":{"origin":1565,"position":2},"title":"Knockout binding for JavaScript route fixup","date":"January 25, 2013","format":false,"excerpt":"Part one. After the first round, I felt compelled to KnockOut the code a bit more. I\u2019d mentioned I wasn\u2019t pleased with the code exactly. It needed some refactoring. So, I\u2019ve created a new Knockout binding handler. This binding handler replaces\u00a0 named parameters with a model\u2019s properties in a path.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":688,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/688","url_meta":{"origin":1565,"position":3},"title":"Calculating the distance between two Zip Codes in C#","date":"January 24, 2009","format":false,"excerpt":"How far is it from the USA Zip code 90210 to 73487 (by drawing a line, not by driving)? Unfortunately, there are many classes built into the .NET framework, but a zip code distance calculator isn\u2019t included. So, you\u2019d be forced to roll your own if you want to programatically\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2009\/01\/image17.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1570,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1570","url_meta":{"origin":1565,"position":4},"title":"JavaScript: isScrolledIntoView","date":"March 15, 2012","format":false,"excerpt":"I needed a simple way to detect when a placeholder DIV (that would contain an image) had scrolled into the current viewport of the browser. I\u2019ve seen a few solutions that worked, and a few that didn\u2019t (hello? test your code!). Here\u2019s my simple solution: function isScrolledIntoView(elem) { elem =\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"SmugMupBrowser-live","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/03\/SmugMupBrowser-live.gif?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1345,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1345","url_meta":{"origin":1565,"position":5},"title":"Creating a simple Entity Reference system for Ember.js","date":"December 28, 2011","format":false,"excerpt":"I had some data stored in a structure similar to this: Nothing too fancy. A table of Gift(s) and a table of Person(s). Each gift had a foreign key relationship to a Person (the person who \u201cgave\u201d the gift). Since some people may give several gifts, I didn\u2019t want to\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1565"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=1565"}],"version-history":[{"count":2,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1565\/revisions"}],"predecessor-version":[{"id":1765,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1565\/revisions\/1765"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=1565"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=1565"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=1565"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}