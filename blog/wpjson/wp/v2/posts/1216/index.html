{"id":1216,"date":"2011-07-13T07:50:49","date_gmt":"2011-07-13T12:50:49","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1216"},"modified":"2012-01-04T19:58:22","modified_gmt":"2012-01-05T01:58:22","slug":"sending-an-email-using-smtp-in-net-4-0","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1216","title":{"rendered":"Sending an email using SMTP in .NET 4.0"},"content":{"rendered":"<p>I had need of sending embedded images within an e-mail. .NET has had a few handy classes for sending an email using SMTP for a few versions. While there were a few examples floating around the internet, none were as clean and easy to follow as I expected. So, I decided to create a simple sample application in C# which demonstrates how to embed an image (or other content) in a email that contains both plain text and HTML content. It\u2019s really not difficult. A number of examples ignore the fact that almost all of the objects need to be disposed, so I corrected that. This code is intentionally written synchronously to keep the sample simpler and easier to follow (and I didn\u2019t need asynchronous sending for my learning exercise). <\/p>\n<p><img loading=\"lazy\" style=\"background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/07\/image.png\" width=\"289\" height=\"142\" \/><\/p>\n<p>Above is the output (if you happen to have a picture of NYC). The example code uses Gmail as the SMTP host (it has the settings that generally work for gmail in most situations, including using SSL).<\/p>\n<pre class=\"code\"><span style=\"color: blue\">using <\/span>System;\n<span style=\"color: blue\">using <\/span>System.Collections.Generic;\n<span style=\"color: blue\">using <\/span>System.Linq;\n<span style=\"color: blue\">using <\/span>System.Text;\n<span style=\"color: blue\">using <\/span>System.Net.Mail;\n<span style=\"color: blue\">using <\/span>System.Net;\n<span style=\"color: blue\">using <\/span>System.Net.Mime;\n\n<span style=\"color: blue\">namespace <\/span>TestEmailAttachments\n{\n    <span style=\"color: blue\">public class <\/span><span style=\"color: #2b91af\">EmailSettings\n    <\/span>{\n        <span style=\"color: blue\">public string <\/span>ToAddress { <span style=\"color: blue\">get<\/span>; <span style=\"color: blue\">set<\/span>; }\n        <span style=\"color: blue\">public string <\/span>FromAddress { <span style=\"color: blue\">get<\/span>; <span style=\"color: blue\">set<\/span>; }\n        <span style=\"color: blue\">public string <\/span>AccountName { <span style=\"color: blue\">get<\/span>; <span style=\"color: blue\">set<\/span>; }\n        <span style=\"color: blue\">public string <\/span>AccountPassword { <span style=\"color: blue\">get<\/span>; <span style=\"color: blue\">set<\/span>; }\n    }\n\n    <span style=\"color: blue\">class <\/span><span style=\"color: #2b91af\">Program\n    <\/span>{\n        <span style=\"color: blue\">static void <\/span>Main(<span style=\"color: blue\">string<\/span>[] args)\n        {\n            <span style=\"color: #2b91af\">EmailSettings <\/span>settings = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">EmailSettings<\/span>()\n            {\n                ToAddress = <span style=\"color: #a31515\">&quot;sample@example.com&quot;<\/span>,\n                FromAddress = <span style=\"color: #a31515\">&quot;sender@example.com&quot;<\/span>,\n                AccountName = <span style=\"color: #a31515\">&quot;sample@example.com&quot;<\/span>,\n                AccountPassword = <span style=\"color: #a31515\">&quot;mypa$$w0rd$ux&quot;\n            <\/span>};\n            SendEmail(settings);\n            <span style=\"color: #2b91af\">Console<\/span>.WriteLine(<span style=\"color: #a31515\">&quot;Done&quot;<\/span>);\n            <span style=\"color: #2b91af\">Console<\/span>.ReadKey();\n        }\n\n\n        <span style=\"color: blue\">static void <\/span>SendEmail(<span style=\"color: #2b91af\">EmailSettings <\/span>settings)\n        {\n            <span style=\"color: blue\">if <\/span>(settings == <span style=\"color: blue\">null<\/span>) { <span style=\"color: blue\">throw new <\/span><span style=\"color: #2b91af\">ArgumentNullException<\/span>(<span style=\"color: #a31515\">&quot;need settings!&quot;<\/span>);  }\n            <span style=\"color: green\">\/\/ Almost everything used my the mail system is disposable\n            \/\/ so, we'll use 'using' liberally\n            <\/span><span style=\"color: blue\">using <\/span>(<span style=\"color: #2b91af\">MailMessage <\/span>mail = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">MailMessage<\/span>())\n            {\n                <span style=\"color: green\">\/\/set the e-mail address\n                <\/span>mail.From = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">MailAddress<\/span>(settings.FromAddress);\n                mail.To.Add(settings.ToAddress);\n\n                <span style=\"color: green\">\/\/set the subject\n                <\/span>mail.Subject = <span style=\"color: #a31515\">&quot;New York City!&quot;<\/span>;\n\n                <span style=\"color: green\">\/\/ create some content\n                <\/span><span style=\"color: blue\">string <\/span>textPlain = <span style=\"color: #a31515\">&quot;I'm sorry, but you won't see the pretty photos inline. Look for an attachment.&quot;<\/span>;\n                <span style=\"color: blue\">string <\/span>textHtml = <span style=\"color: #a31515\">&quot;Here is an embedded image.&lt;img src=cid:NewYorkCity1&gt;&quot;<\/span>;\n\n                <span style=\"color: green\">\/\/ setup the alternate views (so different type of e-mail clients can see the content)\n                <\/span><span style=\"color: blue\">using <\/span>(<span style=\"color: #2b91af\">AlternateView \n                        <\/span>plainView = <span style=\"color: #2b91af\">AlternateView<\/span>.CreateAlternateViewFromString(textPlain, <span style=\"color: blue\">null<\/span>, \n                            <span style=\"color: #2b91af\">MediaTypeNames<\/span>.<span style=\"color: #2b91af\">Text<\/span>.Plain), \n                        htmlView = <span style=\"color: #2b91af\">AlternateView<\/span>.CreateAlternateViewFromString(textHtml, <span style=\"color: blue\">null<\/span>, \n                            <span style=\"color: #2b91af\">MediaTypeNames<\/span>.<span style=\"color: #2b91af\">Text<\/span>.Html) )\n                {\n                    <span style=\"color: green\">\/\/create the LinkedResource (embedded image)\n                    <\/span><span style=\"color: blue\">using <\/span>(<span style=\"color: #2b91af\">LinkedResource <\/span>photo = \n                        <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">LinkedResource<\/span>(<span style=\"color: #a31515\">@&quot;D:\\Temp\\nyc2009\\NewYorkCity (1 of 1).jpg&quot;<\/span>))\n                    {\n                        <span style=\"color: green\">\/\/ the content id here must match the content id used in the html as the 'cid:NNNNNNNN'\n                        <\/span>photo.ContentId = <span style=\"color: #a31515\">&quot;NewYorkCity1&quot;<\/span>;\n                        <span style=\"color: green\">\/\/ set the content type to match the image (in this case, it's a jpeg)\n                        <\/span>photo.ContentType = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">ContentType<\/span>(<span style=\"color: #2b91af\">MediaTypeNames<\/span>.<span style=\"color: #2b91af\">Image<\/span>.Jpeg) \n                            { Name = <span style=\"color: #a31515\">&quot;NewYorkCity (1 of 1).jpg&quot; <\/span>};\n\n                        <span style=\"color: green\">\/\/ the htmlView needs the resource\n                        <\/span>htmlView.LinkedResources.Add(photo);\n\n                        <span style=\"color: green\">\/\/ add each view to the alternate views collection\n                        <\/span>mail.AlternateViews.Add(plainView);\n                        mail.AlternateViews.Add(htmlView);\n\n                        <span style=\"color: green\">\/\/ send the message, again diposable\n                        <\/span><span style=\"color: blue\">using <\/span>(<span style=\"color: #2b91af\">SmtpClient <\/span>smtp = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">SmtpClient<\/span>())\n                        {\n                            <span style=\"color: green\">\/\/ these are gmail settings... you'll need to adjust them as needed\n                            <\/span>smtp.EnableSsl = <span style=\"color: blue\">true<\/span>;\n                            smtp.Host = <span style=\"color: #a31515\">&quot;smtp.gmail.com&quot;<\/span>;\n                            smtp.Port = 587;\n                            smtp.UseDefaultCredentials = <span style=\"color: blue\">false<\/span>;\n                            smtp.Credentials = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">NetworkCredential<\/span>(settings.AccountName, \n                                settings.AccountPassword);\n                            smtp.Send(mail);\n                        }\n                    }\n                }                                \n            }\n        }\n    }\n}<\/pre>\n<p>Use this only for good. <img style=\"border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none\" class=\"wlEmoticon wlEmoticon-smile\" alt=\"Smile\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/07\/wlEmoticon-smile.png\" \/><\/p>\n","protected":false},"excerpt":{"rendered":"<p>I had need of sending embedded images within an e-mail. .NET has had a few handy classes for sending an email using SMTP for a few versions. While there were a few examples floating around the internet, none were as clean and easy to follow as I expected. So, I decided to create a simple [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[55,56],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-jC","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":47,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/47","url_meta":{"origin":1216,"position":0},"title":"SMTP Component for .NET Recommendation","date":"April 6, 2008","format":false,"excerpt":"I've been relying on the MailBee.NET SMTP Component from AfterLogic for several months now and just wanted to recommend it to anyone needing a SMTP component for your .NET development. It's inexpensive and easy to use: Pop3 pop = new Pop3(); try { pop.Connect(emailPop3Server, 110); if (_quitting) { return; }\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":723,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/723","url_meta":{"origin":1216,"position":1},"title":"Silverlight Stopwatch class in C#","date":"March 1, 2009","format":false,"excerpt":"I needed a simple method for doing some timings in Silverlight. Silverlight lacks the high performance query counter that is available natively in Windows (and available in .NET 3.5 for example), but it does have a TickCount. My code (mostly) mirrors the existing .NET Stopwatch class using the TickCount property\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1524,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1524","url_meta":{"origin":1216,"position":2},"title":"Alternative to ApplicationSettings in .NET","date":"February 1, 2012","format":false,"excerpt":"After dealing with lost settings, an unclear upgrade path, and my own confusion surrounding the magic of Settings in a .NET client application, I decided to build my own. You\u2019re probably familiar with this UI in Visual Studio. It hasn\u2019t changed much since it was first created: A list of\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/02\/image.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":331,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/331","url_meta":{"origin":1216,"position":3},"title":"Velocity &#8212; a rockin&#8217; distributed in memory cache for ASP.NET","date":"June 3, 2008","format":false,"excerpt":"Velocity, the code-name for a new in-memory distributed caching system for ASP.NET was released as a Community Tech Preview today. What is it? It's described in the documentation: Microsoft project code named \"Velocity\" provides a highly scalable in-memory application cache for all kinds of data. By using cache, your application\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image-thumb.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1773,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1773","url_meta":{"origin":1216,"position":4},"title":"AV Club \/ Our home setup 2012","date":"December 12, 2012","format":false,"excerpt":"I\u2019ve done a lot of reworking of our computers and network recently and thought I\u2019d post some details about the various physical and digital parts that make our humble WiredPrairie home work. Using Google Docs, I created a labeled diagram with most of the moving parts of our house (WOW,\u2026","rel":"","context":"In &quot;Recommendations&quot;","img":{"alt_text":"Home Setup","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/12\/Home-Setup_thumb1.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":215,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/215","url_meta":{"origin":1216,"position":5},"title":"The ReaderWriterLock Slims down &#8230;. (in .NET 3.5)","date":"May 8, 2008","format":false,"excerpt":"I've been doing .NET 3.5 development for quite a few months, and didn't realize until today that there's a new \"improved\" ReaderWriterLock, called ReaderWriterLockSlim. (I never thought to look for a completely new class!). From the documentation, it significantly improves the performance of uses of the old ReaderWriterLock, has simplified\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1216"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=1216"}],"version-history":[{"count":2,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1216\/revisions"}],"predecessor-version":[{"id":1413,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1216\/revisions\/1413"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=1216"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=1216"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=1216"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}