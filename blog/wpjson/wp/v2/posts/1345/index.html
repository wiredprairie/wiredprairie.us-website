{"id":1345,"date":"2011-12-28T21:04:46","date_gmt":"2011-12-29T03:04:46","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=1345"},"modified":"2012-01-04T19:57:15","modified_gmt":"2012-01-05T01:57:15","slug":"creating-a-simple-entity-reference-system-for-ember-js","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1345","title":{"rendered":"Creating a simple Entity Reference system for Ember.js"},"content":{"rendered":"<p>I had some data stored in a structure similar to this:<\/p>\n<p><a href=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/12\/image7.png\"><img loading=\"lazy\" style=\"background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/12\/image_thumb7.png\" width=\"391\" height=\"187\" \/><\/a><\/p>\n<p>Nothing too fancy. A table of Gift(s) and a table of Person(s). Each gift had a foreign key relationship to a Person (the person who \u201cgave\u201d the gift). <\/p>\n<p>Since some people may give several gifts, I didn\u2019t want to load the same data multiple times (each gift shouldn\u2019t have the person\u2019s name for example spelled out). I wanted to build a RESTful web service to return the gifts and persons as independent queries, with the resulting JavaScript objects being very similar to the original data storage in the database.<\/p>\n<p>Using <a href=\"http:\/\/www.emberjs.com\/\">Ember.JS<\/a> I built a small demonstration of <strong>one way<\/strong> that this could be done. I am aware of the <em>in-progress<\/em> data library for ember.js on <a href=\"https:\/\/github.com\/emberjs\/data\">github<\/a>, but it was way more than I wanted (or needed). Furthermore, I found it more far complex than I wanted (and I\u2019m not particularly fond of the syntax it requires). So, I created a simple system that I\u2019ll likely expand upon over time and post here.<\/p>\n<p>Here\u2019s the very basic demo using handlebars templates (a core feature of Ember.js).<\/p>\n<pre class=\"csharpcode\"><span class=\"kwrd\">&lt;!<\/span><span class=\"html\">DOCTYPE<\/span> <span class=\"attr\">html<\/span><span class=\"kwrd\">&gt;<\/span>\n\n<span class=\"kwrd\">&lt;<\/span><span class=\"html\">html<\/span><span class=\"kwrd\">&gt;<\/span>\n<span class=\"kwrd\">&lt;<\/span><span class=\"html\">head<\/span><span class=\"kwrd\">&gt;<\/span>\n    <span class=\"kwrd\">&lt;<\/span><span class=\"html\">title<\/span><span class=\"kwrd\">&gt;Demo2-EmberJS<\/span><span class=\"kwrd\">&lt;\/<\/span><span class=\"html\">title<\/span><span class=\"kwrd\">&gt;<\/span>\n<span class=\"kwrd\">&lt;\/<\/span><span class=\"html\">head<\/span><span class=\"kwrd\">&gt;<\/span>\n<span class=\"kwrd\">&lt;<\/span><span class=\"html\">body<\/span><span class=\"kwrd\">&gt;<\/span>\n\n    <span class=\"kwrd\">&lt;<\/span><span class=\"html\">script<\/span> <span class=\"attr\">type<\/span><span class=\"kwrd\">=&quot;text\/x-handlebars&quot;<\/span> <span class=\"attr\">data-template-name<\/span><span class=\"kwrd\">=&quot;gifts&quot;<\/span><span class=\"kwrd\">&gt;<\/span>\n      &lt;h1&gt;{{ giftReason }}&lt;\/h1&gt;\n      &lt;table&gt;\n          &lt;thead&gt;\n          &lt;tr&gt;\n              &lt;td&gt;Description&lt;\/td&gt;\n              &lt;td&gt;Thrill&lt;\/td&gt;\n              &lt;td&gt;From&lt;\/td&gt;\n          &lt;\/tr&gt;\n          &lt;\/thead&gt;\n          {{#each gifts}}\n          &lt;tr&gt;\n              &lt;td&gt;\n                  {{ name }} \n              &lt;\/td&gt;\n              &lt;td&gt;\n                  {{ excitement }}\n              &lt;\/td&gt;\n              &lt;td&gt;\n                  {{ person.fullName }}\n              &lt;\/td&gt;\n          &lt;\/tr&gt;\n          {{\/each}}\n      &lt;\/table&gt;\n    <span class=\"kwrd\">&lt;\/<\/span><span class=\"html\">script<\/span><span class=\"kwrd\">&gt;<\/span>\n\n    &lt;script src=<span class=\"str\">&quot;demo2\/jquery-1.7.1.js&quot;<\/span> type=<span class=\"str\">&quot;text\/javascript&quot;<\/span>&gt;&lt;\/script&gt;\n    &lt;script src=<span class=\"str\">&quot;demo2\/ember-0.9.3.js&quot;<\/span> type=<span class=\"str\">&quot;text\/javascript&quot;<\/span>&gt;&lt;\/script&gt;\n    &lt;script src=<span class=\"str\">&quot;demo2\/app.js&quot;<\/span> type=<span class=\"str\">&quot;text\/javascript&quot;<\/span>&gt;<span class=\"kwrd\">&lt;\/<\/span><span class=\"html\">script<\/span><span class=\"kwrd\">&gt;<\/span>\n<span class=\"kwrd\">&lt;\/<\/span><span class=\"html\">body<\/span><span class=\"kwrd\">&gt;<\/span>\n<span class=\"kwrd\">&lt;\/<\/span><span class=\"html\">html<\/span><span class=\"kwrd\">&gt;<\/span><\/pre>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>And here is the content of app.js file referenced above (the other files can be downloaded from the web):<\/p>\n<pre class=\"csharpcode\"><span class=\"kwrd\">var<\/span> Demo2App;\nDemo2App = Ember.Application.create();\nwindow.Demo2App = Demo2App;\n\n<span class=\"rem\">\/\/ standard class that has an 'id' property<\/span>\n<span class=\"kwrd\">var<\/span> Entity = Ember.Object.extend({\n    id:<span class=\"kwrd\">null<\/span>\n});\n\n(<span class=\"kwrd\">function<\/span> () {\n    Ember.entityRef = <span class=\"kwrd\">function<\/span> (property, type) {\n        <span class=\"rem\">\/\/ auto build connection if property is in the form<\/span>\n        <span class=\"rem\">\/\/ of 'typenameID' if type is not specified<\/span>\n        <span class=\"kwrd\">if<\/span> (arguments.length === 1 &amp;&amp; property) {\n            <span class=\"kwrd\">var<\/span> l = property.length;\n            <span class=\"kwrd\">if<\/span> (l &gt; 2 &amp;&amp; property.substr(l - 2).toLowerCase() === <span class=\"str\">'id'<\/span>) {\n                type = property.substr(0, l - 2);\n            } <span class=\"kwrd\">else<\/span> {\n                <span class=\"kwrd\">throw<\/span> <span class=\"kwrd\">new<\/span> Error(<span class=\"str\">&quot;Type not specified, and cannot automatically determine store name. Referenced property name must end with Id.&quot;<\/span>);\n            }\n        }\n        <span class=\"kwrd\">var<\/span> fn = <span class=\"kwrd\">new<\/span> Function(<span class=\"str\">&quot;return Demo2App.Stores.find('&quot;<\/span> + type + <span class=\"str\">&quot;', this.get('&quot;<\/span> + property + <span class=\"str\">&quot;')); &quot;<\/span>);\n        <span class=\"kwrd\">return<\/span> Ember.computed(fn).property(property);\n    };\n})();\n\n<span class=\"rem\">\/*<\/span>\n<span class=\"rem\"> Class definitions<\/span>\n<span class=\"rem\"> *\/<\/span>\n\nDemo2App.Person = Entity.extend({\n    firstName:<span class=\"str\">''<\/span>,\n    lastName:<span class=\"str\">''<\/span>,\n\n    fullName:<span class=\"kwrd\">function<\/span> () {\n        <span class=\"kwrd\">return<\/span> <span class=\"kwrd\">this<\/span>.get(<span class=\"str\">'lastName'<\/span>) + <span class=\"str\">&quot;, &quot;<\/span> + <span class=\"kwrd\">this<\/span>.get(<span class=\"str\">'firstName'<\/span>);\n    }.property(<span class=\"str\">'firstName'<\/span>, <span class=\"str\">'lastName'<\/span>)\n});\n\n\nDemo2App.Gift = Ember.Object.extend({\n    personId:<span class=\"kwrd\">null<\/span>,\n    person:Ember.entityRef(<span class=\"str\">'personId'<\/span>)\n});\n\n\n<span class=\"rem\">\/\/ build in a data store API<\/span>\n(<span class=\"kwrd\">function<\/span> () {\n    <span class=\"rem\">\/\/ within a closure, we'll store the current stores<\/span>\n\n    <span class=\"kwrd\">var<\/span> stores = {};\n\n    <span class=\"kwrd\">var<\/span> Store = Ember.Object.extend({\n        name:<span class=\"kwrd\">null<\/span>,\n        _data:<span class=\"kwrd\">null<\/span>,\n        add:<span class=\"kwrd\">function<\/span> (obj) {\n            <span class=\"kwrd\">if<\/span> (!obj) {\n                <span class=\"kwrd\">return<\/span>;\n            }\n            <span class=\"kwrd\">if<\/span> (!obj.id) {\n                <span class=\"kwrd\">return<\/span>;\n            }\n            <span class=\"kwrd\">this<\/span>.get(<span class=\"str\">'_data'<\/span>)[obj.id] = obj;\n        },\n        remove:<span class=\"kwrd\">function<\/span> (obj) {\n            <span class=\"kwrd\">if<\/span> (!obj) {\n                <span class=\"kwrd\">return<\/span>;\n            }\n            <span class=\"kwrd\">if<\/span> (!obj.id) {\n                <span class=\"kwrd\">return<\/span>;\n            }\n            <span class=\"kwrd\">var<\/span> data = <span class=\"kwrd\">this<\/span>.get(<span class=\"str\">'_data'<\/span>);\n            delete data[obj.id];\n        },\n\n        find:<span class=\"kwrd\">function<\/span> (id) {\n            <span class=\"kwrd\">if<\/span> (!id) {\n                <span class=\"kwrd\">return<\/span>;\n            }\n            <span class=\"kwrd\">return<\/span> <span class=\"kwrd\">this<\/span>.get(<span class=\"str\">'_data'<\/span>)[id];\n        }\n    });\n\n    Demo2App.Stores = Demo2App.Stores || {};\n\n    Demo2App.Stores.create = <span class=\"kwrd\">function<\/span> (name, options) {\n        name = name.toLowerCase();\n        <span class=\"kwrd\">var<\/span> s = Store.create({\n            name:name\n        });\n        s.set(<span class=\"str\">'_data'<\/span>, {});\n        stores[name] = s;\n        <span class=\"kwrd\">return<\/span> s;\n    };\n\n    Demo2App.Stores.get = <span class=\"kwrd\">function<\/span> (name) {\n        name = name.toLowerCase();\n        <span class=\"kwrd\">return<\/span> stores[name];\n    };\n\n    Demo2App.Stores.remove = <span class=\"kwrd\">function<\/span> (name) {\n        name = name.toLowerCase();\n        delete stores[name];\n    };\n\n    Demo2App.Stores.clear = <span class=\"kwrd\">function<\/span> (name) {\n        name = name.toLowerCase();\n        stores[name].set(<span class=\"str\">'_data'<\/span>, {});\n    };\n\n    Demo2App.Stores.find = <span class=\"kwrd\">function<\/span> (name, id) {\n        <span class=\"kwrd\">var<\/span> ds = Demo2App.Stores.get(name);\n        <span class=\"kwrd\">var<\/span> entity = ds.find(id);\n        <span class=\"kwrd\">if<\/span> (entity) {\n            <span class=\"kwrd\">return<\/span> entity;\n        }\n        <span class=\"kwrd\">return<\/span> <span class=\"kwrd\">null<\/span>;\n    }\n\n})();\n\n\n<span class=\"kwrd\">var<\/span> personsDS = Demo2App.Stores.create(<span class=\"str\">'person'<\/span>);\npersonsDS.add(Demo2App.Person.create({\n    id:<span class=\"str\">&quot;123&quot;<\/span>,\n    firstName:<span class=\"str\">&quot;Aaron&quot;<\/span>,\n    lastName:<span class=\"str\">&quot;Bourne&quot;<\/span>\n})\n);\n\npersonsDS.add(Demo2App.Person.create({\n    id:<span class=\"str\">&quot;234&quot;<\/span>,\n    firstName:<span class=\"str\">&quot;Bonnie&quot;<\/span>,\n    lastName:<span class=\"str\">&quot;Highways&quot;<\/span>\n})\n);\n\npersonsDS.add(Demo2App.Person.create({\n    id:<span class=\"str\">&quot;345&quot;<\/span>,\n    firstName:<span class=\"str\">&quot;Daddy&quot;<\/span>,\n    lastName:<span class=\"str\">&quot;Peacebucks&quot;<\/span>\n})\n);\n\npersonsDS.add(Demo2App.Person.create({\n    id:<span class=\"str\">&quot;456&quot;<\/span>,\n    firstName:<span class=\"str\">&quot;Cotton&quot;<\/span>,\n    lastName:<span class=\"str\">&quot;Kandi&quot;<\/span>\n})\n);\n\n\nDemo2App.mainController = Ember.Object.create({\n\n    gifts:Ember.ArrayController.create({\n        content:[],\n\n        newGift:<span class=\"kwrd\">function<\/span> (details) {\n            <span class=\"kwrd\">var<\/span> gift = Demo2App.Gift.create(details);\n            <span class=\"kwrd\">this<\/span>.addObject(gift);\n            <span class=\"kwrd\">return<\/span> gift;\n        }\n    })\n});\n\n<span class=\"kwrd\">var<\/span> giftsView = Ember.View.create({\n    templateName:<span class=\"str\">'gifts'<\/span>,\n    giftsBinding:<span class=\"str\">'Demo2App.mainController.gifts'<\/span>,\n    giftReason:<span class=\"str\">'Birthday 2011'<\/span>\n});\n\n<span class=\"kwrd\">var<\/span> moreGifts = [\n    { name:<span class=\"str\">'Book'<\/span>, excitement:<span class=\"str\">'3'<\/span>, personId:<span class=\"str\">'123'<\/span> },\n    { name:<span class=\"str\">'Shirt'<\/span>, excitement:<span class=\"str\">'1'<\/span>, personId:<span class=\"str\">'234'<\/span>},\n    { name:<span class=\"str\">'Game System'<\/span>, excitement:<span class=\"str\">'5'<\/span>, personId:<span class=\"str\">'123'<\/span>},\n    { name:<span class=\"str\">'Movie'<\/span>, excitement:<span class=\"str\">'4'<\/span>, personId:<span class=\"str\">'345'<\/span>},\n    { name:<span class=\"str\">'Gift Card'<\/span>, excitement:<span class=\"str\">'3'<\/span>, personId:<span class=\"str\">'123'<\/span>},\n    { name:<span class=\"str\">'MP3 Player'<\/span>, excitement:<span class=\"str\">'3'<\/span>, personId:<span class=\"str\">'456'<\/span>},\n    { name:<span class=\"str\">'Tie'<\/span>, excitement:<span class=\"str\">'1'<\/span>, personId:<span class=\"str\">'456'<\/span>},\n    { name:<span class=\"str\">'Candy'<\/span>, excitement:<span class=\"str\">'3'<\/span>, personId:<span class=\"str\">'234'<\/span>},\n    { name:<span class=\"str\">'Coffee'<\/span>, excitement:<span class=\"str\">'3'<\/span>, personId:<span class=\"str\">'123'<\/span>},\n    { name:<span class=\"str\">'Blanket'<\/span>, excitement:<span class=\"str\">'2'<\/span>, personId:<span class=\"str\">'456'<\/span>},\n    { name:<span class=\"str\">'Camera'<\/span>, excitement:<span class=\"str\">'4'<\/span>, personId:<span class=\"str\">'234'<\/span>},\n    { name:<span class=\"str\">'Phone'<\/span>, excitement:<span class=\"str\">'5'<\/span>, personId:<span class=\"str\">'234'<\/span>},\n    { name:<span class=\"str\">'Socks'<\/span>, excitement:<span class=\"str\">'1'<\/span>, personId:<span class=\"str\">'123'<\/span>},\n    { name:<span class=\"str\">'Game'<\/span>, excitement:<span class=\"str\">'5'<\/span>, personId:<span class=\"str\">'456'<\/span>}\n];\n\n<span class=\"kwrd\">var<\/span> moreGiftsIndex = moreGifts.length;\n\n$(<span class=\"kwrd\">function<\/span> () {\n\n    <span class=\"kwrd\">function<\/span> addMoreGifts() {\n        moreGiftsIndex--;\n        <span class=\"kwrd\">if<\/span> (moreGiftsIndex &gt;= 0) {\n            Demo2App.mainController.gifts.newGift(moreGifts[moreGiftsIndex]);\n        }\n        setTimeout(addMoreGifts, 2000);\n    }\n\n    giftsView.append();\n    addMoreGifts();\n});<\/pre>\n<p>Here\u2019s a few details about the JavaScript code. #1, it\u2019s got very little in the way of error checking. I\u2019ll add that later. And if you use it, you should add it. :)<\/p>\n<p>Recall the simple data model with each gift having a foreign key reference to a person. If you look at each Gift, it contains keys that mirror the DB: <strong>name<\/strong>, <strong>excitement<\/strong>, and <strong>personId<\/strong>. All 3 are handled as strings. The Person class has an Id, <strong>lastName<\/strong>, and <strong>firstName<\/strong>.<\/p>\n<p>When creating the Ember Gift class, I made a connection to the Person class using a new function I added called <strong>entityRef<\/strong>.<\/p>\n<pre class=\"csharpcode\">Demo2App.Gift = Ember.Object.extend({\n    personId:<span class=\"kwrd\">null<\/span>,\n    person:Ember.entityRef(<span class=\"str\">'personId'<\/span>) <span class=\"rem\">\/\/ [3]<\/span> \n});<\/pre>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>As you can see on line [3] above, a <strong>person<\/strong> property is declared not with a value, but as a function. Ember.js includes support for computed properties which, when properly used, return a computed value and can be automatically updated when a dependency is established between the function and the values the computed property requires. Following is the code for the <strong>entityRef <\/strong>function.<\/p>\n<pre class=\"csharpcode\">(<span class=\"kwrd\">function<\/span> () {\n    Ember.entityRef = <span class=\"kwrd\">function<\/span> (property, type) {\n        <span class=\"rem\">\/\/ auto build connection if property is in the form<\/span>\n        <span class=\"rem\">\/\/ of 'typenameID' if type is not specified<\/span>\n        <span class=\"kwrd\">if<\/span> (arguments.length === 1 &amp;&amp; property) {   <span class=\"rem\">\/\/ [1]<\/span>\n            <span class=\"kwrd\">var<\/span> l = property.length;\n            <span class=\"kwrd\">if<\/span> (l &gt; 2 &amp;&amp; property.substr(l - 2).toLowerCase() === <span class=\"str\">'id'<\/span>) {\n                type = property.substr(0, l - 2);\n            } <span class=\"kwrd\">else<\/span> {\n                <span class=\"kwrd\">throw<\/span> <span class=\"kwrd\">new<\/span> Error(<span class=\"str\">&quot;Type not specified, and cannot automatically determine store name. Referenced property name must end with Id.&quot;<\/span>);\n            }\n        }\n        <span class=\"kwrd\">var<\/span> fn = <span class=\"kwrd\">new<\/span> Function(<span class=\"str\">&quot;return Demo2App.Stores.find('&quot;<\/span> + type + <span class=\"str\">&quot;', this.get('&quot;<\/span> + property + <span class=\"str\">&quot;')); &quot;<\/span>);\n        <span class=\"kwrd\">return<\/span> Ember.computed(fn).property(property);\n    };\n})();<\/pre>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>Thankfully, the entityRef function doesn\u2019t need to do much, and much of what it does is make it easy to make a connection automatically between the local data store and the source property by using a simple naming convention. <\/p>\n<p>Starting at [1], the code makes a simple attempt at doing an \u201cauto-map\u201d when a type isn\u2019t specified specifically. In this case, when \u201cpersonId\u201d is passed to the function, it chops the \u201cId\u201d off and uses \u201cperson\u201d as the name of the data store automatically. It <strong>doesn\u2019t validate <\/strong>the name or anything sophisticated (as I said, it\u2019s light on error checking), but it works when everything is specified correctly. In this case, there\u2019s a \u201cperson\u201d data store created in the JavaScript code created a little bit later.<\/p>\n<pre class=\"csharpcode\"><span class=\"kwrd\">var<\/span> personsDS = Demo2App.Stores.create(<span class=\"str\">'person'<\/span>);<\/pre>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>Once the data store type name is located, it creates a new function which returns the object by Id stored in the named data store. That function is wrapped in an Ember computed function, and then the dependency on the \u201cpersonId\u201d is established. Both of these features are core to the Ember JavaScript library (check out the <a href=\"http:\/\/www.emberjs.com\/\">Ember JavaScript library<\/a> web site for more information). While they may look a bit strange if you\u2019re not familiar with Ember, trust me, they\u2019re perfectly normal. :)<\/p>\n<p>The remaining code is standard Ember JavaScript code with the addition of a simple data store object that manages objects by Id. <\/p>\n<p>Have fun!<\/p>\n<p>(And if you haven\u2019t transitioned from the earlier SproutCore 2.0 betas to Ember, this code should work with a tiny bit of namespace fixing).<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I had some data stored in a structure similar to this: Nothing too fancy. A table of Gift(s) and a table of Person(s). Each gift had a foreign key relationship to a Person (the person who \u201cgave\u201d the gift). Since some people may give several gifts, I didn\u2019t want to load the same data multiple [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4,5],"tags":[54,51],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-lH","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1377,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1377","url_meta":{"origin":1345,"position":0},"title":"EzData for Ember.js","date":"January 1, 2012","format":false,"excerpt":"Previous post: Entity reference I\u2019ve been extending my original post (above) in an effort to create a simple entity system using Ember.js (SproutCore 2.0). While it\u2019s grown in sophistication, it is far from complete. The project is now located on GitHub. This is the introduction, from the readme on GitHub.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1430,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1430","url_meta":{"origin":1345,"position":1},"title":"Ember.JS and EZdata, and Rails","date":"January 7, 2012","format":false,"excerpt":"I\u2019ve been trying to do some additional work on my ember.js extension for data management. At the same time though, I\u2019ve been trying (to learn and) build a simple Ruby on Rails web demo application using the new JavaScript library. There have been more than a few things that have\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1340,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1340","url_meta":{"origin":1345,"position":2},"title":"Nest Thermostat Review, Update #1","date":"December 27, 2011","format":false,"excerpt":"After a few weeks of using the Nest thermostat, I\u2019ve got a few more comments that I\u2019d like to share. (Here\u2019s my post about the installation). The learning feature honestly hasn\u2019t been very useful in the first few weeks. It\u2019s apparently easily confused by days that you're home unexpectedly (for\u2026","rel":"","context":"In &quot;General&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/12\/image_thumb3.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1442,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1442","url_meta":{"origin":1345,"position":3},"title":"Nest Thermostat API\/Protocol","date":"January 8, 2012","format":false,"excerpt":"While Nest Labs hasn\u2019t released a formal (documented & supported) API, I thought I\u2019d do a bit of digging to see how they\u2019re using the network and what might be achievable. A few things are going on, the majority as you\u2019d probably expect. The web interface is using a long\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/image_thumb7.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1382,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1382","url_meta":{"origin":1345,"position":4},"title":"Nest Thermostat Review, Update #4","date":"January 2, 2012","format":false,"excerpt":"Update #6, Update #5, Update #4, Update #3, Update #2, Update #1, Install A bit more about my Nest thermostat experiences. On the weekend, I spoke with a support engineer from Nest regarding the issue I was having with one of the Nest units failing to properly read the room\u2026","rel":"","context":"In &quot;General&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/image_thumb.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1773,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1773","url_meta":{"origin":1345,"position":5},"title":"AV Club \/ Our home setup 2012","date":"December 12, 2012","format":false,"excerpt":"I\u2019ve done a lot of reworking of our computers and network recently and thought I\u2019d post some details about the various physical and digital parts that make our humble WiredPrairie home work. Using Google Docs, I created a labeled diagram with most of the moving parts of our house (WOW,\u2026","rel":"","context":"In &quot;Recommendations&quot;","img":{"alt_text":"Home Setup","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/12\/Home-Setup_thumb1.png?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1345"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=1345"}],"version-history":[{"count":5,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1345\/revisions"}],"predecessor-version":[{"id":1411,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1345\/revisions\/1411"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=1345"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=1345"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=1345"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}