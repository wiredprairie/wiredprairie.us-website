{"id":1030,"date":"2010-04-02T10:35:15","date_gmt":"2010-04-02T15:35:15","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1030"},"modified":"2012-08-02T10:29:56","modified_gmt":"2012-08-02T15:29:56","slug":"silverlight-stopwatch-class-part-2","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1030","title":{"rendered":"Silverlight Stopwatch Class, Part 2"},"content":{"rendered":"<p>I recently made a fix to a <a href=\"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/723\">Silverlight stopwatch<\/a> class I wrote last year.<\/p>\n<p>In doing so, I decided to kick it up a notch.<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">using <\/span>(<span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">StopwatchPlus<\/span>(<span style=\"color: #a31515;\">\"Constructor\"<\/span>))\r\n{\r\n    <span style=\"color: green;\">\/\/Debug.WriteLine(\"Initialized: Ellapsed Ticks: {0}, Ellapsed Milliseconds: {1}\", sw.EllapsedTicks, sw.EllapsedMilliseconds); <\/span>InitializeComponent();\r\n    <span style=\"color: #2b91af;\">Thread<\/span>.Sleep(600);            \r\n}<\/pre>\n<p>Instead of just a simple Stopwatch class, I added functionality to make it easy to capture timings for blocks of code, output to the Debug Output window, and perform any custom start\/stop action.<\/p>\n<p>&nbsp;<\/p>\n<pre class=\"code\"><span style=\"color: #2b91af;\">StopwatchPlus <\/span>sp1 = <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">StopwatchPlus<\/span>(sw2 =&gt; \r\n        <span style=\"color: #2b91af;\">Debug<\/span>.WriteLine(<span style=\"color: #a31515;\">\"Time! {0}\"<\/span>, sw2.EllapsedMilliseconds));\r\n<span style=\"color: #2b91af;\">Thread<\/span>.Sleep(500);\r\nsp1.Stop();    <span style=\"color: green;\">\/\/ this will call the stopAction defined in the constructor <\/span><\/pre>\n<p>&nbsp;<\/p>\n<p>In non-debug builds, the StopwatchPlus class does not send output to the debug window. (I used the ConditionalAttribute \u2026 I know I could have used conditional compilation statements, but I didn\u2019t. :-) ).<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">using <\/span>System;\r\n<span style=\"color: blue;\">using <\/span>System.Diagnostics;\r\n\r\n<span style=\"color: blue;\">namespace <\/span>WiredPrairie.Silverlight\r\n{\r\n    <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">StopwatchPlus is used to measure the general performance of Silverlight functionality. Silverlight <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">does not provide a high resolution timer as is available in many operating systems, <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">so the resolution of this timer is limited to milliseconds. This class is best used to measure <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">the relative performance of functions over many iterations. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; <\/span><span style=\"color: blue;\">public sealed class <\/span><span style=\"color: #2b91af;\">StopwatchPlus <\/span>: <span style=\"color: #2b91af;\">IDisposable <\/span>{\r\n        <span style=\"color: blue;\">private long <\/span>_startTick;\r\n        <span style=\"color: blue;\">private long <\/span>_elapsed;\r\n        <span style=\"color: blue;\">private bool <\/span>_isRunning;\r\n        <span style=\"color: blue;\">private string <\/span>_name;\r\n        <span style=\"color: blue;\">private <\/span><span style=\"color: #2b91af;\">Action<\/span>&lt;<span style=\"color: #2b91af;\">StopwatchPlus<\/span>&gt; _startAction;\r\n        <span style=\"color: blue;\">private <\/span><span style=\"color: #2b91af;\">Action<\/span>&lt;<span style=\"color: #2b91af;\">StopwatchPlus<\/span>&gt; _stopAction;\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Creates an instance of the StopwatchPlus class and starts the timer. By <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">providing a value to the name parameter, the Debug Console automatically <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">will include the current values when the timer was started and stopped with <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">this name. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; \/\/\/ &lt;param name=\"name\"&gt;&lt;\/param&gt; <\/span><span style=\"color: blue;\">public <\/span>StopwatchPlus(<span style=\"color: blue;\">string <\/span>name)\r\n            : <span style=\"color: blue;\">this<\/span>(name, WriteStart, WriteResults) { } \r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Creates an instance of the StopwatchPlus class and starts the timer. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; \/\/\/ &lt;param name=\"stopAction\"&gt;<\/span><span style=\"color: green;\">Action to take when the Stop method is called.<\/span><span style=\"color: gray;\">&lt;\/param&gt; <\/span><span style=\"color: blue;\">public <\/span>StopwatchPlus(<span style=\"color: #2b91af;\">Action<\/span>&lt;<span style=\"color: #2b91af;\">StopwatchPlus<\/span>&gt; stopAction)\r\n            :<span style=\"color: blue;\">this<\/span>(<span style=\"color: blue;\">null<\/span>, stopAction)\r\n        {\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Creates an instance of the StopwatchPlus class and starts the timer. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; \/\/\/ &lt;param name=\"startAction\"&gt;<\/span><span style=\"color: green;\">Action to take when the timer starts.<\/span><span style=\"color: gray;\">&lt;\/param&gt; \/\/\/ &lt;param name=\"stopAction\"&gt;<\/span><span style=\"color: green;\">Action to take when the Stop method is called.<\/span><span style=\"color: gray;\">&lt;\/param&gt; <\/span><span style=\"color: blue;\">public <\/span>StopwatchPlus(<span style=\"color: #2b91af;\">Action<\/span>&lt;<span style=\"color: #2b91af;\">StopwatchPlus<\/span>&gt; startAction,\r\n            <span style=\"color: #2b91af;\">Action<\/span>&lt;<span style=\"color: #2b91af;\">StopwatchPlus<\/span>&gt; stopAction)\r\n            :<span style=\"color: blue;\">this<\/span>(<span style=\"color: blue;\">null<\/span>, startAction, stopAction)\r\n        {\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Creates an instance of the StopwatchPlus class and starts the timer. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; \/\/\/ &lt;param name=\"name\"&gt;<\/span><span style=\"color: green;\">Name of this stop watch (used as output)<\/span><span style=\"color: gray;\">&lt;\/param&gt; \/\/\/ &lt;param name=\"startAction\"&gt;<\/span><span style=\"color: green;\">Action to take when the timer starts.<\/span><span style=\"color: gray;\">&lt;\/param&gt; \/\/\/ &lt;param name=\"stopAction\"&gt;<\/span><span style=\"color: green;\">Action to take when the Stop method is called.<\/span><span style=\"color: gray;\">&lt;\/param&gt; <\/span><span style=\"color: blue;\">public <\/span>StopwatchPlus(<span style=\"color: blue;\">string <\/span>name,\r\n            <span style=\"color: #2b91af;\">Action<\/span>&lt;<span style=\"color: #2b91af;\">StopwatchPlus<\/span>&gt; startAction, \r\n            <span style=\"color: #2b91af;\">Action<\/span>&lt;<span style=\"color: #2b91af;\">StopwatchPlus<\/span>&gt; stopAction)\r\n        {\r\n            _name = name;\r\n            _startAction = startAction;\r\n            _stopAction = stopAction;\r\n            Start();\r\n        }\r\n\r\n        <span style=\"color: blue;\">public string <\/span>Name\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>_name; }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Completely resets and deactivates the timer. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; <\/span><span style=\"color: blue;\">public void <\/span>Reset()\r\n        {\r\n            _elapsed = 0;\r\n            _isRunning = <span style=\"color: blue;\">false<\/span>;\r\n            _startTick = 0;\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Begins the timer. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; <\/span><span style=\"color: blue;\">public void <\/span>Start()\r\n        {\r\n            <span style=\"color: blue;\">if <\/span>(!_isRunning)\r\n            {\r\n                _startTick = GetCurrentTicks();\r\n                _isRunning = <span style=\"color: blue;\">true<\/span>;\r\n                <span style=\"color: blue;\">if <\/span>(_startAction != <span style=\"color: blue;\">null<\/span>)\r\n                {\r\n                    _startAction(<span style=\"color: blue;\">this<\/span>);\r\n                }\r\n            }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Stops the current timer. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; <\/span><span style=\"color: blue;\">public void <\/span>Stop()\r\n        {\r\n            <span style=\"color: blue;\">if <\/span>(_isRunning)\r\n            {\r\n                _elapsed += GetCurrentTicks() - _startTick;\r\n                _isRunning = <span style=\"color: blue;\">false<\/span>;\r\n                <span style=\"color: blue;\">if <\/span>(_stopAction != <span style=\"color: blue;\">null<\/span>)\r\n                {\r\n                    _stopAction(<span style=\"color: blue;\">this<\/span>);\r\n                }\r\n            }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Gets a value indicating whether the instance is currently recording. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; <\/span><span style=\"color: blue;\">public bool <\/span>IsRunning\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>_isRunning; }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Gets the Ellapsed time as a Timespan. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; <\/span><span style=\"color: blue;\">public <\/span><span style=\"color: #2b91af;\">TimeSpan <\/span>Ellapsed\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span><span style=\"color: #2b91af;\">TimeSpan<\/span>.FromMilliseconds(EllapsedMilliseconds); }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Gets the Ellapsed time as the total number of milliseconds. <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; <\/span><span style=\"color: blue;\">public long <\/span>EllapsedMilliseconds\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>GetCurrentElapsedTicks() \/ <span style=\"color: #2b91af;\">TimeSpan<\/span>.TicksPerMillisecond; }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt; \/\/\/ <\/span><span style=\"color: green;\">Gets the Ellapsed time as the total number of ticks (which is faked <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">as Silverlight doesn't have a way to get at the actual \"Ticks\") <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt; <\/span><span style=\"color: blue;\">public long <\/span>EllapsedTicks\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>GetCurrentElapsedTicks(); }\r\n        }\r\n\r\n        <span style=\"color: blue;\">private long <\/span>GetCurrentElapsedTicks()\r\n        {\r\n            <span style=\"color: blue;\">return <\/span>(<span style=\"color: blue;\">long<\/span>)(<span style=\"color: blue;\">this<\/span>._elapsed + (IsRunning ? (GetCurrentTicks() - _startTick) : 0));\r\n        }\r\n\r\n        <span style=\"color: blue;\">private long <\/span>GetCurrentTicks()\r\n        {\r\n            <span style=\"color: green;\">\/\/ TickCount: Gets the number of milliseconds elapsed since the system started. <\/span><span style=\"color: blue;\">return <\/span><span style=\"color: #2b91af;\">Environment<\/span>.TickCount * <span style=\"color: #2b91af;\">TimeSpan<\/span>.TicksPerMillisecond;\r\n        }\r\n\r\n        <span style=\"color: blue;\">#region <\/span>IDisposable Members\r\n\r\n        <span style=\"color: blue;\">public void <\/span>Dispose()\r\n        {\r\n            Stop();\r\n        }\r\n\r\n        <span style=\"color: blue;\">#endregion private static void <\/span>WriteStart(<span style=\"color: #2b91af;\">StopwatchPlus <\/span>sw)\r\n        {\r\n            WriteStartInternal(sw);\r\n        }\r\n\r\n        <span style=\"color: green;\">\/\/ This is not called in a Release build <\/span>[<span style=\"color: #2b91af;\">Conditional<\/span>(<span style=\"color: #a31515;\">\"DEBUG\"<\/span>)]\r\n        <span style=\"color: blue;\">private static void <\/span>WriteStartInternal(<span style=\"color: #2b91af;\">StopwatchPlus <\/span>sw)\r\n        {\r\n            <span style=\"color: #2b91af;\">Debug<\/span>.WriteLine(<span style=\"color: #a31515;\">\"BEGIN\\t{0}\"<\/span>, sw._name);\r\n\r\n        }\r\n\r\n        <span style=\"color: blue;\">private static void <\/span>WriteResults(<span style=\"color: #2b91af;\">StopwatchPlus <\/span>sw)\r\n        {\r\n            WriteResultsInternal(sw);\r\n        }\r\n\r\n        <span style=\"color: green;\">\/\/ This is not called in a Release build <\/span>[<span style=\"color: #2b91af;\">Conditional<\/span>(<span style=\"color: #a31515;\">\"DEBUG\"<\/span>)]\r\n        <span style=\"color: blue;\">private static void <\/span>WriteResultsInternal(<span style=\"color: #2b91af;\">StopwatchPlus <\/span>sw) \r\n        {\r\n            <span style=\"color: #2b91af;\">Debug<\/span>.WriteLine(<span style=\"color: #a31515;\">\"END\\t{0}\\t{1}\"<\/span>, sw._name, sw.EllapsedMilliseconds);\r\n        }\r\n    }\r\n}<\/pre>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I recently made a fix to a Silverlight stopwatch class I wrote last year. In doing so, I decided to kick it up a notch. using (new StopwatchPlus(&#8220;Constructor&#8221;)) { \/\/Debug.WriteLine(&#8220;Initialized: Ellapsed Ticks: {0}, Ellapsed Milliseconds: {1}&#8221;, sw.EllapsedTicks, sw.EllapsedMilliseconds); InitializeComponent(); Thread.Sleep(600); } Instead of just a simple Stopwatch class, I added functionality to make it easy [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4,14],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-gC","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":723,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/723","url_meta":{"origin":1030,"position":0},"title":"Silverlight Stopwatch class in C#","date":"March 1, 2009","format":false,"excerpt":"I needed a simple method for doing some timings in Silverlight. Silverlight lacks the high performance query counter that is available natively in Windows (and available in .NET 3.5 for example), but it does have a TickCount. My code (mostly) mirrors the existing .NET Stopwatch class using the TickCount property\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":388,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/388","url_meta":{"origin":1030,"position":1},"title":"Silverlight Weather Demonstration","date":"June 26, 2008","format":false,"excerpt":"Demonstration available here. (You'll need to wait for a moment while it loads the first time). I've created a reasonably simple, yet multi-technology (and discipline) demonstration using Silverlight for the user interface and ASP.NET as the back-end. The demonstration uses: Silverlight 2.0 Data binding Delayed downloading of images \"Web services\"\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image21.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1016,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1016","url_meta":{"origin":1030,"position":2},"title":"Silverlight vs. Flash vs. Photoshop Text Rendering","date":"March 24, 2010","format":false,"excerpt":"Curious about text rendering characteristics between Flash 10, Silverlight 4.0 and Photoshop, I created two small applications, one in Flash CS 4, and one in Visual Studio 2010. The Silverlight 4.0 tests are using the release candidate which was current as of March 23, 2010. I used Times New Roman\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2010\/03\/image_thumb.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":634,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/634","url_meta":{"origin":1030,"position":3},"title":"Converting RESTful XML output to formatted XML in Silverlight","date":"December 15, 2008","format":false,"excerpt":"Ever debugged output from a RESTful web service and was driven absolutely mad by the lack of formatting of the XML? Seriously, how much fun is it to stare at XML that has no line breaks or indentation whatsoever? I haven\u2019t tried to solve the problem within the IDE as\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":394,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/394","url_meta":{"origin":1030,"position":4},"title":"Some Simple Silverlight 2.0 Particles, with sticky tape &#8230;.","date":"June 29, 2008","format":false,"excerpt":"Live demo here. There are a few demos of using the HTML Canvas element floating around the web (which exists natively in WebKit, Firefox, and Opera and as a custom class using excanvas for Internet Explorer). I was inspired to clone the particle demo using Silverlight (and add a silly\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image26.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":633,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/633","url_meta":{"origin":1030,"position":5},"title":"A Silverlight 2 TilePanel","date":"December 14, 2008","format":false,"excerpt":"You may notice that the Silverlight TileBrush is missing some key properties which would enable it to actually tile a brush. The WPF TileBrush has properties such as TileMode, Viewbox, and ViewportUnits that can be used to tile an image as a fill or as a background for a UIElement.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/12\/image1.png?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1030"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/comments?post=1030"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1030\/revisions"}],"predecessor-version":[{"id":1696,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1030\/revisions\/1696"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/media?parent=1030"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/categories?post=1030"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/tags?post=1030"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}