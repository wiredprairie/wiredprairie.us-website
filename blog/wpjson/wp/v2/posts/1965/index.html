{"id":1965,"date":"2013-10-24T20:39:08","date_gmt":"2013-10-25T01:39:08","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=1965"},"modified":"2013-10-24T20:40:23","modified_gmt":"2013-10-25T01:40:23","slug":"simple-example-of-using-mongomapper-with-ruby","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1965","title":{"rendered":"Simple example of using MongoMapper with Ruby"},"content":{"rendered":"<p>The <a href=\"http:\/\/mongomapper.com\/\" target=\"_blank\">MongoMapper<\/a> web site is really lacking on even simple examples, especially those that don\u2019t use Rails. So, here\u2019s a simple example that might help someone. <\/p>\n<p>From the Gemfile:<\/p>\n<div id=\"codeSnippetWrapper\">\n<pre id=\"codeSnippet\" style=\"border-top-style: none; overflow: visible; font-size: 8pt; font-family: &#39;Courier New&#39;, courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 12pt; padding-right: 0px; background-color: #f4f4f4\">source <span style=\"color: #006080\">'https:\/\/rubygems.org'<\/span><br \/><br \/>gem <span style=\"color: #006080\">'mongo_mapper'<\/span><br \/><\/pre>\n<p><\/div>\n<p>And then the application:<\/p>\n<div id=\"codeSnippetWrapper\">\n<pre id=\"codeSnippet\" style=\"border-top-style: none; overflow: visible; font-size: 8pt; font-family: &#39;Courier New&#39;, courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 12pt; padding-right: 0px; background-color: #f4f4f4\">require <span style=\"color: #006080\">'mongo_mapper'<\/span><br \/><br \/><br \/># jam it <span style=\"color: #0000ff\">into<\/span> the <span style=\"color: #0000ff\">database<\/span> &quot;mm&quot;<font color=\"#9e7c7c\"><br \/><\/font>MongoMapper.<span style=\"color: #0000ff\">database<\/span> = &quot;mm&quot;<br \/><br \/><span style=\"color: #0000ff\">class<\/span> App<br \/><br \/>  def create_user<br \/>    <span style=\"color: #0000ff\">user<\/span> = <span style=\"color: #0000ff\">User<\/span>.<span style=\"color: #0000ff\">new<\/span>(:name =&gt; <span style=\"color: #006080\">'Johnny'<\/span>)<br \/>    puts &quot;<span style=\"color: #0000ff\">user<\/span> created&quot;<br \/>    <span style=\"color: #0000ff\">user<\/span>.<span style=\"color: #0000ff\">save<\/span>!<br \/>  <span style=\"color: #0000ff\">end<\/span><br \/><br \/>  def find_user<br \/>    query = <span style=\"color: #0000ff\">User<\/span>.<span style=\"color: #0000ff\">where<\/span>(:name =&gt; <span style=\"color: #006080\">'Johnny'<\/span>)<br \/>    <span style=\"color: #0000ff\">user<\/span> = query.<span style=\"color: #0000ff\">first<\/span>  # just the <span style=\"color: #0000ff\">first<\/span><br \/>    <span style=\"color: #0000ff\">if<\/span> <span style=\"color: #0000ff\">not<\/span> <span style=\"color: #0000ff\">user<\/span>.nil?<br \/>      puts <span style=\"color: #0000ff\">user<\/span>.id<br \/>    <span style=\"color: #0000ff\">end<\/span><br \/>  <span style=\"color: #0000ff\">end<\/span><br \/><br \/>  def delete_user<br \/>    query = <span style=\"color: #0000ff\">User<\/span>.<span style=\"color: #0000ff\">where<\/span>(:name =&gt; <span style=\"color: #006080\">'Johnny'<\/span>)<br \/>    <span style=\"color: #0000ff\">user<\/span> = query.<span style=\"color: #0000ff\">first<\/span>  # just the <span style=\"color: #0000ff\">first<\/span><br \/><br \/>    <span style=\"color: #0000ff\">user<\/span>.<span style=\"color: #0000ff\">destroy<\/span><br \/>  <span style=\"color: #0000ff\">end<\/span><br \/><span style=\"color: #0000ff\">end<\/span><br \/><br \/><br \/><span style=\"color: #0000ff\">class<\/span> <span style=\"color: #0000ff\">User<\/span><br \/>  <span style=\"color: #0000ff\">include<\/span> MongoMapper::Document<br \/>  <span style=\"color: #0000ff\">key<\/span> :name,        String<br \/>  timestamps!<br \/><span style=\"color: #0000ff\">end<\/span><br \/><br \/>app = App.<span style=\"color: #0000ff\">new<\/span>()<br \/>app.create_user<br \/>app.find_user<br \/>app.delete_user<\/pre>\n<p><\/div>\n<p>The code does a few things:<\/p>\n<ol>\n<li>Creates a new user with a single field called <strong>name.<\/strong><\/li>\n<li>Finds the user using the <strong>where<\/strong> function<\/li>\n<li>Removes (destroys\/deletes) the user<\/li>\n<\/ol>\n<p>The key things to note are that the <strong>where <\/strong>function returns a query and not the actual results. The results are fetched on demand. This is very similar to the extension methods and LINQ in .NET as those functions build a query that executed only when the results are first requested. <\/p>\n<p>The same thing is true of MongoMapper in this case. The results are not returned until the <strong>first<\/strong> function is called. Alternatively, <strong>all<\/strong> or <strong>last <\/strong>could have been used. <strong>all<\/strong> of course returning a list of results that could be iterated in a loop.<\/p>\n<p>If there were no results, the result of calling <strong>first<\/strong> in this example would be that the <strong>user<\/strong> variable would be <strong>nil. <\/strong><\/p>\n<p><em>The <strong>delete_user <\/strong>function above has absolutely no error checking. <\/em><\/p>\n","protected":false},"excerpt":{"rendered":"<p>The MongoMapper web site is really lacking on even simple examples, especially those that don\u2019t use Rails. So, here\u2019s a simple example that might help someone. From the Gemfile: source &#8216;https:\/\/rubygems.org&#8217;gem &#8216;mongo_mapper&#8217; And then the application: require &#8216;mongo_mapper&#8217;# jam it into the database &quot;mm&quot;MongoMapper.database = &quot;mm&quot;class App def create_user user = User.new(:name =&gt; &#8216;Johnny&#8217;) puts [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[5],"tags":[129,57],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-vH","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1754,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1754","url_meta":{"origin":1965,"position":0},"title":"Nest Thermostat API using Node JS and Nest API Update","date":"October 9, 2012","format":false,"excerpt":"I\u2019ve been asked by a few people for more details on the API Nest Labs uses for their thermostats, especially regarding setting data (and not just polling). The API uses mostly JSON formatted data POSTed to their web servers. Authentication To authenticate, POST the username and password, encoded as form\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1442,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1442","url_meta":{"origin":1965,"position":1},"title":"Nest Thermostat API\/Protocol","date":"January 8, 2012","format":false,"excerpt":"While Nest Labs hasn\u2019t released a formal (documented & supported) API, I thought I\u2019d do a bit of digging to see how they\u2019re using the network and what might be achievable. A few things are going on, the majority as you\u2019d probably expect. The web interface is using a long\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/image_thumb7.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1430,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1430","url_meta":{"origin":1965,"position":2},"title":"Ember.JS and EZdata, and Rails","date":"January 7, 2012","format":false,"excerpt":"I\u2019ve been trying to do some additional work on my ember.js extension for data management. At the same time though, I\u2019ve been trying (to learn and) build a simple Ruby on Rails web demo application using the new JavaScript library. There have been more than a few things that have\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1835,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1835","url_meta":{"origin":1965,"position":3},"title":"How to rewrite a MongoDB C# LINQ with a Projection Requirement using a MongoCursor","date":"January 26, 2013","format":false,"excerpt":"The LINQ Provider for MongoDB does not currently take into account data projections efficiently when returning data. This could mean that you\u2019re unnecessarily returning more data from the database than is needed. So, I\u2019m going to show you the pattern I applied as a replacement for the LINQ queries when\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":331,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/331","url_meta":{"origin":1965,"position":4},"title":"Velocity &#8212; a rockin&#8217; distributed in memory cache for ASP.NET","date":"June 3, 2008","format":false,"excerpt":"Velocity, the code-name for a new in-memory distributed caching system for ASP.NET was released as a Community Tech Preview today. What is it? It's described in the documentation: Microsoft project code named \"Velocity\" provides a highly scalable in-memory application cache for all kinds of data. By using cache, your application\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image-thumb.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":388,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/388","url_meta":{"origin":1965,"position":5},"title":"Silverlight Weather Demonstration","date":"June 26, 2008","format":false,"excerpt":"Demonstration available here. (You'll need to wait for a moment while it loads the first time). I've created a reasonably simple, yet multi-technology (and discipline) demonstration using Silverlight for the user interface and ASP.NET as the back-end. The demonstration uses: Silverlight 2.0 Data binding Delayed downloading of images \"Web services\"\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image21.png?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1965"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=1965"}],"version-history":[{"count":2,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1965\/revisions"}],"predecessor-version":[{"id":1967,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/1965\/revisions\/1967"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=1965"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=1965"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=1965"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}