{"id":1833,"date":"2013-01-26T11:04:46","date_gmt":"2013-01-26T17:04:46","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=1833"},"modified":"2013-01-26T11:05:53","modified_gmt":"2013-01-26T17:05:53","slug":"how-to-view-the-mongodb-query-when-using-the-c-linq-provider","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1833","title":{"rendered":"How to view the MongoDB Query when using the C# LINQ Provider"},"content":{"rendered":"<p>If you\u2019re using the <a href=\"http:\/\/www.mongodb.org\/display\/DOCS\/CSharp+Language+Center\">Official MongoDB C# Driver<\/a> from 10gen, you may want to occasionally verify that the generated query matches your LINQ query (or at least that it\u2019s building something efficient). <\/p>\n<p>Take for example this query:<\/p>\n<pre class=\"csharpcode\">var query = \n    (from r <span class=\"kwrd\">in<\/span> DataLayer.Database.GetCollection&lt;Research&gt;().AsQueryable&lt;Research&gt;()\n        <span class=\"kwrd\">where<\/span> !r.Deleted\n        select <span class=\"kwrd\">new<\/span>\n        {\n            Id = r.Id,\n            Title = r.Title,\n            Created = r.Created\n        }).Skip(PageSize * page).Take(PageSize);\n\nquery.DebugWriteMongoQueryText();<\/pre>\n<p><style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>I wanted to verify that the query was checking the Deleted property, and see if the projection was considered as part of the query, so a few lines of code later \u2026<\/p>\n<pre class=\"csharpcode\"><span class=\"kwrd\">public<\/span> <span class=\"kwrd\">static<\/span> <span class=\"kwrd\">string<\/span> ToMongoQueryText&lt;TQueryable&gt;(<span class=\"kwrd\">this<\/span> IQueryable&lt;TQueryable&gt; query)\n{\n    <span class=\"kwrd\">return<\/span> (query <span class=\"kwrd\">as<\/span> MongoQueryable&lt;TQueryable&gt;).GetMongoQuery().ToString();            \n}\n\n[Conditional(<span class=\"str\">&quot;DEBUG&quot;<\/span>)]\n<span class=\"kwrd\">public<\/span> <span class=\"kwrd\">static<\/span> <span class=\"kwrd\">void<\/span> DebugWriteMongoQueryText&lt;TQuerable&gt;(<span class=\"kwrd\">this<\/span> IQueryable&lt;TQuerable&gt; query)\n{\n    Debug.WriteLine(<span class=\"str\">&quot;QUERY: &quot;<\/span> + query.ToMongoQueryText());\n}<\/pre>\n<p><style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>I added two extension methods to IQueryable. As the return type for the query in my sample is actually an anonymous type, it wasn\u2019t something I could easily type in the Immediate Window in Visual Studio for example. <\/p>\n<p><a href=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2013\/01\/image1.png\"><img loading=\"lazy\" title=\"image\" style=\"border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto\" border=\"0\" alt=\"&lt;&gt;f__AnonymousType2&lt;string,string,System.DateTime&gt;\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2013\/01\/image_thumb1.png\" width=\"514\" height=\"95\" \/><\/a><\/p>\n<p>No thanks&#160; &lt;&gt;f__AnonymousType2&lt;string,string,System.DateTime&gt;.<\/p>\n<p>I added the <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/system.diagnostics.conditionalattribute(v=vs.110).aspx\">Conditional<\/a> Attribute so that the code would only execute in a Debug build of my application.<\/p>\n<pre class=\"csharpcode\">query.DebugWriteMongoQueryText();<\/pre>\n<p>The output of the query above was:<\/p>\n<pre class=\"csharpcode\">QUERY: { <span class=\"str\">&quot;Deleted&quot;<\/span> : { <span class=\"str\">&quot;$ne&quot;<\/span> : <span class=\"kwrd\">true<\/span> } }<\/pre>\n<p><style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>As you\u2019ll see, the anonymous projection wasn\u2019t considered. Unfortunately, that\u2019s a <a href=\"https:\/\/jira.mongodb.org\/browse\/CSHARP-456\">known issue<\/a> with the current driver. This mattered in my above example, as some of the fields could contain a large amount of data that wasn\u2019t needed by the current display. <\/p>\n","protected":false},"excerpt":{"rendered":"<p>If you\u2019re using the Official MongoDB C# Driver from 10gen, you may want to occasionally verify that the generated query matches your LINQ query (or at least that it\u2019s building something efficient). Take for example this query: var query = (from r in DataLayer.Database.GetCollection&lt;Research&gt;().AsQueryable&lt;Research&gt;() where !r.Deleted select new { Id = r.Id, Title = r.Title, [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[82,130,131,129],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-tz","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1835,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1835","url_meta":{"origin":1833,"position":0},"title":"How to rewrite a MongoDB C# LINQ with a Projection Requirement using a MongoCursor","date":"January 26, 2013","format":false,"excerpt":"The LINQ Provider for MongoDB does not currently take into account data projections efficiently when returning data. This could mean that you\u2019re unnecessarily returning more data from the database than is needed. So, I\u2019m going to show you the pattern I applied as a replacement for the LINQ queries when\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1820,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1820","url_meta":{"origin":1833,"position":1},"title":"Knockout binding for JavaScript route fixup","date":"January 25, 2013","format":false,"excerpt":"Part one. After the first round, I felt compelled to KnockOut the code a bit more. I\u2019d mentioned I wasn\u2019t pleased with the code exactly. It needed some refactoring. So, I\u2019ve created a new Knockout binding handler. This binding handler replaces\u00a0 named parameters with a model\u2019s properties in a path.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1857,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1857","url_meta":{"origin":1833,"position":2},"title":"Finding duplicates in MongoDB via the shell","date":"March 10, 2013","format":false,"excerpt":"I thought this was an interesting question to answer on StackOverflow (summarized here): I\u2019m trying to create an index, but an error is returned that duplicates exist for the field I want to index. What should I do? I answered with one possibility. The summary is that you can use\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1345,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1345","url_meta":{"origin":1833,"position":3},"title":"Creating a simple Entity Reference system for Ember.js","date":"December 28, 2011","format":false,"excerpt":"I had some data stored in a structure similar to this: Nothing too fancy. A table of Gift(s) and a table of Person(s). Each gift had a foreign key relationship to a Person (the person who \u201cgave\u201d the gift). Since some people may give several gifts, I didn\u2019t want to\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1397,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1397","url_meta":{"origin":1833,"position":4},"title":"A post not related to Nest thermostat hardware&hellip;.","date":"January 3, 2012","format":false,"excerpt":"I typed in https:\/\/www.nest.com this evening and instead of the nice looking Nest.com web site, I got this: What?! I hadn\u2019t actually noticed that I\u2019d typed https at first, so I was a bit baffled for a moment. After closer investigation, Nest doesn\u2019t have HTTPS apparently for their marketing\/support web\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"SNAGHTML69c9dbf8","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/SNAGHTML69c9dbf8_thumb.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1996,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1996","url_meta":{"origin":1833,"position":5},"title":"Animating an element&rsquo;s visibility using AngularJS","date":"January 31, 2014","format":false,"excerpt":"There was a question on StackOverflow about animating an element and I wanted to give it a shot, so here goes: http:\/\/jsfiddle.net\/wiredprairie\/5tFCZ\/1\/ \u00a0 Imagine nearly the simplest Angular JS application possible: <div ng-app=\"App\"> <div ng-init=\"checked=true\"> <div> <label> <input type=\"checkbox\" ng-model=\"checked\" \/>Is Visible...<\/label> <\/div> <div class=\"sample\" ng-class=\"{ hidden: !checked }\">Visible...<\/div> <\/div>\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1833"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/comments?post=1833"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1833\/revisions"}],"predecessor-version":[{"id":1834,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1833\/revisions\/1834"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/media?parent=1833"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/categories?post=1833"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/tags?post=1833"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}