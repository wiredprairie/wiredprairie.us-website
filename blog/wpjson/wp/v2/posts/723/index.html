{"id":723,"date":"2009-03-01T16:46:22","date_gmt":"2009-03-01T21:46:22","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/723"},"modified":"2010-04-29T15:01:28","modified_gmt":"2010-04-29T20:01:28","slug":"silverlight-stopwatch-class-in-c","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/723","title":{"rendered":"Silverlight Stopwatch class in C#"},"content":{"rendered":"<p>I needed a simple method for doing some timings in Silverlight. Silverlight lacks the high performance query counter that is available natively in Windows (and available in .NET 3.5 for example), but it does have a TickCount. My code (mostly) mirrors the existing .NET Stopwatch class using the TickCount property of the Environment class.<\/p>\n<p>Just create an instance of the class and call <strong>Start<\/strong> to start the timer, and then get the value of one of the\u00a0 <strong>Elapsed<em>NNN <\/em><\/strong>properties to get a live reading without stopping the timer or the <strong>Stop<\/strong> function to stop the timer completely.<\/p>\n<p><strong>Update April 4, 2010:<\/strong><\/p>\n<p>Even though there were some doubters in the comments suggesting I didn\u2019t test the original version that was here \u2013 I had \u2026 so I\u2019m confused as to why it had worked for me, yet not in current versions of Silverlight. In any case, I\u2019ve updated the code and have included a sample of how to use it. Thanks to those who provided suggested fixes.<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">using <\/span>System;\r\n<span style=\"color: blue;\">using <\/span>System.Diagnostics;\r\n\r\n<span style=\"color: blue;\">namespace <\/span>WiredPrairie.Silverlight\r\n{\r\n    <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n    \/\/\/ <\/span><span style=\"color: green;\">Stopwatch is used to measure the general performance of Silverlight functionality. Silverlight\r\n    <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">does not currently provide a high resolution timer as is available in many operating systems,\r\n    <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">so the resolution of this timer is limited to milliseconds. This class is best used to measure\r\n    <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">the relative performance of functions over many iterations.\r\n    <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n    <\/span><span style=\"color: blue;\">public sealed class <\/span><span style=\"color: #2b91af;\">Stopwatch\r\n    <\/span>{\r\n        <span style=\"color: blue;\">private long <\/span>_startTick;\r\n        <span style=\"color: blue;\">private long <\/span>_elapsed;\r\n        <span style=\"color: blue;\">private bool <\/span>_isRunning;\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Creates a new instance of the class and starts the watch immediately.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        \/\/\/ &lt;returns&gt;<\/span><span style=\"color: green;\">An instance of Stopwatch, running.<\/span><span style=\"color: gray;\">&lt;\/returns&gt;\r\n        <\/span><span style=\"color: blue;\">public static <\/span><span style=\"color: #2b91af;\">Stopwatch <\/span>StartNew()\r\n        {\r\n            <span style=\"color: #2b91af;\">Stopwatch <\/span>sw = <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">Stopwatch<\/span>();\r\n            sw.Start();\r\n            <span style=\"color: blue;\">return <\/span>sw;\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Creates an instance of the Stopwatch class.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public <\/span>Stopwatch() { }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Completely resets and deactivates the timer.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public void <\/span>Reset()\r\n        {\r\n            _elapsed = 0;\r\n            _isRunning = <span style=\"color: blue;\">false<\/span>;\r\n            _startTick = 0;\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Begins the timer.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public void <\/span>Start()\r\n        {\r\n            <span style=\"color: blue;\">if <\/span>(!_isRunning)\r\n            {\r\n                _startTick = GetCurrentTicks();\r\n                _isRunning = <span style=\"color: blue;\">true<\/span>;\r\n            }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Stops the current timer.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public void <\/span>Stop()\r\n        {\r\n            <span style=\"color: blue;\">if <\/span>(_isRunning)\r\n            {\r\n                _elapsed += GetCurrentTicks() - _startTick;\r\n                _isRunning = <span style=\"color: blue;\">false<\/span>;\r\n            }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Gets a value indicating whether the instance is currently recording.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public bool <\/span>IsRunning\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>_isRunning; }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Gets the Elapsed time as a Timespan.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public <\/span><span style=\"color: #2b91af;\">TimeSpan <\/span>Elapsed\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span><span style=\"color: #2b91af;\">TimeSpan<\/span>.FromMilliseconds(ElapsedMilliseconds); }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Gets the Elapsed time as the total number of milliseconds.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public long <\/span>ElapsedMilliseconds\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>GetCurrentElapsedTicks() \/ <span style=\"color: #2b91af;\">TimeSpan<\/span>.TicksPerMillisecond; }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Gets the Elapsed time as the total number of ticks (which is faked\r\n        <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">as Silverlight doesn't have a way to get at the actual \"Ticks\")\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public long <\/span>ElapsedTicks\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>GetCurrentElapsedTicks(); }\r\n        }\r\n\r\n        <span style=\"color: blue;\">private long <\/span>GetCurrentElapsedTicks()\r\n        {\r\n            <span style=\"color: blue;\">return <\/span>(<span style=\"color: blue;\">long<\/span>) (<span style=\"color: blue;\">this<\/span>._elapsed + (IsRunning ? (GetCurrentTicks() - _startTick) : 0));\r\n        }\r\n\r\n        <span style=\"color: blue;\">private long <\/span>GetCurrentTicks()\r\n        {\r\n            <span style=\"color: green;\">\/\/ TickCount: Gets the number of milliseconds elapsed since the system started.\r\n            <\/span><span style=\"color: blue;\">return <\/span><span style=\"color: #2b91af;\">Environment<\/span>.TickCount * <span style=\"color: #2b91af;\">TimeSpan<\/span>.TicksPerMillisecond;\r\n        }\r\n    }\r\n}<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><br \/>\nSample usage:<\/p>\n<pre class=\"code\"><span style=\"color: #2b91af;\">Stopwatch <\/span>sw1 = <span style=\"color: #2b91af;\">Stopwatch<\/span>.StartNew();\r\n<span style=\"color: #2b91af;\">Thread<\/span>.Sleep(20);\r\nsw1.Stop();\r\n<span style=\"color: #2b91af;\">Debug<\/span>.WriteLine(<span style=\"color: #a31515;\">\"Slept for 5 milliseconds ... actually: {0}\"<\/span>, sw1.ElapsedMilliseconds);<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n","protected":false},"excerpt":{"rendered":"<p>I needed a simple method for doing some timings in Silverlight. Silverlight lacks the high performance query counter that is available natively in Windows (and available in .NET 3.5 for example), but it does have a TickCount. My code (mostly) mirrors the existing .NET Stopwatch class using the TickCount property of the Environment class. Just [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4,14],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-bF","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1030,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1030","url_meta":{"origin":723,"position":0},"title":"Silverlight Stopwatch Class, Part 2","date":"April 2, 2010","format":false,"excerpt":"I recently made a fix to a Silverlight stopwatch class I wrote last year. In doing so, I decided to kick it up a notch. using (new StopwatchPlus(\"Constructor\")) { \/\/Debug.WriteLine(\"Initialized: Ellapsed Ticks: {0}, Ellapsed Milliseconds: {1}\", sw.EllapsedTicks, sw.EllapsedMilliseconds); InitializeComponent(); Thread.Sleep(600); } Instead of just a simple Stopwatch class, I added\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":426,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/426","url_meta":{"origin":723,"position":1},"title":"Visual WebGUI &#8212; Uh? Neat technology for someone else.","date":"July 16, 2008","format":false,"excerpt":"At the top of the page linked above, you can try the Ajax version or the Silverlight version of their web-mail demo. Try it. I won't say that I'm not impressed by what they've accomplished technically. It's impressive. They use a WinForms designer to build parts of the user interface\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/07\/image-thumb2.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":568,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/568","url_meta":{"origin":723,"position":2},"title":"Data Binding and Tooltips in Silverlight","date":"September 19, 2008","format":false,"excerpt":"Have you ever wanted to databind a tooltip in Silverlight (or WPF for that matter), and found that the DataContext isn't available for tooltips (the datacontext is null)? It's very annoying. Tooltips, unfortunately, aren't connected to their parents in anyway when they're created, so they loose the ability to connect\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":388,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/388","url_meta":{"origin":723,"position":3},"title":"Silverlight Weather Demonstration","date":"June 26, 2008","format":false,"excerpt":"Demonstration available here. (You'll need to wait for a moment while it loads the first time). I've created a reasonably simple, yet multi-technology (and discipline) demonstration using Silverlight for the user interface and ASP.NET as the back-end. The demonstration uses: Silverlight 2.0 Data binding Delayed downloading of images \"Web services\"\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image21.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":394,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/394","url_meta":{"origin":723,"position":4},"title":"Some Simple Silverlight 2.0 Particles, with sticky tape &#8230;.","date":"June 29, 2008","format":false,"excerpt":"Live demo here. There are a few demos of using the HTML Canvas element floating around the web (which exists natively in WebKit, Firefox, and Opera and as a custom class using excanvas for Internet Explorer). I was inspired to clone the particle demo using Silverlight (and add a silly\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image26.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1162,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1162","url_meta":{"origin":723,"position":5},"title":"Silverlight to become Microsoft&rsquo;s next VB6?","date":"November 1, 2010","format":false,"excerpt":"There was a huge uproar in the tech blogs this past week regarding some comments made by Bob Muglia (of Microsoft) as reported by Mary Joe Foley in a post entitled, \u201cMicrosoft: Our Strategy with Silverlight has shifted.\u201d The quotes that caused the most ruckus are: \u201cSilverlight is our development\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/723"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=723"}],"version-history":[{"count":4,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/723\/revisions"}],"predecessor-version":[{"id":804,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/723\/revisions\/804"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=723"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=723"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=723"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}