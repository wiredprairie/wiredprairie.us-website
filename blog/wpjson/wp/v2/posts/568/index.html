{"id":568,"date":"2008-09-19T07:53:51","date_gmt":"2008-09-19T12:53:51","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/568"},"modified":"2012-08-28T09:03:27","modified_gmt":"2012-08-28T14:03:27","slug":"silverlight","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/568","title":{"rendered":"Data Binding and Tooltips in Silverlight"},"content":{"rendered":"<p>Have you ever wanted to databind a tooltip in Silverlight (or WPF for that matter), and found that the DataContext isn&#8217;t available for tooltips (the datacontext is null)? <strong>It&#8217;s very annoying<\/strong>. Tooltips, unfortunately, aren&#8217;t connected to their parents in anyway when they&#8217;re created, so they loose the ability to connect to the proper data context that is being provided to their parent. Listboxes, textboxes, all suffer from this problem.<\/p>\n<p>In order to combat that problem, I&#8217;ve come up with a simple workaround for this data context problem.<\/p>\n<p>I&#8217;ve created a simple attached property which augments the standard tooltip property and intervenes before it is created so that the proper data context can be established. This code hasn&#8217;t been tested thoroughly, but it works in my limited testing. It could be extended to handle more edge cases, but if you&#8217;re creating advanced tooltips outside of XAML, there&#8217;s little reason to use this code.<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">public class <\/span><span style=\"color: #2b91af;\">DataBindingTooltip <\/span>{\r\n     <span style=\"color: blue;\">public static <\/span><span style=\"color: #2b91af;\">DependencyProperty <\/span>TooltipProperty;\r\n\r\n     <span style=\"color: blue;\">static <\/span>DataBindingTooltip()\r\n     {\r\n         TooltipProperty = <span style=\"color: #2b91af;\">DependencyProperty<\/span>.RegisterAttached\r\n             (<span style=\"color: #a31515;\">\"Tooltip\"<\/span>, <span style=\"color: blue;\">typeof<\/span>(<span style=\"color: blue;\">object<\/span>), \r\n             <span style=\"color: blue;\">typeof<\/span>(<span style=\"color: #2b91af;\">DataBindingTooltip<\/span>), \r\n             <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">PropertyMetadata<\/span>(TooltipChanged));\r\n     }\r\n\r\n     <span style=\"color: blue;\">public static void <\/span>SetTooltip(<span style=\"color: #2b91af;\">DependencyObject <\/span>d, <span style=\"color: blue;\">object <\/span>value)\r\n     {\r\n         d.SetValue(<span style=\"color: #2b91af;\">DataBindingTooltip<\/span>.TooltipProperty, value);\r\n     }\r\n\r\n     <span style=\"color: blue;\">public static object <\/span>GetToolTip(<span style=\"color: #2b91af;\">DependencyObject <\/span>d)\r\n     {\r\n         <span style=\"color: blue;\">return <\/span>d.GetValue(<span style=\"color: #2b91af;\">DataBindingTooltip<\/span>.TooltipProperty);\r\n     }\r\n\r\n     <span style=\"color: blue;\">private static void <\/span>TooltipChanged(<span style=\"color: #2b91af;\">DependencyObject <\/span>sender, \r\n         <span style=\"color: #2b91af;\">DependencyPropertyChangedEventArgs <\/span>e)\r\n     {\r\n         <span style=\"color: blue;\">if <\/span>(sender <span style=\"color: blue;\">is <\/span><span style=\"color: #2b91af;\">FrameworkElement<\/span>)\r\n         {\r\n             <span style=\"color: #2b91af;\">FrameworkElement <\/span>owner = sender <span style=\"color: blue;\">as <\/span><span style=\"color: #2b91af;\">FrameworkElement<\/span>;\r\n             <span style=\"color: green;\">\/\/ wait for it to be in the visual tree so that \/\/ context can be established <\/span>owner.Loaded += <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">RoutedEventHandler<\/span>(owner_Loaded);\r\n         }\r\n\r\n     }\r\n\r\n     <span style=\"color: blue;\">static void <\/span>owner_Loaded(<span style=\"color: blue;\">object <\/span>sender, <span style=\"color: #2b91af;\">RoutedEventArgs <\/span>e)\r\n     {\r\n         <span style=\"color: blue;\">if <\/span>(sender <span style=\"color: blue;\">is <\/span><span style=\"color: #2b91af;\">FrameworkElement<\/span>)\r\n         {\r\n             <span style=\"color: #2b91af;\">FrameworkElement <\/span>owner = sender <span style=\"color: blue;\">as <\/span><span style=\"color: #2b91af;\">FrameworkElement<\/span>;\r\n             <span style=\"color: green;\">\/\/ remove the event handler <\/span>owner.Loaded -= <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">RoutedEventHandler<\/span>(owner_Loaded);\r\n\r\n             <span style=\"color: #2b91af;\">DependencyObject <\/span>tooltip = \r\n                 owner.GetValue(<span style=\"color: #2b91af;\">DataBindingTooltip<\/span>.TooltipProperty) <span style=\"color: blue;\">as <\/span><span style=\"color: #2b91af;\">DependencyObject<\/span>;\r\n             <span style=\"color: blue;\">if <\/span>(tooltip != <span style=\"color: blue;\">null<\/span>)\r\n             {\r\n                 <span style=\"color: green;\">\/\/ assign the data context of the current owner control to the tooltip's datacontext <\/span>tooltip.SetValue(<span style=\"color: #2b91af;\">FrameworkElement<\/span>.DataContextProperty, \r\n                     owner.GetValue(<span style=\"color: #2b91af;\">FrameworkElement<\/span>.DataContextProperty));\r\n             }\r\n             <span style=\"color: #2b91af;\">ToolTipService<\/span>.SetToolTip(owner, tooltip);\r\n         }            \r\n     }\r\n }<\/pre>\n<p>&nbsp;<\/p>\n<p>Here&#8217;s how to use it:<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">&lt;<\/span><span style=\"color: #a31515;\">Grid <\/span><span style=\"color: red;\">x<\/span><span style=\"color: blue;\">:<\/span><span style=\"color: red;\">Name<\/span><span style=\"color: blue;\">=\"LayoutRoot\" <\/span><span style=\"color: red;\">Background<\/span><span style=\"color: blue;\">=\"White\"&gt; &lt;<\/span><span style=\"color: #a31515;\">ListBox <\/span><span style=\"color: red;\">x<\/span><span style=\"color: blue;\">:<\/span><span style=\"color: red;\">Name<\/span><span style=\"color: blue;\">=\"lb\" <\/span><span style=\"color: red;\">ItemsSource<\/span><span style=\"color: blue;\">=\"{<\/span><span style=\"color: #a31515;\">Binding <\/span><span style=\"color: red;\">Mode<\/span><span style=\"color: blue;\">=OneWay}\"&gt; &lt;<\/span><span style=\"color: #a31515;\">ListBox.ItemTemplate<\/span><span style=\"color: blue;\">&gt; &lt;<\/span><span style=\"color: #a31515;\">DataTemplate<\/span><span style=\"color: blue;\">&gt; &lt;<\/span><span style=\"color: #a31515;\">StackPanel <\/span><span style=\"color: red;\">Orientation<\/span><span style=\"color: blue;\">=\"Horizontal\"&gt; &lt;<\/span><span style=\"color: #a31515;\">local<\/span><span style=\"color: blue;\">:<\/span><span style=\"color: #a31515;\">DataBindingTooltip.Tooltip<\/span><span style=\"color: blue;\">&gt; &lt;<\/span><span style=\"color: #a31515;\">StackPanel <\/span><span style=\"color: red;\">Orientation<\/span><span style=\"color: blue;\">=\"Vertical\" &gt; &lt;<\/span><span style=\"color: #a31515;\">TextBlock <\/span><span style=\"color: red;\">Text<\/span><span style=\"color: blue;\">=\"Tooltip!\" <\/span><span style=\"color: red;\">FontWeight<\/span><span style=\"color: blue;\">=\"Bold\" \/&gt; &lt;<\/span><span style=\"color: #a31515;\">TextBlock <\/span><span style=\"color: red;\">Text<\/span><span style=\"color: blue;\">=\"{<\/span><span style=\"color: #a31515;\">Binding <\/span><span style=\"color: red;\">Name<\/span><span style=\"color: blue;\">}\" \/&gt; &lt;<\/span><span style=\"color: #a31515;\">TextBlock <\/span><span style=\"color: red;\">Text<\/span><span style=\"color: blue;\">=\"{<\/span><span style=\"color: #a31515;\">Binding <\/span><span style=\"color: red;\">Age<\/span><span style=\"color: blue;\">}\" \/&gt; &lt;\/<\/span><span style=\"color: #a31515;\">StackPanel<\/span><span style=\"color: blue;\">&gt; &lt;\/<\/span><span style=\"color: #a31515;\">local<\/span><span style=\"color: blue;\">:<\/span><span style=\"color: #a31515;\">DataBindingTooltip.Tooltip<\/span><span style=\"color: blue;\">&gt; &lt;<\/span><span style=\"color: #a31515;\">TextBlock <\/span><span style=\"color: red;\">Text<\/span><span style=\"color: blue;\">=\"{<\/span><span style=\"color: #a31515;\">Binding <\/span><span style=\"color: red;\">Name<\/span><span style=\"color: blue;\">}\" <\/span><span style=\"color: red;\">Margin<\/span><span style=\"color: blue;\">=\"4\" \/&gt; &lt;<\/span><span style=\"color: #a31515;\">TextBlock <\/span><span style=\"color: red;\">Text<\/span><span style=\"color: blue;\">=\"{<\/span><span style=\"color: #a31515;\">Binding <\/span><span style=\"color: red;\">Age<\/span><span style=\"color: blue;\">}\" <\/span><span style=\"color: red;\">Margin<\/span><span style=\"color: blue;\">=\"4\"\/&gt; &lt;\/<\/span><span style=\"color: #a31515;\">StackPanel<\/span><span style=\"color: blue;\">&gt; &lt;\/<\/span><span style=\"color: #a31515;\">DataTemplate<\/span><span style=\"color: blue;\">&gt; &lt;\/<\/span><span style=\"color: #a31515;\">ListBox.ItemTemplate<\/span><span style=\"color: blue;\">&gt; &lt;\/<\/span><span style=\"color: #a31515;\">ListBox<\/span><span style=\"color: blue;\">&gt; &lt;\/<\/span><span style=\"color: #a31515;\">Grid<\/span><span style=\"color: blue;\">&gt;<\/span><\/pre>\n<p>&nbsp;<\/p>\n<p>And, a small test sample:<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">public partial class <\/span><span style=\"color: #2b91af;\">Page <\/span>: <span style=\"color: #2b91af;\">UserControl <\/span>{\r\n    <span style=\"color: blue;\">public <\/span>Page()\r\n    {\r\n        InitializeComponent();\r\n\r\n        lb.DataContext = <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">List<\/span>&lt;<span style=\"color: #2b91af;\">Person<\/span>&gt;() { \r\n            <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">Person<\/span>(){Name=<span style=\"color: #a31515;\">\"John\"<\/span>, Age=23},\r\n            <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">Person<\/span>(){Name=<span style=\"color: #a31515;\">\"Hank\"<\/span>, Age=37},\r\n            <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">Person<\/span>(){Name=<span style=\"color: #a31515;\">\"Sally\"<\/span>, Age=31}};\r\n    }\r\n}\r\n\r\n<span style=\"color: blue;\">public class <\/span><span style=\"color: #2b91af;\">Person <\/span>{\r\n    <span style=\"color: blue;\">public string <\/span>Name { <span style=\"color: blue;\">get<\/span>; <span style=\"color: blue;\">set<\/span>; }\r\n    <span style=\"color: blue;\">public int <\/span>Age { <span style=\"color: blue;\">get<\/span>; <span style=\"color: blue;\">set<\/span>; }\r\n}<\/pre>\n<p>Which, when you put it all together results in:<\/p>\n<p><a href=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/09\/image29.png\"><img loading=\"lazy\" style=\"border: 0px;\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/09\/image-thumb8.png\" alt=\"image\" width=\"152\" height=\"163\" border=\"0\" \/><\/a><\/p>\n<p>Hopefully, you can spot the trick &#8212; as soon as the host control has been created and assigned a datacontext (in the Loaded event for the element), I set the datacontext onto the tooltip and assign it to the REAL tooltip property (via the TooltipService.Tooltip attached property).<\/p>\n<p>Hope you find this useful.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Have you ever wanted to databind a tooltip in Silverlight (or WPF for that matter), and found that the DataContext isn&#8217;t available for tooltips (the datacontext is null)? It&#8217;s very annoying. Tooltips, unfortunately, aren&#8217;t connected to their parents in anyway when they&#8217;re created, so they loose the ability to connect to the proper data context [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-9a","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":388,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/388","url_meta":{"origin":568,"position":0},"title":"Silverlight Weather Demonstration","date":"June 26, 2008","format":false,"excerpt":"Demonstration available here. (You'll need to wait for a moment while it loads the first time). I've created a reasonably simple, yet multi-technology (and discipline) demonstration using Silverlight for the user interface and ASP.NET as the back-end. The demonstration uses: Silverlight 2.0 Data binding Delayed downloading of images \"Web services\"\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image21.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":723,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/723","url_meta":{"origin":568,"position":1},"title":"Silverlight Stopwatch class in C#","date":"March 1, 2009","format":false,"excerpt":"I needed a simple method for doing some timings in Silverlight. Silverlight lacks the high performance query counter that is available natively in Windows (and available in .NET 3.5 for example), but it does have a TickCount. My code (mostly) mirrors the existing .NET Stopwatch class using the TickCount property\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":668,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/668","url_meta":{"origin":568,"position":2},"title":"Silverlight Stars\/Sparkles","date":"January 18, 2009","format":false,"excerpt":"I was in a \u201cstar\u201d mood this afternoon and created this Silverlight 2.0 demonstration. For rendering it uses the CompositionTarget.Rendering method (the easiest way to control dynamic animations such as this). It also uses the VisualStateManager in a variety of places to control the user interface. I\u2019ve become a big\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2009\/01\/image7.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1084,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1084","url_meta":{"origin":568,"position":3},"title":"Silverlight Analog\/Retro Flip Numbers","date":"June 9, 2010","format":false,"excerpt":"I\u2019m not sure what to call these exactly. I\u2019ve created a relatively simple Silverlight 4 control that emulates the old mechanical flip style numbers (or letters) displays found at airports and in old clock-radios. I call it the RetroFlipper. It\u2019s easy to use (at least for my needs). Declare an\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2010\/06\/image.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":633,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/633","url_meta":{"origin":568,"position":4},"title":"A Silverlight 2 TilePanel","date":"December 14, 2008","format":false,"excerpt":"You may notice that the Silverlight TileBrush is missing some key properties which would enable it to actually tile a brush. The WPF TileBrush has properties such as TileMode, Viewbox, and ViewportUnits that can be used to tile an image as a fill or as a background for a UIElement.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/12\/image1.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":577,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/577","url_meta":{"origin":568,"position":5},"title":"Silverlight Game Programming: Playing an Audio File","date":"October 12, 2008","format":false,"excerpt":"In my recent Silverlight game, there are a variety of sound effects that occur from bullet fires to explosions. Most of the audio files are brief, lasting only for a second or less on average. I had a few options -- put a MediaElement directly on the UI (in XAML)\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/10\/image2.png?resize=350%2C200","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/568"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/comments?post=568"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/568\/revisions"}],"predecessor-version":[{"id":1722,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/568\/revisions\/1722"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/media?parent=568"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/categories?post=568"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/tags?post=568"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}