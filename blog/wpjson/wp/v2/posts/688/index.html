{"id":688,"date":"2009-01-24T17:23:51","date_gmt":"2009-01-24T22:23:51","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/688"},"modified":"2016-04-12T16:41:49","modified_gmt":"2016-04-12T21:41:49","slug":"calculating-the-distance-between-two-zip-codes-in-c","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/688","title":{"rendered":"Calculating the distance between two Zip Codes in C#"},"content":{"rendered":"<p>How far is it from the USA Zip code 90210 to 73487 (<em>by drawing a line, not by driving<\/em>)?<\/p>\n<p>Unfortunately, there are many classes built into the .NET framework, but a zip code distance calculator isn\u2019t included. So, you\u2019d be forced to roll your own if you want to programatically answer that question, which is exactly what I did here.<\/p>\n<p>Using the U.S. year 2000 Gazetteer files, specifically the ZIP Code Tabulation Areas file found <a href=\"http:\/\/www.census.gov\/geo\/maps-data\/data\/gazetteer2015.html\" target=\"_blank\">here<\/a>, I built a wrapper class to do the calculations quickly and cleanly.<\/p>\n<p>The API is simple enough for computing the distance:<\/p>\n<pre class=\"code\"><span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"From 90210 to 73487 in miles: {0:0.##}\"<\/span>, \r\n    codes[90210].Distance(codes[73487], <span style=\"color: #2b91af;\">Measurement<\/span>.Miles));\r\n<span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"From 90210 to 73487 in kilometers: {0:0.##}\"<\/span>, \r\n    codes[90210].Distance(codes[73487], <span style=\"color: #2b91af;\">Measurement<\/span>.Kilometers));\r\n<span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"From 13126 to 49728 in miles: {0:0.##}\"<\/span>, \r\n    codes[13126] - codes[49728]);<\/pre>\n<p>Using either the method Distance or the minus operator, the distance is returned as a <strong>double<\/strong>. The default measurement is always in Miles (given that\u2019s the standard for the U.S.), but you can return the distance in Kilometers as well by using the Distance function and explicitly requesting Kilometers.<\/p>\n<p>It\u2019s easier though to just use the minus operator:<\/p>\n<pre class=\"code\">codes[13126] - codes[49728]<\/pre>\n<p>&nbsp;<\/p>\n<p>Additionally, I added support to return a list of zip codes which were within a specified distance of a zip code:<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">var <\/span>distanced = codes.FindLessThanDistance(codes[13126], 25);<\/pre>\n<p>&nbsp;<\/p>\n<p>The function, <strong>FindLessThanDistance<\/strong>, returns an IEnumerable list of ZipCode objects sorted by the distance (each ZipCode object is actually wrapped by another class that contains the distance). For maximum performance, the function is capable of caching the results so that subsequent queries are calculated much more quickly.<\/p>\n<pre class=\"code\">codes.IsCaching = <span style=\"color: blue;\">true<\/span>;<\/pre>\n<p>&nbsp;<\/p>\n<p>To use the classes, you need to download the ZIP Code Tabulation Areas file found <a href=\"http:\/\/www.census.gov\/tiger\/tms\/gazetteer\/zcta5.zip\" target=\"_blank\">here<\/a> (you might want to head to the page with instructions <a href=\"http:\/\/www.census.gov\/geo\/www\/gazetteer\/places2k.html\" target=\"_blank\">here<\/a> first), and add some code to your class like this:<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">using<\/span>(<span style=\"color: #2b91af;\">StreamReader <\/span>reader = <span style=\"color: #2b91af;\">File<\/span>.OpenText(<span style=\"color: #a31515;\">\"zcta5.txt\"<\/span>))\r\n{\r\n    <span style=\"color: #2b91af;\">ZipCodes <\/span>codes = <span style=\"color: #2b91af;\">ZipCodeReader<\/span>.ReadZipCodes(reader);\r\n    codes.IsCaching = <span style=\"color: blue;\">true<\/span>;\r\n\r\n    <span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"From 90210 to 73487 in miles: {0:0.##}\"<\/span>, \r\n        codes[90210].Distance(codes[73487], <span style=\"color: #2b91af;\">Measurement<\/span>.Miles));\r\n    <span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"From 90210 to 73487 in kilometers: {0:0.##}\"<\/span>, \r\n        codes[90210].Distance(codes[73487], <span style=\"color: #2b91af;\">Measurement<\/span>.Kilometers));\r\n    <span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"From 13126 to 49728 in miles: {0:0.##}\"<\/span>, \r\n        codes[13126] - codes[49728]);\r\n\r\n    <span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"Find all zips &lt; 25 miles from 13126:\"<\/span>);\r\n    <span style=\"color: blue;\">var <\/span>distanced = codes.FindLessThanDistance(codes[13126], 25);\r\n\r\n    <span style=\"color: blue;\">if<\/span>(distanced.Count() &gt; 0)\r\n    {\r\n        <span style=\"color: blue;\">foreach<\/span>(<span style=\"color: #2b91af;\">ZipCodeDistance <\/span>code <span style=\"color: blue;\">in <\/span>codes.FindLessThanDistance(codes[13126], 25))\r\n        {\r\n            <span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"* {0} ({1:0.##} miles)\"<\/span>, code.ZipCode.Code, code.Distance);\r\n        }\r\n    }\r\n\r\n    <span style=\"color: #2b91af;\">Console<\/span>.WriteLine(<span style=\"color: #a31515;\">\"Press any key to exit\"<\/span>);\r\n    <span style=\"color: #2b91af;\">Console<\/span>.ReadKey();\r\n}<\/pre>\n<p>&nbsp;<\/p>\n<p>I\u2019ve included the file (<em>zcta5.txt<\/em>) from the zip file as content within my project\u2019s solution like this:<\/p>\n<p><img loading=\"lazy\" style=\"display: inline; border: 0px;\" title=\"image\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2009\/01\/image16.png\" alt=\"image\" width=\"355\" height=\"148\" border=\"0\" \/><\/p>\n<p>&nbsp;<\/p>\n<p>The code for classes described above is below:<\/p>\n<p>&nbsp;<\/p>\n<pre class=\"code\"><span style=\"color: blue;\">using <\/span>System;\r\n<span style=\"color: blue;\">using <\/span>System.Collections.Generic;\r\n<span style=\"color: blue;\">using <\/span>System.Linq;\r\n<span style=\"color: blue;\">using <\/span>System.Text;\r\n<span style=\"color: blue;\">using <\/span>System.IO;\r\n\r\n<span style=\"color: blue;\">namespace <\/span>WiredPrairie.Demonstrations\r\n{\r\n    <span style=\"color: blue;\">public enum <\/span><span style=\"color: #2b91af;\">Measurement\r\n    <\/span>{\r\n        Miles,\r\n        Kilometers\r\n    }\r\n\r\n    <span style=\"color: blue;\">public class <\/span><span style=\"color: #2b91af;\">ZipCode\r\n    <\/span>{\r\n        <span style=\"color: blue;\">private double <\/span>_cosLatitude = 0.0;\r\n        <span style=\"color: blue;\">private double <\/span>_latitutde;\r\n        <span style=\"color: blue;\">private <\/span><span style=\"color: #2b91af;\">IEnumerable<\/span>&lt;<span style=\"color: #2b91af;\">ZipCodeDistance<\/span>&gt; _cachedZipDistance;\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Two-digit state code\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public string <\/span>State { <span style=\"color: blue;\">get<\/span>; <span style=\"color: blue;\">set<\/span>; }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">5 digit Postal Code\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public int <\/span>Code { <span style=\"color: blue;\">get<\/span>; <span style=\"color: blue;\">set<\/span>; }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Latitude, in Radians\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public double <\/span>Latitude\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>_latitutde; }\r\n            <span style=\"color: blue;\">set\r\n            <\/span>{\r\n                _latitutde = <span style=\"color: blue;\">value<\/span>;\r\n                _cosLatitude = <span style=\"color: #2b91af;\">Math<\/span>.Cos(<span style=\"color: blue;\">value<\/span>);\r\n            }\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Precomputed value of the Cosine of Latitutde\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">private double <\/span>CosineOfLatitutde\r\n        {\r\n            <span style=\"color: blue;\">get <\/span>{ <span style=\"color: blue;\">return <\/span>_cosLatitude; }\r\n        }\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Longitude, in Radians\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public double <\/span>Longitude { <span style=\"color: blue;\">get<\/span>; <span style=\"color: blue;\">set<\/span>; }\r\n\r\n        <span style=\"color: blue;\">public double <\/span>Distance(<span style=\"color: #2b91af;\">ZipCode <\/span>compare)\r\n        {\r\n            <span style=\"color: blue;\">return <\/span>Distance(compare, <span style=\"color: #2b91af;\">Measurement<\/span>.Miles);\r\n        }\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Computes the distance between two zip codes using the Haversine formula\r\n        <\/span><span style=\"color: gray;\">\/\/\/ <\/span><span style=\"color: green;\">(http:\/\/en.wikipedia.org\/wiki\/Haversine_formula).\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        \/\/\/ &lt;param name=\"compare\"&gt;&lt;\/param&gt;\r\n        \/\/\/ &lt;param name=\"m\"&gt;&lt;\/param&gt;\r\n        \/\/\/ &lt;returns&gt;&lt;\/returns&gt;\r\n        <\/span><span style=\"color: blue;\">public double <\/span>Distance(<span style=\"color: #2b91af;\">ZipCode <\/span>compare, <span style=\"color: #2b91af;\">Measurement <\/span>m)\r\n        {\r\n            <span style=\"color: blue;\">double <\/span>dLon = compare.Longitude - <span style=\"color: blue;\">this<\/span>.Longitude;\r\n            <span style=\"color: blue;\">double <\/span>dLat = compare.Latitude - <span style=\"color: blue;\">this<\/span>.Latitude;\r\n\r\n            <span style=\"color: blue;\">double <\/span>a = <span style=\"color: #2b91af;\">Math<\/span>.Pow(<span style=\"color: #2b91af;\">Math<\/span>.Sin(dLat \/ 2.0), 2) + \r\n                    <span style=\"color: blue;\">this<\/span>.CosineOfLatitutde * \r\n                    compare.CosineOfLatitutde * \r\n                    <span style=\"color: #2b91af;\">Math<\/span>.Pow(<span style=\"color: #2b91af;\">Math<\/span>.Sin(dLon \/ 2.0), 2.0);\r\n            \r\n            <span style=\"color: blue;\">double <\/span>c = 2 * <span style=\"color: #2b91af;\">Math<\/span>.Asin(<span style=\"color: #2b91af;\">Math<\/span>.Min(1.0, <span style=\"color: #2b91af;\">Math<\/span>.Sqrt(a)));\r\n            <span style=\"color: blue;\">double <\/span>d = (m == <span style=\"color: #2b91af;\">Measurement<\/span>.Miles ? 3956 : 6367) * c;\r\n\r\n            <span style=\"color: blue;\">return <\/span>d;\r\n        }\r\n\r\n        <span style=\"color: blue;\">public static double operator <\/span>-(<span style=\"color: #2b91af;\">ZipCode <\/span>z1, <span style=\"color: #2b91af;\">ZipCode <\/span>z2)\r\n        {\r\n            <span style=\"color: blue;\">if<\/span>(z1 == <span style=\"color: blue;\">null <\/span>|| z2 == <span style=\"color: blue;\">null<\/span>) { <span style=\"color: blue;\">throw new <\/span><span style=\"color: #2b91af;\">ArgumentNullException<\/span>(); }\r\n            <span style=\"color: blue;\">return <\/span>z1.Distance(z2);\r\n        }\r\n\r\n        <span style=\"color: blue;\">public static double <\/span>ToRadians(<span style=\"color: blue;\">double <\/span>d) {\r\n            <span style=\"color: blue;\">return <\/span>(d \/ 180) * <span style=\"color: #2b91af;\">Math<\/span>.PI;\r\n        }\r\n\r\n        <span style=\"color: blue;\">internal <\/span><span style=\"color: #2b91af;\">IEnumerable<\/span>&lt;<span style=\"color: #2b91af;\">ZipCodeDistance<\/span>&gt; DistanceCache\r\n        {\r\n            <span style=\"color: blue;\">get\r\n            <\/span>{\r\n                <span style=\"color: blue;\">return <\/span>_cachedZipDistance;\r\n            }\r\n            <span style=\"color: blue;\">set\r\n            <\/span>{\r\n                _cachedZipDistance = <span style=\"color: blue;\">value<\/span>;\r\n            }\r\n        }\r\n    }\r\n\r\n    <span style=\"color: blue;\">public class <\/span><span style=\"color: #2b91af;\">ZipCodeDistance\r\n    <\/span>{\r\n        <span style=\"color: blue;\">public <\/span><span style=\"color: #2b91af;\">ZipCode <\/span>ZipCode { <span style=\"color: blue;\">get<\/span>; <span style=\"color: blue;\">set<\/span>; }\r\n        <span style=\"color: blue;\">public double <\/span>Distance { <span style=\"color: blue;\">get<\/span>; <span style=\"color: blue;\">set<\/span>; }\r\n    }\r\n\r\n    <span style=\"color: blue;\">public class <\/span><span style=\"color: #2b91af;\">ZipCodes <\/span>: <span style=\"color: #2b91af;\">Dictionary<\/span>&lt;<span style=\"color: blue;\">int<\/span>, <span style=\"color: #2b91af;\">ZipCode<\/span>&gt;\r\n    {\r\n        <span style=\"color: blue;\">private const double <\/span>MaxDistance = 100.0;\r\n\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Gets and sets whether the ZipCodes class caches all search results.\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        <\/span><span style=\"color: blue;\">public bool <\/span>IsCaching { <span style=\"color: blue;\">get<\/span>; <span style=\"color: blue;\">set<\/span>; }\r\n        <span style=\"color: gray;\">\/\/\/ &lt;summary&gt;\r\n        \/\/\/ <\/span><span style=\"color: green;\">Find all Zip Codes less than a specified distance\r\n        <\/span><span style=\"color: gray;\">\/\/\/ &lt;\/summary&gt;\r\n        \/\/\/ &lt;param name=\"startingZipCode\"&gt;<\/span><span style=\"color: green;\">Provide the starting zip code as an object<\/span><span style=\"color: gray;\">&lt;\/param&gt;\r\n        \/\/\/ &lt;param name=\"distance\"&gt;<\/span><span style=\"color: green;\">Maximum distance from starting zip code<\/span><span style=\"color: gray;\">&lt;\/param&gt;\r\n        \/\/\/ &lt;returns&gt;<\/span><span style=\"color: green;\">List of ZipCodeDistance objects, sorted by distance.<\/span><span style=\"color: gray;\">&lt;\/returns&gt;\r\n        <\/span><span style=\"color: blue;\">public <\/span><span style=\"color: #2b91af;\">IEnumerable<\/span>&lt;<span style=\"color: #2b91af;\">ZipCodeDistance<\/span>&gt; FindLessThanDistance(<span style=\"color: #2b91af;\">ZipCode <\/span>startingZipCode, <span style=\"color: blue;\">double <\/span>distance)\r\n        {\r\n            <span style=\"color: blue;\">if<\/span>(distance &gt; MaxDistance) \r\n            { \r\n                <span style=\"color: blue;\">throw new <\/span><span style=\"color: #2b91af;\">ArgumentOutOfRangeException<\/span>(<span style=\"color: #a31515;\">\"distance\"<\/span>, \r\n                    <span style=\"color: blue;\">string<\/span>.Format(<span style=\"color: #a31515;\">\"Must be less than {0}.\"<\/span>, MaxDistance)); \r\n            }\r\n\r\n            <span style=\"color: #2b91af;\">IEnumerable<\/span>&lt;<span style=\"color: #2b91af;\">ZipCodeDistance<\/span>&gt; codes1 = <span style=\"color: blue;\">null<\/span>;\r\n            <span style=\"color: blue;\">if<\/span>(startingZipCode.DistanceCache == <span style=\"color: blue;\">null<\/span>)\r\n            {\r\n                <span style=\"color: green;\">\/\/ grab all less than the MaxDistance in first pass\r\n                <\/span>codes1 = <span style=\"color: blue;\">from <\/span>c <span style=\"color: blue;\">in this<\/span>.Values\r\n                         <span style=\"color: blue;\">let <\/span>d = c - startingZipCode\r\n                         <span style=\"color: blue;\">where <\/span>(d &lt;= MaxDistance)\r\n                         <span style=\"color: blue;\">orderby <\/span>d\r\n                         <span style=\"color: blue;\">select new <\/span><span style=\"color: #2b91af;\">ZipCodeDistance<\/span>() { ZipCode = c, Distance = d };\r\n                <span style=\"color: green;\">\/\/ this might just be temporary storage depending on caching settings\r\n                <\/span>startingZipCode.DistanceCache = codes1;\r\n            }\r\n            <span style=\"color: blue;\">else\r\n            <\/span>{\r\n                <span style=\"color: green;\">\/\/ grab the cached copy\r\n                <\/span>codes1 = startingZipCode.DistanceCache;\r\n            }\r\n            <span style=\"color: #2b91af;\">List<\/span>&lt;<span style=\"color: #2b91af;\">ZipCodeDistance<\/span>&gt; filtered = <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">List<\/span>&lt;<span style=\"color: #2b91af;\">ZipCodeDistance<\/span>&gt;();\r\n\r\n            <span style=\"color: blue;\">foreach<\/span>(<span style=\"color: #2b91af;\">ZipCodeDistance <\/span>zcd <span style=\"color: blue;\">in <\/span>codes1)\r\n            {\r\n                <span style=\"color: green;\">\/\/ since the list is pre-sorted, we can now drop out \r\n                \/\/ quickly and efficiently as soon as something doesn't\r\n                \/\/ match\r\n                <\/span><span style=\"color: blue;\">if<\/span>(zcd.Distance &gt; distance)\r\n                {\r\n                    <span style=\"color: blue;\">break<\/span>;\r\n                }\r\n                filtered.Add(zcd);\r\n            }\r\n            \r\n            <span style=\"color: green;\">\/\/ if no caching, don't leave the cached result in place\r\n            <\/span><span style=\"color: blue;\">if<\/span>(!IsCaching) { startingZipCode.DistanceCache = <span style=\"color: blue;\">null<\/span>; }\r\n            <span style=\"color: blue;\">return <\/span>filtered;\r\n        }\r\n    }\r\n\r\n    <span style=\"color: blue;\">public static class <\/span><span style=\"color: #2b91af;\">ZipCodeReader\r\n    <\/span>{\r\n        <span style=\"color: blue;\">public static <\/span><span style=\"color: #2b91af;\">ZipCodes <\/span>ReadZipCodes(<span style=\"color: #2b91af;\">Stream <\/span>stream)\r\n        {\r\n            <span style=\"color: blue;\">if<\/span>(stream == <span style=\"color: blue;\">null<\/span>) { <span style=\"color: blue;\">throw new <\/span><span style=\"color: #2b91af;\">ArgumentNullException<\/span>(<span style=\"color: #a31515;\">\"stream\"<\/span>); }\r\n\r\n            <span style=\"color: blue;\">using <\/span>(<span style=\"color: #2b91af;\">StreamReader <\/span>reader = <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">StreamReader<\/span>(stream))\r\n            {\r\n                <span style=\"color: blue;\">return <\/span>ReadZipCodes(reader);\r\n            }                        \r\n        }\r\n\r\n        <span style=\"color: blue;\">public static <\/span><span style=\"color: #2b91af;\">ZipCodes <\/span>ReadZipCodes(<span style=\"color: #2b91af;\">StreamReader <\/span>reader)\r\n        {\r\n            <span style=\"color: green;\">\/*\r\n             * From documentation found here: http:\/\/www.census.gov\/geo\/www\/gazetteer\/places2k.html\r\n                The ZCTA file contains data for all 5 digit ZCTAs in the 50 states, \r\n                         District of Columbia and Puerto Rico as of Census 2000. The file is plain ASCII text, one line per record.\r\n\r\n                Columns 1-2: United States Postal Service State Abbreviation\r\n                Columns 3-66: Name (e.g. 35004 5-Digit ZCTA - there are no post office names)\r\n                Columns 67-75: Total Population (2000)\r\n                Columns 76-84: Total Housing Units (2000)\r\n                Columns 85-98: Land Area (square meters) - Created for statistical purposes only.\r\n                Columns 99-112: Water Area (square meters) - Created for statistical purposes only.\r\n                Columns 113-124: Land Area (square miles) - Created for statistical purposes only.\r\n                Columns 125-136: Water Area (square miles) - Created for statistical purposes only.\r\n                Columns 137-146: Latitude (decimal degrees) First character is blank or \"-\" denoting North or South latitude respectively\r\n                Columns 147-157: Longitude (decimal degrees) First character is blank or \"-\" denoting East or West longitude respectively             \r\n             *\/\r\n            <\/span><span style=\"color: blue;\">if<\/span>(reader == <span style=\"color: blue;\">null<\/span>) { <span style=\"color: blue;\">throw new <\/span><span style=\"color: #2b91af;\">ArgumentNullException<\/span>(<span style=\"color: #a31515;\">\"reader\"<\/span>); } \r\n            \r\n            <span style=\"color: #2b91af;\">ZipCodes <\/span>codes = <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">ZipCodes<\/span>();\r\n            <span style=\"color: blue;\">string <\/span>line = reader.ReadLine();\r\n            <span style=\"color: blue;\">while<\/span>(!<span style=\"color: blue;\">string<\/span>.IsNullOrEmpty(line))\r\n            {\r\n                <span style=\"color: blue;\">int <\/span>code = 0;\r\n                <span style=\"color: blue;\">double <\/span>lat = 0;\r\n                <span style=\"color: blue;\">double <\/span>lon = 0;\r\n                <span style=\"color: green;\">\/\/ skip lines that aren't valid\r\n                <\/span><span style=\"color: blue;\">if<\/span>(<span style=\"color: #2b91af;\">Int32<\/span>.TryParse(line.Substring(2, 5), <span style=\"color: blue;\">out <\/span>code) &amp;&amp;\r\n                    <span style=\"color: blue;\">double<\/span>.TryParse(line.Substring(136, 10), <span style=\"color: blue;\">out <\/span>lat) &amp;&amp;\r\n                    <span style=\"color: blue;\">double<\/span>.TryParse(line.Substring(146, 10), <span style=\"color: blue;\">out <\/span>lon)\r\n                    )\r\n                {\r\n                    <span style=\"color: green;\">\/\/ there are a few duplicates due to state boundaries,\r\n                    \/\/ ignore them\r\n                    <\/span><span style=\"color: blue;\">if<\/span>(!codes.ContainsKey(code))\r\n                    {                        \r\n                        codes.Add(code, <span style=\"color: blue;\">new <\/span><span style=\"color: #2b91af;\">ZipCode<\/span>()\r\n                        {\r\n                            State = line.Substring(0, 2),\r\n                            Code = code,                            \r\n                            Latitude = <span style=\"color: #2b91af;\">ZipCode<\/span>.ToRadians(lat),\r\n                            Longitude = <span style=\"color: #2b91af;\">ZipCode<\/span>.ToRadians(lon),\r\n                        });\r\n                    }\r\n                }\r\n                line = reader.ReadLine();\r\n            }\r\n            <span style=\"color: blue;\">return <\/span>codes;\r\n        }        \r\n    }\r\n}<\/pre>\n<p>&nbsp;<\/p>\n<p>The distance formulate is calculated using the <a href=\"http:\/\/en.wikipedia.org\/wiki\/Haversine_formula\" target=\"_blank\">Haversine<\/a> formula. This code should work in ASP.NET, WPF, WindowsForms, and Silverlight with no issues.<\/p>\n<p><img loading=\"lazy\" style=\"display: inline; border: 0px;\" title=\"image\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2009\/01\/image17.png\" alt=\"image\" width=\"335\" height=\"426\" border=\"0\" \/><\/p>\n<p>Enjoy.<\/p>\n<p>One obvious improvement would be to remove the unnecessary information from the Zip code file (as it\u2019s 5MB in size unexpanded).<\/p>\n","protected":false},"excerpt":{"rendered":"<p>How far is it from the USA Zip code 90210 to 73487 (by drawing a line, not by driving)? Unfortunately, there are many classes built into the .NET framework, but a zip code distance calculator isn\u2019t included. So, you\u2019d be forced to roll your own if you want to programatically answer that question, which is [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-b6","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":159,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/159","url_meta":{"origin":688,"position":0},"title":"In an alternate Universe, .NET code executes in parallel","date":"April 28, 2008","format":false,"excerpt":"Actually, it's right here as the Microsoft Parallel Extensions to the .NET 3.5 Framework Dec. 2007 CTP (what a mouthful!). If you're not familiar with these extensions, the brief summary is simple (straight from MSDN): Parallel Extensions to the .NET Framework is a managed programming model for data parallelism, task\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1597,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1597","url_meta":{"origin":688,"position":1},"title":"Paging Data with SQL Server Compact","date":"April 1, 2012","format":false,"excerpt":"If you\u2019re using SQL Server Compact Editition version 4 or higher, there\u2019s finally a decent and efficient way to do data paging: var streets = db.Query<StreetName>(@\"SELECT * FROM StreetNames ORDER BY Id OFFSET @offset ROWS FETCH NEXT @rows ROWS ONLY\", new { offset = group * GroupSize, rows = GroupSize\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/04\/image9.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":785,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/785","url_meta":{"origin":688,"position":2},"title":"A forgetful DSL modem&hellip;.","date":"June 4, 2009","format":false,"excerpt":"Our household DSL modem, which is generally very reliable, occasionally, and mysteriously seems to forget a setting that I like to enable. I don\u2019t know why, and I\u2019ve never determined whether there\u2019s a pattern to the loss or not (like maybe it\u2019s every 30 days or some crazy thing like\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":127,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/127","url_meta":{"origin":688,"position":3},"title":"LINQPad &#8211; More than just a LINQ editor","date":"April 15, 2008","format":false,"excerpt":"I stumbled across this .NET 3.5+ utility today, LINQPad. I think I'll be putting this on every development machine I control -- it's been very handy today. At first I thought it was just a live LINQ viewer\/editor (which is useful on it's own!). But, in order to support that\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/04\/image-thumb33.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":22,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/22","url_meta":{"origin":688,"position":4},"title":"Converting a mapped drive letter to a network path using C#","date":"March 2, 2008","format":false,"excerpt":"Occasionally you might have the need to convert a mapped drive letter to a UNC or network path. For example, a drive letter such as\u00a0 \"Z\" might be mapped to a network share: In this example, the \"Z\" drive is mapped to a \"Personal\" folder on a server named \"Home\".\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":723,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/723","url_meta":{"origin":688,"position":5},"title":"Silverlight Stopwatch class in C#","date":"March 1, 2009","format":false,"excerpt":"I needed a simple method for doing some timings in Silverlight. Silverlight lacks the high performance query counter that is available natively in Windows (and available in .NET 3.5 for example), but it does have a TickCount. My code (mostly) mirrors the existing .NET Stopwatch class using the TickCount property\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/688"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=688"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/688\/revisions"}],"predecessor-version":[{"id":2050,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/688\/revisions\/2050"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=688"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=688"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=688"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}