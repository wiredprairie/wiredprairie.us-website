{"id":633,"date":"2008-12-14T16:47:04","date_gmt":"2008-12-14T21:47:04","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/633"},"modified":"2008-12-14T16:47:04","modified_gmt":"2008-12-14T21:47:04","slug":"a-silverlight-2-tilepanel","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/633","title":{"rendered":"A Silverlight 2 TilePanel"},"content":{"rendered":"<p>You may notice that the Silverlight <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/system.windows.media.tilebrush(VS.95).aspx\">TileBrush<\/a> is missing some key properties which would enable it to actually tile a brush. The WPF <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/system.windows.media.tilebrush.aspx\">TileBrush<\/a> has properties such as TileMode, Viewbox, and ViewportUnits that can be used to tile an image as a fill or as a background for a UIElement. For some reason, they\u2019re not implemented in Silverlight. <\/p>\n<p>The Silverlight object framework is far more closed than the equivalent WPF framework. There are <strong>many <\/strong>more sealed class types and methods in Silverlight than in WPF. For example, Canvas in Silverlight is sealed. If you want to make a more interesting Canvas of some sort, you need to implement it from a base Panel. It\u2019s not clear why classes such as Canvas are sealed in Silverlight.<\/p>\n<p>Back to the TileBrush. <\/p>\n<p>It\u2019s not practical to try to extend the existing TileBrush in Silverlight to provide the tiling support offered by WPF so I took a very different approach.<\/p>\n<p>As my tiling needs were straightforward, I created a new control, derived from Panel. The new control is called TilePanel. The TilePanel\u2019s one and only task is, given an ImageBrush, and a few tile size values, tiles the brush to fill it\u2019s container completely.<\/p>\n<p>The use of the TilePanel is straightforward:<\/p>\n<pre class=\"code\"><span style=\"color: blue\">&lt;<\/span><span style=\"color: #a31515\">local<\/span><span style=\"color: blue\">:<\/span><span style=\"color: #a31515\">TilePanel <\/span><span style=\"color: red\">x<\/span><span style=\"color: blue\">:<\/span><span style=\"color: red\">Name<\/span><span style=\"color: blue\">=&quot;pnlTile&quot; <\/span><span style=\"color: red\">TileWidth<\/span><span style=\"color: blue\">=&quot;32&quot; <\/span><span style=\"color: red\">TileHeight<\/span><span style=\"color: blue\">=&quot;16&quot;&gt;\n    &lt;<\/span><span style=\"color: #a31515\">local<\/span><span style=\"color: blue\">:<\/span><span style=\"color: #a31515\">TilePanel.Image<\/span><span style=\"color: blue\">&gt;\n        &lt;<\/span><span style=\"color: #a31515\">ImageBrush <\/span><span style=\"color: red\">ImageSource<\/span><span style=\"color: blue\">=&quot;LED64x32-rect.png&quot; \/&gt;\n    &lt;\/<\/span><span style=\"color: #a31515\">local<\/span><span style=\"color: blue\">:<\/span><span style=\"color: #a31515\">TilePanel.Image<\/span><span style=\"color: blue\">&gt;                   \n&lt;\/<\/span><span style=\"color: #a31515\">local<\/span><span style=\"color: blue\">:<\/span><span style=\"color: #a31515\">TilePanel<\/span><span style=\"color: blue\">&gt;<\/span><\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>Above, you\u2019ll see the panel declaration, the width and height of the tile, and the brush that is used as the tiled image.<\/p>\n<p>The TilePanel handles all of the details. <\/p>\n<p>I created a small demo program to show off the tile support.<\/p>\n<p><a target=\"_blank\" href=\"http:\/\/www.wiredprairie.us\/examples\/silverlight\/LEDDemo\/default.html\"><img loading=\"lazy\" style=\"border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/12\/image1.png\" width=\"317\" height=\"316\" \/><\/a> <\/p>\n<p>We have an exercise bicycle with an LED style display that inspired the simple demo program. It displays statistics and messages through the use of the bicycle. The demo allows you to change the text and the shape of the LED. Additionally, it shows how the tiles can be semi-transparent (the images used are 24-bit PNGs), allowing the content underneath to show through. In this case, it\u2019s a large TextBlock which is animated within a clipped Canvas.<\/p>\n<pre class=\"code\"><span style=\"color: #2b91af\">DispatcherTimer <\/span>tmr = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">DispatcherTimer<\/span>();\ntmr.Interval = <span style=\"color: #2b91af\">TimeSpan<\/span>.FromMilliseconds(250);\ntmr.Tick += <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">EventHandler<\/span>(UpdateCharacterPosition);\ntmr.Start();<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>Any time the overall canvas changes size, the code adjusts the Clip property to a new rectangle (otherwise the text appears outside of the boundaries of the LED display).<\/p>\n<pre class=\"code\"><span style=\"color: blue\">private void <\/span>TextHolderSizeChanged(<span style=\"color: blue\">object <\/span>sender, <br \/><span style=\"color: #2b91af\">SizeChangedEventArgs <\/span>e)\n{\n    <span style=\"color: blue\">if <\/span>(sender <span style=\"color: blue\">is <\/span><span style=\"color: #2b91af\">Canvas<\/span>)\n    {\n        <span style=\"color: #2b91af\">Canvas <\/span>c = sender <span style=\"color: blue\">as <\/span><span style=\"color: #2b91af\">Canvas<\/span>;\n        <span style=\"color: #2b91af\">RectangleGeometry <\/span>rc = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">RectangleGeometry<\/span>();\n        rc.Rect = <span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">Rect<\/span>(<span style=\"color: blue\">new <\/span><span style=\"color: #2b91af\">Point<\/span>(0, 0), e.NewSize);\n        c.Clip = rc;\n    }\n}<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>To more efficiently update the TilePanel when multiple properties are being set at one time, I took a queued approach to the update:<\/p>\n<pre class=\"code\"><span style=\"color: blue\">protected void <\/span>TileAdjustmentNeededAsync()\n{\n    <span style=\"color: green\">\/\/ by doing this sync, we can queue up several request\n    \/\/ but then really only handle the last one.\n    <\/span>_needsUpdate = <span style=\"color: blue\">true<\/span>;\n    <span style=\"color: green\">\/\/ async call the adjust tiles\n    <\/span><span style=\"color: blue\">this<\/span>.Dispatcher.BeginInvoke(<span style=\"color: blue\">delegate\n    <\/span>{\n        AdjustTiles();\n    });\n}<\/pre>\n<p><a href=\"http:\/\/11011.net\/software\/vspaste\"><\/a><\/p>\n<p>This way, a few properties can be set together, without the TilePanel needlessly recalculating and rebuilding the tiles.<\/p>\n<p>The demo and the source code are located <a target=\"_blank\" href=\"http:\/\/www.wiredprairie.us\/downloads\/TilePanel.zip\">here<\/a> (zip). <\/p>\n<p><strong>A few notes for those interested \u2026<\/strong><\/p>\n<p>For maximum efficiency, if you use the TilePanel, try to make the Tiles sized so that fewer tiles are actually necessary to tile (create the tiles so that there are tiles within the brush you use). Instead of a tile that has only one image in it for example, consider building a tile which is really a 2 x 2 set of tiles.<\/p>\n<p>One detail of the implementation that is important: you cannot reliably add new controls\/UIElements to the Children collection of a Panel within the MeasureOverride or ArrangeOverride methods. Although the child UIElements are added without error, they typically will not render or display correctly. Building something like this TilePanel required a trick where the actual updates to the tiles always happen outside of the scope of an measure-arrange pass.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>You may notice that the Silverlight TileBrush is missing some key properties which would enable it to actually tile a brush. The WPF TileBrush has properties such as TileMode, Viewbox, and ViewportUnits that can be used to tile an image as a fill or as a background for a UIElement. For some reason, they\u2019re not [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[153],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-ad","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":389,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/389","url_meta":{"origin":633,"position":0},"title":"Silverlight (and Flex), not for LOB applications?","date":"June 27, 2008","format":false,"excerpt":"Shawn suggests that line of business applications should not be written using Silverlight (and hence Flex), instead XBAPs (the run in browser Windows-only WPF solution). IT shops, with trimmed budgets and staff, have little time to maintain workstations and troubleshoot interactions between various installed applications. Web applications, although they may\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":388,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/388","url_meta":{"origin":633,"position":1},"title":"Silverlight Weather Demonstration","date":"June 26, 2008","format":false,"excerpt":"Demonstration available here. (You'll need to wait for a moment while it loads the first time). I've created a reasonably simple, yet multi-technology (and discipline) demonstration using Silverlight for the user interface and ASP.NET as the back-end. The demonstration uses: Silverlight 2.0 Data binding Delayed downloading of images \"Web services\"\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image21.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":172,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/172","url_meta":{"origin":633,"position":2},"title":"Silverlight &#8212; it ain&#8217;t your papa&#8217;s WPF","date":"May 1, 2008","format":false,"excerpt":"John Gossman, architect of the WPF team (desktop and subset taht supplies UI framework for Silverlight), discusses a few of the pain points developers and designers are facing today with WPF to Silverlight portability. From his post: The above example is a bit of a special case, and I don't\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":543,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/543","url_meta":{"origin":633,"position":3},"title":"Where do you &quot;event&quot;?","date":"September 4, 2008","format":false,"excerpt":"From JohnPapa.net, \"Siliverlight 2-Tip - Declaring Events.\" He thinks that the place to wire up an event is always in code rather than in markup (like XAML). \"What\u2019s my opinion? I firmly believe the handlers belong in the code and not in the XAML.\" I'd suggest that's not always right\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1701,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1701","url_meta":{"origin":633,"position":4},"title":"Windows 8 WinRT\/Metro Missing UpdateSourceTrigger","date":"August 5, 2012","format":false,"excerpt":"If you\u2019ve done WPF or Silverlight programming, you may have found an occasion where using the Binding property UpdateSourceTrigger set to PropertyChanged was extremely useful. (I know I have!) It may have looked something like this: <TextBox Text=\"{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}\" \/> The key feature was the live updating of the\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":640,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/640","url_meta":{"origin":633,"position":5},"title":"Silverlight&rsquo;s ItemsPanelTemplate, Horizontal Only?","date":"December 21, 2008","format":false,"excerpt":"Have you tried to create a horizontally oriented ListBox in Silverlight with a custom ItemsPaneltemplate, with a Panel of type other than StackPanel? If you have, you\u2019ll likely have run into the same problem I have \u2013 you can\u2019t really do it. Unfortunately, the ItemsControl (which the ListBox derives from),\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/633"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/comments?post=633"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/633\/revisions"}],"predecessor-version":[{"id":754,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/posts\/633\/revisions\/754"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/media?parent=633"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/categories?post=633"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wpjson\/wp\/v2\/tags?post=633"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}