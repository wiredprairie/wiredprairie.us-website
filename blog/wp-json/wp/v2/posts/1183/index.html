{"id":1183,"date":"2011-02-06T17:44:47","date_gmt":"2011-02-06T22:44:47","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1183"},"modified":"2011-02-07T07:01:59","modified_gmt":"2011-02-07T12:01:59","slug":"derserializing-asp-net-mvc-json-formatted-date-strings","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1183","title":{"rendered":"Derserializing ASP.NET MVC JSON formatted Date strings"},"content":{"rendered":"<p>Have you called an Ajax based action in MVC, only to find that the Date format is being serialized into something that isn\u2019t entirely useful on the client?<\/p>\n<p><strong>{&#8220;result&#8221;:[{&#8220;Author&#8221;:&#8221;Aaron&#8221;,&#8221;SentAt&#8221;:&#8221;\\\/Date(1296824894700)\\\/&#8221;,&#8221;Text&#8221;:&#8221;Blah Blah&#8221;,&#8221;Id&#8221;:1}],&#8221;runAt&#8221;:&#8221;\\\/Date(1297031297600)\\\/&#8221;}<\/strong><\/p>\n<p>You\u2019ll see that the Date is:<\/p>\n<p><strong>\\\/Date(1296824894700)\\\/<\/strong><\/p>\n<p>Alas, that\u2019s not very friendly. For a quick translation, I added the following to jQuery\u2019s <a href=\"http:\/\/api.jquery.com\/jQuery.ajax\/\"><strong>dataFilter<\/strong><\/a> property so that the date would be formatted in a more human readable format. The <strong>dataFilter<\/strong> function is used to sanitize a response from a web server.&#160; Here\u2019s what I added:<\/p>\n<pre class=\"code\">$(<span style=\"color: blue\">function <\/span>() {\n    $.ajaxSettings.dataFilter = <span style=\"color: blue\">function <\/span>(data, type) {\n        <span style=\"color: blue\">if <\/span>(type === <span style=\"color: maroon\">'json'<\/span>) {\n            <span style=\"color: #006400\">\/\/ convert things that look like Dates into a UTC Date string\n            \/\/ and completely replace them. \n            <\/span>data = data.replace(\/(.*?\")(\\\\\\\/Date\\([0-9\\-]+\\)\\\\\\\/)(\")\/g,\n                <span style=\"color: blue\">function <\/span>(fullMatch, $1, $2, $3) {\n                    <span style=\"color: blue\">try <\/span>{\n                        <span style=\"color: blue\">return <\/span>$1 + <span style=\"color: blue\">new <\/span>Date(parseInt($2.substr(7))).toUTCString() + $3;\n                    }\n                    <span style=\"color: blue\">catch <\/span>(e) {}\n                    <span style=\"color: #006400\">\/\/ something miserable happened, just return the original string            \n                    <\/span><span style=\"color: blue\">return <\/span>$1 + $2 + $3;\n                });\n        }\n        <span style=\"color: blue\">return <\/span>data;\n    };\n});<\/pre>\n<p>The trick for converting the \/\\Date(#)\\\/ syntax easily was from <a href=\"http:\/\/stackoverflow.com\/questions\/206384\/how-to-format-json-date\">StackOverflow<\/a>. It even handles time zone info.<\/p>\n<p>I added a regular expression to look for the various elements that represent a Date in Microsoft JSON serialization format. The resulting date is reformatted to a human readable string. There are 3 capturing groups that I\u2019ve named $1, $2, and $3 which need to be preserved otherwise the JSON string is mangled beyond recognition. Those are returned concatenated to preserve the original formatting of the string.<\/p>\n<p>The resulting date is translated to something like: <\/p>\n<p><strong>Fri, 4 Feb 2011 13:08:14 UTC<\/strong><\/p>\n<p>Of course, you could do whatever formatting you\u2019d like.<\/p>\n<p>&#160;<\/p>\n<h3>Bonus<\/h3>\n<p>And, as a bonus, you did notice that if you\u2019re using IE9, that the developer tools now have a network trace? Cool. (I\u2019ll still use fiddler for many things, but this will be very handy on machines that don\u2019t have fiddler installed).<\/p>\n<p><img loading=\"lazy\" style=\"background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px\" title=\"SNAGHTML51b4c85a\" border=\"0\" alt=\"SNAGHTML51b4c85a\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/02\/SNAGHTML51b4c85a.png\" width=\"450\" height=\"356\" \/><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Have you called an Ajax based action in MVC, only to find that the Date format is being serialized into something that isn\u2019t entirely useful on the client? {&#8220;result&#8221;:[{&#8220;Author&#8221;:&#8221;Aaron&#8221;,&#8221;SentAt&#8221;:&#8221;\\\/Date(1296824894700)\\\/&#8221;,&#8221;Text&#8221;:&#8221;Blah Blah&#8221;,&#8221;Id&#8221;:1}],&#8221;runAt&#8221;:&#8221;\\\/Date(1297031297600)\\\/&#8221;} You\u2019ll see that the Date is: \\\/Date(1296824894700)\\\/ Alas, that\u2019s not very friendly. For a quick translation, I added the following to jQuery\u2019s dataFilter property so [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4],"tags":[38,37,35],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-j5","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1754,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1754","url_meta":{"origin":1183,"position":0},"title":"Nest Thermostat API using Node JS and Nest API Update","date":"October 9, 2012","format":false,"excerpt":"I\u2019ve been asked by a few people for more details on the API Nest Labs uses for their thermostats, especially regarding setting data (and not just polling). The API uses mostly JSON formatted data POSTed to their web servers. Authentication To authenticate, POST the username and password, encoded as form\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1181,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1181","url_meta":{"origin":1183,"position":1},"title":"jQuery 1.5, jquery.validate and Ajax\/getJSON","date":"February 5, 2011","format":false,"excerpt":"Apparently, the new version of jQuery conflicts with the version of the jquery.validate plugin that is included with Microsoft\u2019s MVC 3 template. After a frustrating hour of debugging and using Fiddler (as I didn\u2019t realize the problem was related to a plugin I wasn\u2019t actively using on the web page),\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/02\/image3.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1800,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1800","url_meta":{"origin":1183,"position":2},"title":"Named routing with Knockout, ASP.NET MVC, and AttributeRouting, from JavaScript","date":"January 24, 2013","format":false,"excerpt":"It's hard to describe exactly what I've built here, but I'm just throwing these pieces out on the Internet in case someone: a) finds them useful, or b) has a better solution. Goals: Named routes, with a wee bit of a Rails feel A Knockout friendly syntax for binding to\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1442,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1442","url_meta":{"origin":1183,"position":3},"title":"Nest Thermostat API\/Protocol","date":"January 8, 2012","format":false,"excerpt":"While Nest Labs hasn\u2019t released a formal (documented & supported) API, I thought I\u2019d do a bit of digging to see how they\u2019re using the network and what might be achievable. A few things are going on, the majority as you\u2019d probably expect. The web interface is using a long\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/image_thumb7.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1563,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1563","url_meta":{"origin":1183,"position":4},"title":"Knockout.JS: AsDictionary","date":"March 9, 2012","format":false,"excerpt":"I frequently find that I have an array of objects in JavaScript that I want to display in a particular order and also have the ability to quickly locate an object by an ID or a key (and not use the indexOf function). As my recent project is using Knockout.JS,\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/03\/image3.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1836,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1836","url_meta":{"origin":1183,"position":5},"title":"Smarter queuing of files using jQuery deferred and when","date":"February 13, 2013","format":false,"excerpt":"I had a somewhat simple need \u2026a single web page style application using Backbone.JS had multiple template files it needed to download, if and only if the files hadn\u2019t already been downloaded before. While I suppose I could have relied on browser caching, I wanted to manage the requests in\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1183"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/comments?post=1183"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1183\/revisions"}],"predecessor-version":[{"id":1184,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1183\/revisions\/1184"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/media?parent=1183"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/categories?post=1183"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/tags?post=1183"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}