{"id":2165,"date":"2017-04-04T19:56:26","date_gmt":"2017-04-05T00:56:26","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=2165"},"modified":"2017-04-05T07:09:38","modified_gmt":"2017-04-05T12:09:38","slug":"automatic-reconnecting-iscsi-drives-in-windows-10-using-powershell","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2165","title":{"rendered":"Automatic Reconnection of iSCSI Targets in Windows 10 using PowerShell"},"content":{"rendered":"<p>When my highly recommended <strong><a href=\"http:\/\/amzn.to\/2n932GE\">Synology <\/a>Disk Station<\/strong> reboots for a required update (I&#8217;ve got it set to automatically reboot), a shared Windows 10 PC in our house cannot always successfully reconnect to the iSCSI targets without manual intervention. Unfortunately, I haven&#8217;t always noticed which has led to several features of Windows not functioning the way I want (I have mapped the iSCSI drives\/disks via Windows and made them into network shares for the other PCs\/laptops in our house &#8212; this way I can use Windows bitlocker encryption on the iSCSI drive contents).<\/p>\n<p>To make the connection more automatic, I created a simple one line PowerShell script that periodically attempts to connect to any disconnected iSCSI targets using the Windows Task Scheduler.<\/p>\n<p>I saved this into a script file called <strong>reconnect-iscsi-targets.ps1<\/strong>:<\/p>\n<pre>Get-IscsiTarget | where ($_.isConnected -eq $false) | Connect-IscsiTarget<\/pre>\n<p>Then, in the Task Scheduler, I created a new task set to run every 10 minutes daily. The script just gets all iSCSI targets, filters only those that aren&#8217;t connected, and then passes the results to the connection cmdlet.<\/p>\n<p>For the action, I selected <strong>&#8220;Start a program&#8221;<\/strong> for program\/script, I entered: <strong>&#8220;powershell.exe&#8221;<\/strong>, and then added the arguments &#8220;<strong>-File<\/strong>&#8221; and the full path to the file name, like:<\/p>\n<pre>-File c:\\Users\\aaron\\Documents\\reconnect-iscsi-targets.ps1<\/pre>\n<p>If there are spaces in the path to the PowerShell file, be sure to add quotes around the full path and file name.<\/p>\n<p><img data-attachment-id=\"2168\" data-permalink=\"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2165\/2017-04-04_19-07-23\" data-orig-file=\"https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/2017-04-04_19-07-23.png\" data-orig-size=\"460,500\" data-comments-opened=\"1\" data-image-meta=\"{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}\" data-image-title=\"Action properties for Task\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/2017-04-04_19-07-23-276x300.png\" data-large-file=\"https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/2017-04-04_19-07-23.png\" loading=\"lazy\" class=\"aligncenter wp-image-2168 size-full\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/2017-04-04_19-07-23.png\" alt=\"\" width=\"460\" height=\"500\" srcset=\"https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/2017-04-04_19-07-23.png 460w, https:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/2017-04-04_19-07-23-276x300.png 276w\" sizes=\"(max-width: 460px) 100vw, 460px\" \/><\/p>\n<p>You shouldn&#8217;t need the <strong>start in<\/strong>\u00a0option set (leave it empty if you&#8217;d like).<\/p>\n<p>On the General tab of the task, make sure you&#8217;ve set the &#8220;<strong>Run whether user is logged on or not<\/strong>&#8221; option and &#8220;<strong>Run with highest privileges<\/strong>.&#8221;<\/p>\n<p>Next up &#8212; how to quickly<a href=\"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2170\"> create a Self-Signed Code-Signing<\/a> certificate. And, how to actually allow scripts to run!<\/p>\n","protected":false},"excerpt":{"rendered":"<p>When my highly recommended Synology Disk Station reboots for a required update (I&#8217;ve got it set to automatically reboot), a shared Windows 10 PC in our house cannot always successfully reconnect to the iSCSI targets without manual intervention. Unfortunately, I haven&#8217;t always noticed which has led to several features of Windows not functioning the way [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4,5,173],"tags":[174,175,176],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-yV","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":2170,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2170","url_meta":{"origin":2165,"position":0},"title":"How to sign Powershell scripts with self-signed certificates in Windows 10","date":"April 4, 2017","format":false,"excerpt":"I wanted to allow all signed Powershell scripts to run on a PC in our house on Windows 10. To do that, I needed a code-signing certificate. Unfortunately, the days of easily obtaining a free code signing certificate seem to have ended. Have no fear! You can create a self-signed\u2026","rel":"","context":"In &quot;General&quot;","img":{"alt_text":"Drag Certificate Into Trusted Root Certification Authorities","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2017\/04\/DragCertificateIntoTrusted-1.gif?resize=350%2C200&ssl=1","width":350,"height":200},"classes":[]},{"id":1773,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1773","url_meta":{"origin":2165,"position":1},"title":"AV Club \/ Our home setup 2012","date":"December 12, 2012","format":false,"excerpt":"I\u2019ve done a lot of reworking of our computers and network recently and thought I\u2019d post some details about the various physical and digital parts that make our humble WiredPrairie home work. Using Google Docs, I created a labeled diagram with most of the moving parts of our house (WOW,\u2026","rel":"","context":"In &quot;Recommendations&quot;","img":{"alt_text":"Home Setup","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/12\/Home-Setup_thumb1.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1222,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1222","url_meta":{"origin":2165,"position":2},"title":"Windows Home Server 2011 &amp; &ldquo;the server appears to be offline&rdquo; when trying to connect to the LaunchPad","date":"August 10, 2011","format":false,"excerpt":"Within the past few days--maybe after a recent Windows Update--one of my laptops started to fail to successfully connect to the WHS 2011 server I\u2019ve got in my home. The error was \u201cthe server appears to be offline\u201d and asked if I\u2019d instead want to connect off-line. (Yeah, no thanks.)\u2026","rel":"","context":"In &quot;Software&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/08\/image2.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1901,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1901","url_meta":{"origin":2165,"position":3},"title":"PRTG Network Monitor for Windows","date":"July 16, 2013","format":false,"excerpt":"My current router\/firewall\/VPN device has an unfortunately mediocre live monitor for bandwidth statistics, but supports SMNP. So after a reasonably painful search for decent free options (oh boy are there some awful ones!), I installed the freeware version of the Paessler PRTG monitor so that I could easily see the\u2026","rel":"","context":"In &quot;General&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2013\/07\/image_thumb3.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1541,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1541","url_meta":{"origin":2165,"position":4},"title":"Adobe Lightroom and exporting to subfolders","date":"February 8, 2012","format":false,"excerpt":"For some reason, versions 1 \u2013 3 of Adobe Lightroom cannot export images in a way that mirrors the original structure of your photo library. I can\u2019t offer a reason why other than it was missed by the development and design teams. There\u2019s been enough interest in it apparently that\u2026","rel":"","context":"In &quot;Photography&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/02\/image2.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":111,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/111","url_meta":{"origin":2165,"position":5},"title":"Disabling Apple Software Update on Vista","date":"April 10, 2008","format":false,"excerpt":"I've complained (and so have many others) about the Apple Software Update functionality -- especially now that it suggests that I update software I never had installed (Safari)! On Vista (and XP is probably similar), there's a scheduled task that runs once a week to look for updates. To stop\u2026","rel":"","context":"In &quot;Software&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/2165"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/comments?post=2165"}],"version-history":[{"count":8,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/2165\/revisions"}],"predecessor-version":[{"id":2187,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/2165\/revisions\/2187"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/media?parent=2165"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/categories?post=2165"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/tags?post=2165"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}