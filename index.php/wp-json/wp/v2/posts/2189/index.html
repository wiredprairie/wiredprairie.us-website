{"id":2189,"date":"2017-04-28T20:14:45","date_gmt":"2017-04-29T01:14:45","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=2189"},"modified":"2017-04-28T20:14:45","modified_gmt":"2017-04-29T01:14:45","slug":"quick-demo-of-gos-context-withtimeout","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2189","title":{"rendered":"Quick demo of Go&#8217;s context.WithTimeout"},"content":{"rendered":"<p>To better understand Go&#8217;s context <a href=\"https:\/\/golang.org\/pkg\/context\/#WithTimeout\"><strong>withTimeout\u00a0<\/strong><\/a>functionality (and as a reference for myself), I&#8217;ve created this small self-contained demo. I didn&#8217;t find the published documentation&#8217;s example to be clear enough. The interesting part, coming from other programming languages and platforms, was that the <strong>WithTimeout<\/strong> function only was a signal that something happened. It doesn&#8217;t do anything when there&#8217;s a time out (like abort a goroutine or anything dramatic like that).<\/p>\n<p>The essential pieces:<\/p>\n<ol>\n<li>Call <strong>WithTimeout<\/strong> passing the <strong>Background()<\/strong> context and specify the timeout (I&#8217;ve specified \u00a03.2 seconds)<\/li>\n<li>Be a good citizen and <strong>defer<\/strong> the cancellation (to be sure that it&#8217;s called) and\u00a0<strong>defer close\u00a0<\/strong>the channel<\/li>\n<li>Start the go routine which waits for the <strong>Done\u00a0<\/strong>channel<\/li>\n<li>When the <strong>Done<\/strong> is signaled, display the current time in seconds and what caused the signal<\/li>\n<li>The main app is waiting for the goroutine to end, so signal that.<\/li>\n<li>In the main function, the code sleeps and wakes emitting some time stamps to the console<\/li>\n<li>Depending on whether <strong>cancel<\/strong> is called, the goroutine signal may be one of two things.\n<ol>\n<li>If <strong>cancel<\/strong> is not called prior to the second sleep in\u00a0the code, the <strong>ctx.Err()\u00a0<\/strong>returns\n<pre class=\"\"><span class=\"stdout\">&lt;-ctx.Done():  context deadline exceeded<\/span><\/pre>\n<\/li>\n<li>If <strong>cancel<\/strong> however is called, the ctx.Err() returns:\n<pre class=\"\"><span class=\"stdout\">&lt;-ctx.Done():  context canceled<\/span><\/pre>\n<\/li>\n<\/ol>\n<\/li>\n<li>Then, the goroutine uses the channel to signal completion (<strong>wait&lt;-true<\/strong>).<\/li>\n<\/ol>\n<div class=\"oembed-gist\"><script src=\"https:\/\/gist.github.com\/wiredprairie\/f8b322866b885be484cdff97bad19e9c.js\"><\/script><noscript>View the code on <a href=\"https:\/\/gist.github.com\/wiredprairie\/f8b322866b885be484cdff97bad19e9c\">Gist<\/a>.<\/noscript><\/div>\n<p>You can experiment with this sample <a href=\"https:\/\/play.golang.org\/p\/ulikEClQE3\">here<\/a>.<\/p>\n<p>With cancel called (the line <strong>cancel()<\/strong>\u00a0not commented out):<\/p>\n<pre class=\"\"><span class=\"stdout\">first sleep completed,  02.00\r\nTimeout: 02.00\r\nin &lt;-ctx.Done():  context canceled\r\n<\/span><span class=\"stdout\">after second sleep done,  04.00<\/span><\/pre>\n<p>And, with\u00a0<strong>\/\/ cancel() <\/strong>commented out:<\/p>\n<pre class=\"\"><span class=\"stdout\">first sleep completed,  02.00\r\n<\/span><span class=\"stdout\">Timeout: 03.20\r\nin &lt;-ctx.Done():  context deadline exceeded\r\n<\/span><span class=\"stdout\">after second sleep done,  04.00\r\n<\/span><\/pre>\n<p>Hopefully this helps someone besides me.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>To better understand Go&#8217;s context withTimeout\u00a0functionality (and as a reference for myself), I&#8217;ve created this small self-contained demo. I didn&#8217;t find the published documentation&#8217;s example to be clear enough. The interesting part, coming from other programming languages and platforms, was that the WithTimeout function only was a signal that something happened. It doesn&#8217;t do anything [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4,5],"tags":[170],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-zj","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1773,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1773","url_meta":{"origin":2189,"position":0},"title":"AV Club \/ Our home setup 2012","date":"December 12, 2012","format":false,"excerpt":"I\u2019ve done a lot of reworking of our computers and network recently and thought I\u2019d post some details about the various physical and digital parts that make our humble WiredPrairie home work. Using Google Docs, I created a labeled diagram with most of the moving parts of our house (WOW,\u2026","rel":"","context":"In &quot;Recommendations&quot;","img":{"alt_text":"Home Setup","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/12\/Home-Setup_thumb1.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1340,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1340","url_meta":{"origin":2189,"position":1},"title":"Nest Thermostat Review, Update #1","date":"December 27, 2011","format":false,"excerpt":"After a few weeks of using the Nest thermostat, I\u2019ve got a few more comments that I\u2019d like to share. (Here\u2019s my post about the installation). The learning feature honestly hasn\u2019t been very useful in the first few weeks. It\u2019s apparently easily confused by days that you're home unexpectedly (for\u2026","rel":"","context":"In &quot;General&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2011\/12\/image_thumb3.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":2078,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2078","url_meta":{"origin":2189,"position":2},"title":"Tree walking and display console app in Go","date":"November 18, 2016","format":false,"excerpt":"I hadn\u2019t done anything at all interesting in Go. And some might say, I still haven\u2019t. However, I wanted to do something that I\u2019d find occasionally useful. On Linux, this is already available, but the the Windows version is lacking. I wanted a tiny console app that would display a\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2016\/11\/image_thumb-2.png?resize=350%2C200&ssl=1","width":350,"height":200},"classes":[]},{"id":388,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/388","url_meta":{"origin":2189,"position":3},"title":"Silverlight Weather Demonstration","date":"June 26, 2008","format":false,"excerpt":"Demonstration available here. (You'll need to wait for a moment while it loads the first time). I've created a reasonably simple, yet multi-technology (and discipline) demonstration using Silverlight for the user interface and ASP.NET as the back-end. The demonstration uses: Silverlight 2.0 Data binding Delayed downloading of images \"Web services\"\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2008\/06\/image21.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1749,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1749","url_meta":{"origin":2189,"position":4},"title":"Nest Update #12: Software at 3.0 with New Features","date":"October 3, 2012","format":false,"excerpt":"As the blogosphere exploded yesterday with news of a second generation Nest thermostat and a new major version of the software (for the thermostats and the controllers such as the web site and various SmartPhones), I wondered what impact the new software and hardware would have on average users, like\u2026","rel":"","context":"In &quot;Recommendations&quot;","img":{"alt_text":"IMG_0630","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/10\/IMG_0630.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":2224,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/2224","url_meta":{"origin":2189,"position":5},"title":"Flutter Demo application linking to BoardGameGeek.Com&#8217;s Hot Game List","date":"February 26, 2018","format":false,"excerpt":"I've built a slightly more interesting application using Flutter.\u00a0 Using an XML feed from BoardGameGeek's API, the application displays a list of the current hot games complete with thumbnail images. Here's the code. I used a standard Flutter app template and also added a few packages to the project. I've\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"Hulk Smash Layout","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2018\/02\/2018-02-26-19_45_39-Hulk-Smash-Meme-Generator-Imgflip.png?resize=350%2C200&ssl=1","width":350,"height":200},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/2189"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/comments?post=2189"}],"version-history":[{"count":5,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/2189\/revisions"}],"predecessor-version":[{"id":2194,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/2189\/revisions\/2194"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/media?parent=2189"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/categories?post=2189"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/tags?post=2189"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}