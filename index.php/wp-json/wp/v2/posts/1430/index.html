{"id":1430,"date":"2012-01-07T13:39:24","date_gmt":"2012-01-07T19:39:24","guid":{"rendered":"http:\/\/www.wiredprairie.us\/blog\/?p=1430"},"modified":"2012-01-07T13:39:24","modified_gmt":"2012-01-07T19:39:24","slug":"ember-js-and-ezdata-and-rails","status":"publish","type":"post","link":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1430","title":{"rendered":"Ember.JS and EZdata, and Rails"},"content":{"rendered":"<p>I\u2019ve been trying to do some additional work on my <a href=\"http:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1377\">ember.js extension for data<\/a> management. At the same time though, I\u2019ve been trying (to learn and) build a simple <a href=\"http:\/\/rubyonrails.org\/\">Ruby on Rails<\/a> web demo application using the new JavaScript library. There have been more than a few things that have mystified me about the framework and the structuring of an application. One aspect in particular was how to best manage foreign keys and join tables with the ActiveRecord class (and the corresponding SQL tables). So many tutorials have the same lame example of: a CART, an ORDER, a CUSTOMER \u2026, that it\u2019s often difficult to apply the same patterns to a more interesting system. <\/p>\n<p>I started simple this time. <\/p>\n<p>I wanted a PERSON class and a GIFT class.<\/p>\n<p><a href=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/image6.png\"><img loading=\"lazy\" style=\"background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px\" title=\"image\" border=\"0\" alt=\"image\" src=\"http:\/\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/image_thumb6.png\" width=\"399\" height=\"159\" \/><\/a><\/p>\n<p>A Person has been given gifts and may give gifts (and a few other common attributes). <\/p>\n<pre class=\"csharpcode\"><span class=\"kwrd\">class<\/span> CreatePeople &lt; ActiveRecord::Migration\n  def change\n    create_table :people do |t|\n      t.string :first_name\n      t.string :last_name\n      t.<span class=\"kwrd\">date<\/span> :date_of_birth\n      t.string :email_address\n\n      t.timestamps\n    <span class=\"kwrd\">end<\/span>\n  <span class=\"kwrd\">end<\/span>\n<span class=\"kwrd\">end<\/span><\/pre>\n<p>One of the things that I can\u2019t decide if I like is the automatic pluralization of words, especially People\/Person. I would have been content with a Persons table, but when creating a model, by default (as I\u2019m aware it can be overridden), a Person is mapped to a table called \u201cPeople.\u201d <\/p>\n<p>The second table, Gifts is very simple:<\/p>\n<pre class=\"csharpcode\"><span class=\"kwrd\">class<\/span> CreateGifts &lt; ActiveRecord::Migration\n  def change\n    create_table :gifts do |t|\n      t.string :description\n      t.<span class=\"kwrd\">integer<\/span> :from_person_id\n      t.<span class=\"kwrd\">integer<\/span> :to_person_id\n      t.timestamps\n    <span class=\"kwrd\">end<\/span>\n  <span class=\"kwrd\">end<\/span>\nend<\/pre>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>As I thought I might want a richer structure for the Gift class in the future, I did not use the more standard \u201cperson_id\u201d name for the foreign key column that maps a gift to a Person. I wanted the column name to be more obvious what it was. Additionally, I needed two columns that both mapped to a \u201cPerson&quot;, so I couldn\u2019t have both be called \u201cperson_id\u201d anyway.<\/p>\n<p>By deviating from the normal pattern, there are a few expectations when defining the ActiveRecord class. It was these expectations that weren\u2019t clear to me (especially with examples).<\/p>\n<p>The Ruby class for Gift is defined like so:<\/p>\n<pre class=\"csharpcode\"><span class=\"kwrd\">class<\/span> Gift &lt; ActiveRecord::Base\n  belongs_to :from_person, :class_name =&gt; &quot;Person&quot;, :foreign_key =&gt; &quot;from_person_id&quot;\n  belongs_to :to_person, :class_name =&gt; &quot;Person&quot;, :foreign_key =&gt; &quot;to_person_id&quot;\n<span class=\"kwrd\">end<\/span><\/pre>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>and the Person:<\/p>\n<pre class=\"csharpcode\"><span class=\"kwrd\">class<\/span> Person &lt; ActiveRecord::Base\n  has_many  :gifts_given , :class_name =&gt; &quot;Gift&quot;, :foreign_key =&gt; &quot;from_person_id&quot;\n  has_many  :gifts, :foreign_key =&gt; &quot;to_person_id&quot;\n<span class=\"kwrd\">end<\/span><\/pre>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n<p>The key (and the \u2018ah ha\u2019 moment for me) was the use of the foreign_key parameter to the on the has_many and belongs_to associations. <\/p>\n<p>In the Gift class, I included the <strong>belongs_to<\/strong> association macro. In this case, <strong>:from_person<\/strong> is the name of the rich accessor method (which looks like a property in other languages) that will be added to the Gift class. Using the symbol <strong>:class_name<\/strong> is like a class finding assistant. Without it, the Rails framework assumes that there would be a class named \u201cFromPerson.\u201d Of course, that would fail. By specifying \u201cPerson,\u201d I\u2019ve indicated to Rails that the class it should map to is called \u201cPerson\u201d which I defined earlier. The <strong>:foreign_key<\/strong> symbol and value indicates which column in the backing table has the value which will map to an instance of a Person. In the SQL table, I added a \u201c<strong>from_person_id<\/strong>\u201d column and this points at that as the \u201cfrom_person_id\u201d column is the foreign key to the People table. (The same is true for <strong>:to_person<\/strong>.) <\/p>\n<p>Looking at the Person class, it is using another common association macro, <strong>:has_many<\/strong>. <strong>:Has_many<\/strong> when used here, is indicating that a Person may have zero or more \u201cgifts.\u201d The new accessor method is named <strong>gifts <\/strong>(by using <strong>:gifts<\/strong>). Here, too, you\u2019ll specify the name of the foreign_key. Again, repeat this for the <strong>:gifts_given<\/strong> automatically added accessor method. One interesting thing is that only :<strong>gifts_given <\/strong>requires the :<strong>class_name<\/strong> to be specified. The reason is that Rails automatically maps <strong>:gifts <\/strong>to the Gifts class (by way of naming). The :gifts_given cannot be automatically mapped, so you need to give (sigh) it a little help.<\/p>\n<p>Here\u2019s a little test:<\/p>\n<pre class=\"csharpcode\">&gt;&gt; jason = Person.find(1)\n  Person Load (18.0ms)  SELECT <span class=\"str\">&quot;people&quot;<\/span>.* FROM <span class=\"str\">&quot;people&quot;<\/span> WHERE <span class=\"str\">&quot;people&quot;<\/span>.<span class=\"str\">&quot;id&quot;<\/span> = ? LIMIT 1  [[<span class=\"str\">&quot;id&quot;<\/span>, 1]]\n#&lt;Person id: 1, first_name: <span class=\"str\">&quot;Jason&quot;<\/span>, last_name: <span class=\"str\">&quot;Bourne&quot;<\/span>, date_of_birth: nil, email_address: nil, created_at: <span class=\"str\">&quot;2012-01-06 13:47:40&quot;<\/span>, updated_at: <span class=\"str\">&quot;2012-01-07 03:10:29&quot;<\/span>&gt;\n&gt;&gt; jason.gifts_given\n  Gift Load (0.0ms)  SELECT <span class=\"str\">&quot;gifts&quot;<\/span>.* FROM <span class=\"str\">&quot;gifts&quot;<\/span> WHERE <span class=\"str\">&quot;gifts&quot;<\/span>.<span class=\"str\">&quot;from_person_id&quot;<\/span> = 1\n[#&lt;Gift id: 1, description: <span class=\"str\">&quot;Machine Gun&quot;<\/span>, from_person_id: 1, to_person_id: 4, created_at: <span class=\"str\">&quot;2012-01-07 14:39:17&quot;<\/span>, updated_at: <span class=\"str\">&quot;2012-01-07 14:39:17&quot;<\/span>&gt;]\n&gt;&gt; jason.gifts_given[0].to_person.first_name\n<span class=\"str\">&quot;Magnum&quot;<\/span>\n  Person Load (0.0ms)  SELECT <span class=\"str\">&quot;people&quot;<\/span>.* FROM <span class=\"str\">&quot;people&quot;<\/span> WHERE <span class=\"str\">&quot;people&quot;<\/span>.<span class=\"str\">&quot;id&quot;<\/span> = 4 LIMIT 1\n&gt;&gt; jason.gifts_given[0].to_person.gifts\n  [#&lt;Gift id: Gift Load (1.0ms)1  SELECT <span class=\"str\">&quot;gifts&quot;<\/span>.* FROM <span class=\"str\">&quot;gifts&quot;<\/span> WHERE <span class=\"str\">&quot;gifts&quot;<\/span>.<span class=\"str\">&quot;to_person_id&quot;<\/span> = 4\n, description: <span class=\"str\">&quot;Machine Gun&quot;<\/span>, from_person_id: 1, to_person_id: 4, created_at: <span class=\"str\">&quot;2012-01-07 14:39:17&quot;<\/span>, updated_at: <span class=\"str\">&quot;2012-01-07 14:39:17&quot;<\/span>&gt;]\n&gt;&gt; jason.gifts_given[0].to_person.gifts[0].from_person.first_name\n  Person Load (0.0ms)  SELECT <span class=\"str\">&quot;people&quot;<\/span>.* FROM <span class=\"str\">&quot;people&quot;<\/span> WHERE <span class=\"str\">&quot;people&quot;<\/span>.<span class=\"str\">&quot;id&quot;<\/span> = 1 LIMIT 1\n<span class=\"str\">&quot;Jason&quot;<\/span><\/pre>\n<p>I added two people: Jason, and Magnum, and one gift before executing the code above. Jason, as you should be able to follow, gave a wonderful gift to Magnum. As you can see, by using the automatically added accessor methods by way of the association macros described above, I was able to traverse the database structure very easily when mapped to a few simple objects. <\/p>\n<p>One plus of experimenting and testing with the console while using Rails\/Ruby in this case is that the output includes the SQL commands that are executed when the various method calls are made. Here\u2019s an example where I rolled multiple calls into one chained call:<\/p>\n<pre class=\"csharpcode\">&gt;&gt; jason = Person.find(1).gifts_given[0].to_person.first_name\n  Person Load (19.0ms)  SELECT <span class=\"str\">&quot;people&quot;<\/span>.* FROM <span class=\"str\">&quot;people&quot;<\/span> WHERE <span class=\"str\">&quot;people&quot;<\/span>.<span class=\"str\">&quot;id&quot;<\/span> = ? LIMIT 1  [[<span class=\"str\">&quot;id&quot;<\/span>, 1]]\n  Gift Load (0.0ms)  SELECT <span class=\"str\">&quot;gifts&quot;<\/span>.* FROM <span class=\"str\">&quot;gifts&quot;<\/span> WHERE <span class=\"str\">&quot;gifts&quot;<\/span>.<span class=\"str\">&quot;from_person_id&quot;<\/span> = 1\n<span class=\"str\">&quot;Magnum&quot;<\/span>\n  Person Load (0.0ms)  SELECT <span class=\"str\">&quot;people&quot;<\/span>.* FROM <span class=\"str\">&quot;people&quot;<\/span> WHERE <span class=\"str\">&quot;people&quot;<\/span>.<span class=\"str\">&quot;id&quot;<\/span> = 4 LIMIT 1<\/pre>\n<style type=\"text\/css\">\n.csharpcode, .csharpcode pre\n{\n\tfont-size: small;\n\tcolor: black;\n\tfont-family: consolas, \"Courier New\", courier, monospace;\n\tbackground-color: #ffffff;\n\t\/*white-space: pre;*\/\n}\n.csharpcode pre { margin: 0em; }\n.csharpcode .rem { color: #008000; }\n.csharpcode .kwrd { color: #0000ff; }\n.csharpcode .str { color: #006080; }\n.csharpcode .op { color: #0000c0; }\n.csharpcode .preproc { color: #cc6633; }\n.csharpcode .asp { background-color: #ffff00; }\n.csharpcode .html { color: #800000; }\n.csharpcode .attr { color: #ff0000; }\n.csharpcode .alt \n{\n\tbackground-color: #f4f4f4;\n\twidth: 100%;\n\tmargin: 0em;\n}\n.csharpcode .lnum { color: #606060; }<\/style>\n","protected":false},"excerpt":{"rendered":"<p>I\u2019ve been trying to do some additional work on my ember.js extension for data management. At the same time though, I\u2019ve been trying (to learn and) build a simple Ruby on Rails web demo application using the new JavaScript library. There have been more than a few things that have mystified me about the framework [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false,"jetpack_publicize_feature_enabled":true},"categories":[4,5],"tags":[50,58,57,51],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/pd5QIe-n4","jetpack_likes_enabled":true,"jetpack-related-posts":[{"id":1377,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1377","url_meta":{"origin":1430,"position":0},"title":"EzData for Ember.js","date":"January 1, 2012","format":false,"excerpt":"Previous post: Entity reference I\u2019ve been extending my original post (above) in an effort to create a simple entity system using Ember.js (SproutCore 2.0). While it\u2019s grown in sophistication, it is far from complete. The project is now located on GitHub. This is the introduction, from the readme on GitHub.\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1345,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1345","url_meta":{"origin":1430,"position":1},"title":"Creating a simple Entity Reference system for Ember.js","date":"December 28, 2011","format":false,"excerpt":"I had some data stored in a structure similar to this: Nothing too fancy. A table of Gift(s) and a table of Person(s). Each gift had a foreign key relationship to a Person (the person who \u201cgave\u201d the gift). Since some people may give several gifts, I didn\u2019t want to\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":1442,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1442","url_meta":{"origin":1430,"position":2},"title":"Nest Thermostat API\/Protocol","date":"January 8, 2012","format":false,"excerpt":"While Nest Labs hasn\u2019t released a formal (documented & supported) API, I thought I\u2019d do a bit of digging to see how they\u2019re using the network and what might be achievable. A few things are going on, the majority as you\u2019d probably expect. The web interface is using a long\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"image","src":"https:\/\/i0.wp.com\/www.wiredprairie.us\/blog\/wp-content\/uploads\/2012\/01\/image_thumb7.png?resize=350%2C200","width":350,"height":200},"classes":[]},{"id":1965,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/1965","url_meta":{"origin":1430,"position":3},"title":"Simple example of using MongoMapper with Ruby","date":"October 24, 2013","format":false,"excerpt":"The MongoMapper web site is really lacking on even simple examples, especially those that don\u2019t use Rails. So, here\u2019s a simple example that might help someone. From the Gemfile: source 'https:\/\/rubygems.org'gem 'mongo_mapper' And then the application: require 'mongo_mapper'# jam it into the database \"mm\"MongoMapper.database = \"mm\"class App def create_user user\u2026","rel":"","context":"In &quot;General&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":368,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/368","url_meta":{"origin":1430,"position":4},"title":"Do we really need another Javascript framework for UI?","date":"June 16, 2008","format":false,"excerpt":"From the web site, RoughlyDrafted magazine, Cocoa for Windows + Flash Killer = SproutCore. Apple doesn\u2019t sell ads, it sells hardware. But if the web requires Flash or Silverlight to run, Adobe or Microsoft can either intentionally kill alternative platforms like the Mac (or Linux), or simply make them work\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]},{"id":568,"url":"https:\/\/www.wiredprairie.us\/blog\/index.php\/archives\/568","url_meta":{"origin":1430,"position":5},"title":"Data Binding and Tooltips in Silverlight","date":"September 19, 2008","format":false,"excerpt":"Have you ever wanted to databind a tooltip in Silverlight (or WPF for that matter), and found that the DataContext isn't available for tooltips (the datacontext is null)? It's very annoying. Tooltips, unfortunately, aren't connected to their parents in anyway when they're created, so they loose the ability to connect\u2026","rel":"","context":"In &quot;Coding&quot;","img":{"alt_text":"","src":"","width":0,"height":0},"classes":[]}],"_links":{"self":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1430"}],"collection":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/comments?post=1430"}],"version-history":[{"count":1,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1430\/revisions"}],"predecessor-version":[{"id":1431,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/posts\/1430\/revisions\/1431"}],"wp:attachment":[{"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/media?parent=1430"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/categories?post=1430"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.wiredprairie.us\/blog\/index.php\/wp-json\/wp\/v2\/tags?post=1430"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}